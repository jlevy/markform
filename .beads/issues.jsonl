{"id":"markform-055","title":"FORM-SIMPLE-001: Clarify requiredness for minItems/minSelections fields","description":"## Problem\nIn `simple.form.md`:\n- `tags` has `minItems=1` but no `required=true`\n- `categories` has `minSelections=1` but no `required=true`\n\nThis is ambiguous given the spec wording around required vs min constraints.\n\n## Why It Matters\n- Behavior differs depending on whether min constraints imply requiredness\n- Progress/form_state computation could be inconsistent with validation\n- Creates confusion for implementers and users\n\n## Recommended Fix\nAfter ARCH-013 decision, either:\n1. Add `required=true` to both fields (clearest, recommended)\n2. Remove min constraints and rely solely on `required=true`\n3. Keep as-is if spec clarifies min constraints DON'T imply requiredness\n\n## Files to Update\n- docs/project/test-fixtures/forms/simple.form.md\n- docs/project/test-fixtures/forms/simple-mock-filled.form.md (if needed)\n\n## Depends On\n- ARCH-013 (need decision on min constraints vs requiredness first)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:51.083335-08:00","updated_at":"2025-12-23T09:39:14.684176202Z","closed_at":"2025-12-23T09:39:14.684176202Z","dependencies":[{"issue_id":"markform-055","depends_on_id":"markform-bg7","type":"blocks","created_at":"2025-12-23T00:34:34.240775-08:00","created_by":"daemon"}]}
{"id":"markform-069","title":"Add lefthook for pre-commit and pre-push hooks","description":"Set up lefthook for local git hooks as part of initial project scaffolding.\n\n**Pre-commit hooks (fast, 2-5s target):**\n- Prettier formatting with auto-fix\n- ESLint with cache and auto-fix\n- TypeScript incremental typecheck\n\n**Pre-push hooks (cached):**\n- Full test suite with commit-hash caching\n- Skip if tests already passed for current commit\n\nSee: docs/project/research/current/research-modern-typescript-monorepo-package.md (Section 9, Appendix E)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:35:44.028335-08:00","updated_at":"2025-12-23T17:32:58.45114092Z","closed_at":"2025-12-23T17:27:54.143420906Z","dependencies":[{"issue_id":"markform-069","depends_on_id":"markform-zt3","type":"blocks","created_at":"2025-12-23T00:36:33.034483-08:00","created_by":"daemon"}]}
{"id":"markform-08t","title":"Markform v0.1 Full Implementation","description":"Complete implementation of Markform v0.1 as defined in plan-2025-12-22-markform-v01-implementation.md\n\nPhases:\n- Phase 0: Project scaffolding and monorepo setup\n- Phase 1: Core engine (parsing, serialization, validation, patches)\n- Phase 2: Web UI (serve) and basic CLI commands\n- Phase 3: End-to-end CLI, harness loop, and golden session tests\n- Phase 4: Vercel AI SDK integration research and testing\n\nRef: docs/project/specs/active/plan-2025-12-22-markform-v01-implementation.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:11.561717-08:00","updated_at":"2025-12-23T16:41:39.880252299Z","closed_at":"2025-12-23T16:36:53.161365159Z"}
{"id":"markform-0oa","title":"PLAN-004: Add task for Markdoc tag config/schema definitions","description":"## Problem\nPlan doesn't explicitly include defining a Markdoc config/schema for custom tags, but architecture requires `Markdoc.validate(ast, config)` as an early syntax/schema gate.\n\n## Why It Matters\n- `Markdoc.validate()` is only meaningful with a proper config object\n- Need tag definitions for `form`, `field-group`, all field tags, `doc`\n- Need attribute schemas for each tag\n- Without this, Markdoc.validate just does basic syntax checking\n\n## Recommended Fix\nAdd a concrete task:\n1. Implement `markformMarkdocConfig` with tag definitions and attribute schemas\n2. Define required vs optional attributes per tag\n3. Add unit tests that invalid attributes are caught by Markdoc.validate\n4. Test that unknown tags are rejected\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md (add task to Phase 1)\n\n## Blocks\n- markform-7mt (1.2 Markdoc Parsing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:02.206142-08:00","updated_at":"2025-12-23T09:31:48.312206333Z","closed_at":"2025-12-23T09:31:48.312206333Z"}
{"id":"markform-100","title":"Add dotenv support for CLI (.env and .env.local)","description":"The CLI currently has no support for loading environment variables from .env files.\n\n**Current state:**\n- bin.ts just runs the CLI without loading any env files\n- Scripts like test-live-agent.ts check process.env.ANTHROPIC_API_KEY but rely on shell environment\n- A .env file exists in the repo root but is not loaded\n\n**Requirements:**\n1. Load .env.local first (for local overrides, not committed to git)\n2. Then load .env (for defaults/examples)\n3. Never overwrite existing environment variables (shell takes precedence)\n4. Must work in both dev (pnpm/tsx) and production (npm-installed binary)\n\n**Recommended approach:**\nUse the `dotenv` package (zero-dependency, well-maintained, de facto standard):\n```typescript\n// In bin.ts, before anything else:\nimport { config } from 'dotenv';\nimport { existsSync } from 'node:fs';\nimport { resolve } from 'node:path';\n\n// Load .env.local first (local overrides), then .env (defaults)\n// Don't overwrite existing env vars\nconst cwd = process.cwd();\nfor (const file of ['.env.local', '.env']) {\n  const path = resolve(cwd, file);\n  if (existsSync(path)) {\n    config({ path, override: false });\n  }\n}\n```\n\n**Dependencies to add:**\n- dotenv (runtime)\n- @types/dotenv or included types (dev, if needed)\n\n**Files to modify:**\n- packages/markform/package.json (add dotenv dependency)\n- packages/markform/src/cli/bin.ts (add loading logic)\n\n**Testing:**\n- Verify API keys load from .env in dev mode (pnpm markform serve)\n- Verify API keys load from .env when installed globally (npm install -g)\n- Verify shell env vars take precedence over .env files\n- Verify .env.local takes precedence over .env","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T13:01:29.14353-08:00","updated_at":"2025-12-23T13:06:40.997225-08:00","closed_at":"2025-12-23T13:06:40.997225-08:00"}
{"id":"markform-101","title":"Implement fill command with live agent support","description":"Refactor the 'run' command into a general 'fill' command supporting both mock and live agent modes.\n\n**Key Changes:**\n- Rename `run` → `fill` (no backward compatibility needed for v0.1)\n- Add `--agent` flag: `mock` | `live` (default: live)\n- Add `--model` flag: `provider/model-name` format (e.g., `anthropic/claude-sonnet-4-5`)\n- Implement live agent using Vercel AI SDK\n- Update architecture doc to reflect changes\n\n**Plan:** docs/project/specs/active/plan-2025-12-23-fill-command-live-agent.md\n\n**Implementation Phases:**\n1. Refactor command structure (rename run → fill, add flags)\n2. Implement live agent with AI SDK integration  \n3. Update documentation (architecture, development, README)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-23T13:03:08.12202-08:00","updated_at":"2025-12-23T13:21:29.766129-08:00","closed_at":"2025-12-23T13:21:29.766129-08:00","dependencies":[{"issue_id":"markform-101","depends_on_id":"markform-100","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-102","title":"Extract versioned filename logic into cli/lib/versioning.ts","description":"Extract the versioned filename logic into a shared utility for use across fill, render, and serve commands.\n\n**Location:** `cli/lib/versioning.ts`\n\n**Functionality:**\n- `generateVersionedFilename(basePath: string): string` - finds next available version\n- Pattern: `name.form.md` → `name-v1.form.md`, `name-v2.form.md`, etc.\n- Detect existing version suffix (`-vN`, `_vN`, ` vN`) and increment\n- Check filesystem for existing files to avoid conflicts\n\n**Consumers:**\n- `fill` command (default output)\n- `render` command (HTML output naming)\n- `serve` command (save button)\n\n**Tests:**\n- `form.form.md` → `form-v1.form.md`\n- `form-v1.form.md` → `form-v2.form.md`\n- `form-v99.form.md` → `form-v100.form.md`\n\n**Part of:** markform-101 (fill command)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:14:59.421396-08:00","updated_at":"2025-12-23T13:52:39.83536-08:00","closed_at":"2025-12-23T13:52:39.83536-08:00"}
{"id":"markform-103","title":"Create fill command replacing run command","description":"Create the new `fill` command to replace `run`, with support for both mock and live agent modes.\n\n**Location:** `cli/commands/fill.ts`\n\n**New flags:**\n- `--agent \u003ctype\u003e` - Agent type: `mock` | `live` (default: `live`)\n- `--model \u003cid\u003e` - Model ID (format: `provider/model-name`, default: `anthropic/claude-sonnet-4-5`)\n- `--completed-mock \u003cfile\u003e` - Required for `--agent=mock`\n- `-o, --output \u003cfile\u003e` - Output file (default: versioned filename)\n- Existing flags: `--record`, `--max-turns`, `--max-patches`, `--max-issues`\n\n**Changes:**\n1. Copy `run.ts` to `fill.ts`\n2. Add `--agent` flag with validation\n3. Add `--model` flag (ignored for mock mode)\n4. Use versioning.ts for default output filename\n5. Update CLI registration in `cli.ts`\n6. Delete `run.ts`\n7. Update tests to use `fill` command\n\n**Error handling:**\n- `--agent=mock` without `--completed-mock` shows helpful error\n- `--agent=live` without API key shows helpful error (deferred to live agent impl)\n\n**Part of:** markform-101 (fill command)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:15:14.653889-08:00","updated_at":"2025-12-23T13:21:09.090879-08:00","closed_at":"2025-12-23T13:21:09.090879-08:00","dependencies":[{"issue_id":"markform-103","depends_on_id":"markform-102","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-104","title":"Create model registry and resolution in lib/models.ts","description":"Create consolidated model handling module for CLI, harness, and tests.\n\n**Location:** `lib/models.ts`\n\n**Model Registry:**\n- `ModelInfo` type: `{ id, provider, modelName, displayName }`\n- `MODEL_REGISTRY` array with all supported models\n- `SUPPORTED_PROVIDERS`: `['openai', 'anthropic', 'google', 'xai', 'deepseek']`\n- `DEFAULT_MODEL`: `'anthropic/claude-sonnet-4-5'`\n\n**Supported Models:**\n| Provider | Models |\n|----------|--------|\n| openai | gpt-5, gpt-5-mini, gpt-5-nano, gpt-5.1, gpt-5-pro, gpt-5.2, gpt-5.2-pro |\n| anthropic | claude-opus-4-5, claude-opus-4-1, claude-sonnet-4-5, claude-sonnet-4-0, claude-haiku-4-5 |\n| google | gemini-2.5-pro, gemini-2.5-flash, gemini-2.0-flash, gemini-2.0-flash-lite, gemini-3-pro-preview |\n| xai | grok-4, grok-4-fast |\n| deepseek | deepseek-chat, deepseek-reasoner |\n\n**Parsing \u0026 Resolution:**\n- `parseModelId(input)` → `{ provider, modelName }`\n- `resolveShortName(shortName)` → full ID if unique, null otherwise\n- `getModelInfo(modelId)` → ModelInfo or undefined\n- `listModels(provider?)` → array for CLI help\n\n**Provider Loading:**\n- `createModel(modelId)` → Promise\u003cLanguageModel\u003e via dynamic import\n- Clear errors for: provider not installed, model not in registry\n\n**Tests:** `lib/models.test.ts`\n\n**Part of:** markform-101 (fill command)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:15:38.490894-08:00","updated_at":"2025-12-23T13:21:09.090916-08:00","closed_at":"2025-12-23T13:21:09.090916-08:00"}
{"id":"markform-105","title":"Implement LiveAgent class using AI SDK","description":"Implement the LiveAgent class that uses Vercel AI SDK to generate patches via LLM.\n\n**Location:** `harness/liveAgent.ts`\n\n**Interface:** Implements `Agent` interface from `mockAgent.ts`:\n```typescript\ninterface Agent {\n  generatePatches(\n    issues: InspectIssue[],\n    form: ParsedForm,\n    maxPatches: number\n  ): Promise\u003cPatch[]\u003e;\n}\n```\n\n**Implementation:**\n- Constructor takes `LiveAgentConfig`: `{ model, maxStepsPerTurn, systemPrompt? }`\n- Uses `generateText` from AI SDK with Markform tools\n- Builds context prompt with form state, issues, field types\n- Extracts patches from tool call results\n- Handles rate limits and API errors gracefully (retry with backoff)\n\n**AI SDK Integration:**\n- Uses existing tools from `integrations/ai-sdk.ts`\n- `maxSteps` controls agentic loop iterations per turn\n- Session store tracks form state across tool calls\n\n**Error Handling:**\n- API key missing → clear error with env var name\n- Rate limit → exponential backoff retry\n- Model error → surface error message to user\n\n**Tests:** Mock AI SDK responses for unit tests\n\n**Part of:** markform-101 (fill command)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:15:55.647472-08:00","updated_at":"2025-12-23T13:21:09.09092-08:00","closed_at":"2025-12-23T13:21:09.09092-08:00","dependencies":[{"issue_id":"markform-105","depends_on_id":"markform-104","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-106","title":"Wire up live agent mode in fill command","description":"Connect LiveAgent to the fill command for `--agent=live` mode.\n\n**Changes to `fill.ts`:**\n1. Parse `--model` flag using `lib/models.ts`\n2. Resolve short model names to full IDs\n3. Create model instance via `createModel()`\n4. Instantiate `LiveAgent` with model\n5. Run harness loop with live agent\n6. Display real-time progress (turn number, issues remaining)\n7. Record session transcript\n8. Write output using versioned filename or `-o` path\n\n**Flow:**\n```\nfill.ts\n  → parseModelId / resolveShortName (lib/models.ts)\n  → createModel (lib/models.ts) \n  → new LiveAgent (harness/liveAgent.ts)\n  → harness.step() / harness.apply() loop\n  → versioned output (cli/lib/versioning.ts)\n```\n\n**Error handling:**\n- Model not found → list similar models\n- Provider not installed → show install command\n- API key missing → show env var name\n\n**Manual testing:**\n- `markform fill examples/simple/simple.form.md --agent=live`\n- Verify form fills correctly with real LLM\n\n**Part of:** markform-101 (fill command)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:16:10.631513-08:00","updated_at":"2025-12-23T13:21:09.090924-08:00","closed_at":"2025-12-23T13:21:09.090924-08:00","dependencies":[{"issue_id":"markform-106","depends_on_id":"markform-105","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-106","depends_on_id":"markform-103","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-107","title":"Update documentation for fill command and live agent","description":"Update all documentation to reflect the new fill command and live agent support.\n\n**Architecture Doc** (`arch-markform-design.md.md`):\n- Replace all `run` references with `fill`\n- Update CLI command table (7 commands)\n- Add `--agent` and `--model` documentation\n- Update Live Mode section with actual implementation\n- Add model ID format documentation (`provider/model-name`)\n- Document short name resolution\n\n**Development Guide** (`development.md`):\n- Update CLI usage examples with `fill` command\n- Add live agent setup instructions\n- Document provider package installation\n- Add API key environment variable reference\n\n**README**:\n- Update quick start with `fill` command\n- Add live agent example\n- Document supported models\n\n**Validation Spec** (`valid-2025-12-22-markform-v01-implementation.md`):\n- Update test commands from `run` to `fill`\n- Add live agent manual testing section\n\n**Part of:** markform-101 (fill command)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:16:32.913937-08:00","updated_at":"2025-12-23T13:42:05.353475-08:00","closed_at":"2025-12-23T13:42:05.353475-08:00","dependencies":[{"issue_id":"markform-107","depends_on_id":"markform-106","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-108","title":"CLI help should show general flags alongside subcommand-specific flags","description":"When running `markform export --help`, it should show:\n1. General flags that apply to the subcommand (e.g., --no-color, --quiet)\n2. Subcommand-specific flags (e.g., --format for export)\n\n**Research needed:**\n- How to handle `markdown` as a format option for export (makes sense there)\n- Other commands only support console/plaintext/yaml/json - not markdown\n- Need a clean way to define format options per-command\n\n**Current behavior:** Unknown - needs investigation\n**Expected behavior:** Help shows all applicable flags grouped appropriately","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:40:20.125881-08:00","updated_at":"2025-12-23T13:54:26.664939-08:00","closed_at":"2025-12-23T13:54:26.664939-08:00"}
{"id":"markform-109","title":"Implement code coverage reporting with Vitest v8","description":"Implement code coverage reporting for the markform project using Vitest with @vitest/coverage-v8.\n\n**Reference:** docs/general/research/research-code-coverage-typescript.md\n\n**Implementation:**\n1. Install @vitest/coverage-v8\n2. Configure vitest.config.ts with coverage settings:\n   - Provider: v8\n   - Reporters: text, text-summary, html, json, lcov\n   - Exclude: generated files, .d.ts, test files, config files, dist, node_modules\n   - Include: src/**/*.ts\n3. Set initial thresholds (starting targets):\n   - Statements: 70%\n   - Branches: 65%\n   - Functions: 70%\n   - Lines: 70%\n4. Add package.json scripts:\n   - test:coverage\n   - test:coverage:html (for local dev review)\n5. Add coverage/ to .gitignore\n\n**Notes:**\n- Branch coverage is especially important for TypeScript (union types, optional chaining, type guards)\n- Don't aim for 100% - 80-90% is the target range","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:42:24.048428-08:00","updated_at":"2025-12-23T17:17:10.912338-08:00","closed_at":"2025-12-23T17:17:10.912338-08:00"}
{"id":"markform-110","title":"Review coverage reports and improve test coverage","description":"After code coverage is implemented (markform-109), review the HTML coverage reports and identify areas for improvement.\n\n**Workflow:**\n1. Run `pnpm test:coverage:html`\n2. Open coverage/index.html in browser\n3. Identify:\n   - Uncovered critical paths (public APIs, error handling, validation)\n   - Dead code that can be removed\n   - Missing edge case tests (especially branches)\n4. Create follow-up tasks or fix directly\n\n**Priority areas (from research):**\n- High: Public API functions, error handling, business logic, validation\n- Medium: Internal utilities, config parsing\n- Lower: Debug utilities (can be excluded)\n\n**Goal:** Get to 80%+ coverage on statements/functions/lines, 75%+ on branches","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T13:42:25.983534-08:00","updated_at":"2025-12-24T05:36:42.794650989Z","closed_at":"2025-12-24T05:36:42.794650989Z","dependencies":[{"issue_id":"markform-110","depends_on_id":"markform-109","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-111","title":"Add dump command for extracting form values","description":"Add a `dump` command that outputs only the values portion of a form (subset of inspect).\n\n## Usage\n```\nmarkform dump \u003cfile\u003e [--format=\u003cfmt\u003e]\n```\n\n## Output Formats\n\n| Format | Description |\n|--------|-------------|\n| `console` (default) | Colored output, field ID with formatted value per line |\n| `plaintext` | Same as console, no colors (suitable for piping) |\n| `yaml` | Standard YAML serialization of the values map |\n| `json` | Standard JSON serialization of the values map |\n\n## Output Structure\n\n**JSON/YAML output**: Raw `Record\u003cstring, FieldValue\u003e` map (same structure as `form.valuesByFieldId`)\n\n**Console/Plaintext output**: Pretty-printed list\n```\nname: \"Alice Johnson\"\nage: 32\ncategories: [frontend, backend]\ntasks_simple: read_guidelines:done, agree_terms:done\n```\n\n## Implementation\n\n1. Create `packages/markform/src/cli/commands/dump.ts`\n2. Reuse `parseForm()` to get the form\n3. Extract `form.valuesByFieldId` directly (no need for full `inspect()`)\n4. Reuse `formatFieldValue()` helper from inspect for console/plaintext\n5. Use existing `formatOutput` infrastructure with format handling\n6. Register command in `cli.ts`\n\n## Notes\n- Unlike `inspect`, this command is lightweight - no validation, no progress computation\n- Useful for quick value extraction, scripting, and integration with other tools","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T13:50:29.507079-08:00","updated_at":"2025-12-23T14:11:11.144598-08:00","closed_at":"2025-12-23T14:11:11.144598-08:00"}
{"id":"markform-112","title":"Update CLI documentation to include dump command","description":"Update all CLI documentation to include the new dump command.\n\n## Files to Update\n- `docs/cli.md` - Add dump command section with usage examples\n- `README.md` - Add dump to CLI commands list (if applicable)\n- Any other relevant docs\n\n## Content to Add\n- Command syntax: `markform dump \u003cfile\u003e [--format=\u003cfmt\u003e]`\n- Output format options (console, plaintext, yaml, json)\n- Example output for each format\n- Use cases (quick value extraction, scripting, integration)\n\n## Depends On\n- markform-111 (Add dump command for extracting form values)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:51:02.502363-08:00","updated_at":"2025-12-23T14:11:11.144636-08:00","closed_at":"2025-12-23T14:11:11.144636-08:00","dependencies":[{"issue_id":"markform-112","depends_on_id":"markform-111","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-113","title":"Implement -o/--output flag for fill command","description":"The fill command defines a -o/--output flag but doesn't use it. The filled form content should be written to the specified output path, or to a versioned filename if no -o is provided.\n\n## Current Behavior\n- The -o flag is defined in fill.ts but never used\n- Fill command only outputs session transcript, not the form content\n\n## Expected Behavior\n- When -o is specified, write filled form to that path\n- When -o is not specified, use versioned filename (e.g., form-v1.form.md)\n- Use existing versioning logic from cli/lib/versioning.ts\n\n## Files to Modify\n- packages/markform/src/cli/commands/fill.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T14:05:41.346511-08:00","updated_at":"2025-12-23T14:11:11.14464-08:00","closed_at":"2025-12-23T14:11:11.14464-08:00"}
{"id":"markform-114","title":"Integrate versioned filename logic into fill command","description":"The versioning logic exists in cli/lib/versioning.ts but is not integrated into the fill command output. When no -o flag is provided, the fill command should automatically generate a versioned output filename.\n\n## Current Behavior\n- Versioning logic exists and is tested\n- Fill command doesn't use it\n\n## Expected Behavior\n- Fill command uses getVersionedFilename() when -o not specified\n- Output goes to form-v1.form.md, form-v2.form.md, etc.\n\n## Depends On\n- markform-113 (Implement -o/--output flag for fill command)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T14:05:42.231089-08:00","updated_at":"2025-12-23T14:11:11.144643-08:00","closed_at":"2025-12-23T14:11:11.144643-08:00","dependencies":[{"issue_id":"markform-114","depends_on_id":"markform-113","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-115","title":"DOCS-001: Align CLI defaults and flag names across all docs","description":"Batch of consistency fixes across architecture, plans, and development guide:\n\n**Changes:**\n- Change `--mock-source` → `--completed-mock` in architecture doc (lines 2182, 2428-2430) and development.md (line 180)\n- Unify `max_turns` default to 100 everywhere (architecture says 100, fill plan CLI says 50)\n- Add `DEFAULT_MAX_TURNS = 100` to `packages/markform/src/settings.ts`\n- Document mapping between `--max-patches` (CLI) and `max_patches_per_turn` (config/YAML), or rename CLI flag to `--max-patches-per-turn`\n- Standardize model example to `anthropic/claude-sonnet-4-5` everywhere (development.md line 295 shows `claude-sonnet-4-20250514`)\n\n**Files:**\n- packages/markform/src/settings.ts\n- docs/project/architecture/current/arch-markform-design.md.md\n- docs/development.md\n- docs/project/specs/active/plan-2025-12-23-fill-command-live-agent.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T14:13:47.67998-08:00","updated_at":"2025-12-23T17:26:46.224018-08:00","closed_at":"2025-12-23T17:26:46.224018-08:00"}
{"id":"markform-116","title":"ARCH-014: Fix broken HTML comment rendering in process=false section","description":"The architecture doc has a rendering bug at lines 588-596 where a blockquote splits around an HTML comment example.\n\n**Current (broken):**\n```\n\u003e **Note:** Markdoc uses HTML comments (`\n\u003c!-- ... --\u003e\n`), not `{# ... #}`. HTML comments\n\u003e in form values are plain text...\n```\n\n**Fix to inline format:**\n```\n\u003e **Note:** Markdoc uses HTML comments (`\u003c!-- ... --\u003e`), not `{# ... #}`. HTML comments in form values are plain text and don't require `process=false`.\n```\n\n**Files:**\n- docs/project/architecture/current/arch-markform-design.md.md (lines 588-596)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T14:14:15.753812-08:00","updated_at":"2025-12-23T17:14:55.355208-08:00","closed_at":"2025-12-23T17:14:55.355208-08:00"}
{"id":"markform-117","title":"ARCH-015: Define default doc block kind and clarify uniqueness","description":"Clarify documentation block behavior when `kind` attribute is omitted.\n\n**Changes:**\n- Specify that when `kind` is omitted, it defaults to `'notes'`\n- Update uniqueness constraint text at lines 245-247 and 418-424\n- Update `DocumentationBlock` type to show `kind` has a default value\n\nThis prevents accidental duplicate doc blocks and clarifies serialization behavior.\n\n**Files:**\n- docs/project/architecture/current/arch-markform-design.md.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T14:14:21.944842-08:00","updated_at":"2025-12-23T17:15:32.503091-08:00","closed_at":"2025-12-23T17:15:32.503091-08:00"}
{"id":"markform-118","title":"ARCH-016: Document harness error behavior and exit codes","description":"Add explicit documentation for harness error behavior to aid testability.\n\n**Changes:**\n- In Harness section, specify the returned status when `max_turns` is exceeded\n- Document CLI exit code behavior (non-zero exit on failure)\n- Add error state description for integration testing\n\n**Files:**\n- docs/project/architecture/current/arch-markform-design.md.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T14:14:27.152354-08:00","updated_at":"2025-12-23T17:15:57.838602-08:00","closed_at":"2025-12-23T17:15:57.838602-08:00"}
{"id":"markform-119","title":"FILL-001: Add models command for model discovery","description":"Add a new CLI subcommand to list available models from the registry.\n\n**Usage:**\n```bash\nmarkform models              # List all available models\nmarkform models --provider anthropic  # Filter by provider\n```\n\n**Benefits:**\n- Single source of truth for model availability\n- Docs don't drift from code\n- Can add test that asserts docs' 'Supported Models' table matches MODEL_REGISTRY\n\n**Files:**\n- packages/markform/src/cli/commands/models.ts (new)\n- packages/markform/src/cli/cli.ts (register command)\n- packages/markform/src/harness/modelResolver.ts (expose registry)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T14:14:35.105536-08:00","updated_at":"2025-12-23T15:50:11.580914-08:00","closed_at":"2025-12-23T15:50:11.580914-08:00"}
{"id":"markform-120","title":"FILL-002: Specify retry/backoff policy for live agent","description":"Define and document the retry/backoff strategy for live agent API calls.\n\n**Spec to add:**\n- Retry on 429 (rate limit) and 503 (service unavailable)\n- Exponential backoff with jitter\n- Max 3 retries, max 30s total wait\n- Toggle to disable retries for fast tests\n\n**Implementation:**\n- Add retry wrapper in liveAgent.ts\n- Unit tests for retry behavior\n- Document in fill command plan\n\n**Files:**\n- docs/project/specs/active/plan-2025-12-23-fill-command-live-agent.md\n- packages/markform/src/harness/liveAgent.ts","status":"future","priority":4,"issue_type":"task","created_at":"2025-12-23T14:14:42.356168-08:00","updated_at":"2025-12-24T05:22:26.564998464Z"}
{"id":"markform-121","title":"FILL-003: Improve provider installation error messages","description":"Improve error messages when AI SDK provider package is not installed.\n\n**Error should include:**\n- Provider name\n- Install command suggestion (e.g., `pnpm add @ai-sdk/anthropic`)\n- Current `--model` argument value\n\n**Also verify:**\n- Env var names match AI SDK expectations (`GOOGLE_GENERATIVE_AI_API_KEY` vs `GOOGLE_API_KEY`)\n\n**Files:**\n- packages/markform/src/harness/liveAgent.ts\n- packages/markform/src/harness/modelResolver.ts","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T14:14:49.304615-08:00","updated_at":"2025-12-24T01:55:47.599108046Z","closed_at":"2025-12-24T01:55:47.599108046Z"}
{"id":"markform-122","title":"POLITICAL-001: Improve political-figure form spec","description":"Batch of improvements to the political-figure test plan.\n\n**Changes:**\n- Add explicit date pattern validation: `pattern=\"^\\\\d{4}-\\\\d{2}-\\\\d{2}$\"` for date fields\n- Document that `term_end` allows 'Incumbent' OR date (how to handle validation)\n- Add source citation fields (`sources` string-list with format validation)\n- Add note about repeating groups coming in v0.2\n- Add word limit guidance for agent-generated text fields\n\n**Files:**\n- docs/project/specs/active/plan-2025-12-23-political-figure-live-agent-test.md","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T14:14:57.14264-08:00","updated_at":"2025-12-24T01:57:23.181630271Z","closed_at":"2025-12-24T01:57:23.181630271Z"}
{"id":"markform-123","title":"TEST-001: Add unit tests for doc block and validation edge cases","description":"Add unit tests for edge cases identified in architecture review.\n\n**Test cases:**\n- Doc block uniqueness with defaulted `kind`\n- `process=false` emission tests (emits when value contains `{%`, doesn't emit otherwise)\n- Patch structural validation rejects unknown option IDs\n- Patch batch rejection is transactional (all or nothing)\n\n**Files:**\n- packages/markform/tests/unit/\n\n**Linked:** Blocks markform-110 (Review coverage reports and improve test coverage)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T14:15:04.132955-08:00","updated_at":"2025-12-24T05:34:32.903847426Z","closed_at":"2025-12-24T05:34:32.903847426Z","dependencies":[{"issue_id":"markform-123","depends_on_id":"markform-110","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-124","title":"TEST-002: Add golden tests for field type edge cases","description":"Add golden tests for field type edge cases identified in architecture review.\n\n**Test cases:**\n- Checkboxes multi-state transitions in required fields\n- Simple-mode `minDone` threshold behavior\n- `single_select` exactly-one semantics\n- `string_list` `uniqueItems` duplicate rejection\n- Serialization determinism via sha256 comparison\n\n**Files:**\n- packages/markform/tests/golden/\n\n**Linked:** Blocks markform-110 (Review coverage reports and improve test coverage)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T14:15:09.91636-08:00","updated_at":"2025-12-24T05:36:42.681879392Z","closed_at":"2025-12-24T05:36:42.681879392Z","dependencies":[{"issue_id":"markform-124","depends_on_id":"markform-110","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-125","title":"TEST-003: Add CLI and live agent mock tests","description":"Add CLI and live agent tests identified in architecture review.\n\n**Test cases:**\n- Verify help output shows aligned defaults and flags\n- Test `markform models` prints registry contents (after FILL-001)\n- Test uninstalled provider error message is actionable\n- Mock AI SDK to test tool call sequences\n- Test patch extraction correctness\n- Test early stop when `max_turns` or `max_patches_per_turn` reached\n\n**Files:**\n- packages/markform/tests/unit/\n\n**Linked:** Blocks markform-110 (Review coverage reports and improve test coverage)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T14:15:16.674036-08:00","updated_at":"2025-12-24T05:36:42.736499698Z","closed_at":"2025-12-24T05:36:42.736499698Z","dependencies":[{"issue_id":"markform-125","depends_on_id":"markform-110","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-126","title":"DOCS-002: Small wording and formatting cleanups","description":"Minor documentation polish identified in architecture review.\n\n**Changes:**\n- Check Non-Markform content policy table renders correctly (no stray backticks)\n- Ensure all model examples use consistent format throughout\n- Minor prose cleanups as needed\n\n**Files:**\n- docs/project/architecture/current/arch-markform-design.md.md","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-23T14:15:22.81501-08:00","updated_at":"2025-12-24T01:58:37.283049085Z","closed_at":"2025-12-24T01:58:37.283049085Z"}
{"id":"markform-127","title":"modelResolver rejects xai/deepseek providers despite spec support","description":"## Problem\nThe provider map in `packages/markform/src/harness/modelResolver.ts` only enumerates anthropic, openai, and google. This causes `parseModelId` to reject models like `--model xai/grok-4` or `--model deepseek/deepseek-chat` with \"Unknown provider\" before resolution.\n\n## Expected Behavior\nThe feature spec (docs/project/specs/done/plan-2025-12-23-fill-command-live-agent.md lines 162-168) lists xAI and DeepSeek as supported providers, so the CLI should accept these models.\n\n## Fix\nAdd xai and deepseek to the provider map in modelResolver.ts with appropriate API base URLs and environment variable names.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T14:28:32.081568-08:00","updated_at":"2025-12-23T15:30:38.429487-08:00","closed_at":"2025-12-23T15:30:38.429487-08:00"}
{"id":"markform-128","title":"Rename export 'markdown' format to 'markform', add raw markdown export","description":"## Problem\n\nThe export command's \"markdown\" format (line 47 of export.ts) outputs markform format with markdoc directives like `{% field %}`, not plain readable markdown. This naming is confusing.\n\n## Proposed Changes\n\n### 1. Rename current format: `markdown` → `markform`\nThe current output with markdoc directives should be called `markform` since that's what it actually is—the canonical markform format that can be re-parsed.\n\n### 2. Add new `markdown` format for raw, readable output\nA new \"markdown\" format that outputs plain markdown **without** markdoc directives:\n- Insert filled values inline where they belong\n- Output readable markdown that non-technical users can consume\n- Example: instead of `{% field id=\"name\" value=\"Alice\" /%}`, output `Alice` or `**Name:** Alice`\n\n### Implementation Notes\n\nThe raw markdown output requires heuristics to insert values:\n- Text fields: replace with the value text\n- Single select: show selected option label\n- Multi-select/checkboxes: list selected items\n- Groups: preserve headers, show fields with labels\n\n**NOT round-trippable**: The raw markdown output cannot be parsed back into a form (no schema preserved). This is intentional for v1.\n\n### Future Enhancement (not this issue)\nCould add round-trip support for raw markdown by embedding schema in HTML comments or YAML frontmatter. Track separately if desired.\n\n## Files to Modify\n- `packages/markform/src/cli/commands/export.ts` - Update ExportFormat type, add markdown serializer\n- `packages/markform/src/engine/` - May need new serialize function for raw markdown\n- Tests for both formats","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T14:48:11.682011-08:00","updated_at":"2025-12-24T05:28:17.807887868Z","closed_at":"2025-12-24T05:28:17.807887868Z"}
{"id":"markform-129","title":"ROLE-001: Overwrite mode safety - prevent deadlock and approval destruction","description":"## Problem\nThe overwrite mode (`--mode=overwrite`) can accidentally destroy human approvals and deadlock the form. With `roles=*` or poorly chosen roles, we could clear a user-approval checkpoint and then block all subsequent fields in the same run.\n\n## Why It Matters\n- Safety critical: silently undoing human signoffs is catastrophic for compliance workflows\n- Self-deadlock: clearing a checkpoint then trying to fill blocked fields in the same run\n- Data loss: overwriting roles outside the target role set\n\n## Recommended Fix\n1. Overwrite must only clear values for fields whose `role` is in targetRoles (never clear other roles)\n2. Compute blocking checkpoint against pre-clear state, then perform clears/fills only for returned target field set\n3. Add protective guard: if targetRoles excludes the role of the first incomplete blocking checkpoint, do not clear that checkpoint even if `roles=*` unless `--force-overwrite-blocking` flag is set\n4. Add tests for:\n   - Overwrite on agent-only when first checkpoint is user\n   - Overwrite with `roles=*` and blocking checkpoint\n   - Overwrite that does not regress completion\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (add safety semantics)\n- Implementation: getFieldsToFill() and related helpers","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T15:02:16.004705-08:00","updated_at":"2025-12-23T15:08:46.410858-08:00","closed_at":"2025-12-23T15:08:46.410858-08:00"}
{"id":"markform-130","title":"ROLE-002: Define checkbox completion semantics for blocking gates","description":"## Problem\n`isCheckboxComplete()` is referenced in blocking logic but its 'complete' semantics with `checkboxMode` and `minDone` aren't specified.\n\n## Why It Matters\n- Blocking gates depend on knowing when a checkbox is 'complete'\n- Different modes (all, any, explicit) have different completion criteria\n- Without clear definition, implementations will diverge\n\n## Recommended Fix\nSpecify exactly:\n- `checkboxMode='all'`: complete when all options checked\n- `checkboxMode='any'`: complete when at least one checked (or minDone if specified)\n- `checkboxMode='explicit'`: complete when all options answered (no `[_]` markers)\n- `minDone` override: complete when checkedCount \u003e= minDone\n\nAdd this to the spec and create corresponding tests.\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (add Checkbox Completion Semantics section)\n- Add tests for each completion mode with blocking","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:02:25.90953-08:00","updated_at":"2025-12-23T15:08:46.410896-08:00","closed_at":"2025-12-23T15:08:46.410896-08:00"}
{"id":"markform-131","title":"ROLE-003: Document YAML to TypeScript property name mapping","description":"## Problem\nYAML frontmatter uses snake_case (`role_instructions`, `markform_version`) but TypeScript uses camelCase (`roleInstructions`, `markformVersion`). This is fine but must be explicitly documented to avoid drift.\n\n## Why It Matters\n- Parser/serializer must transform correctly\n- Implementers need clear rules\n- Round-trip serialization must preserve semantics\n\n## Recommended Fix\n1. Declare explicit YAML→TS mapping rules in the spec (snake_case → camelCase)\n2. Add Zod schema transforms to normalize: `markform_version` → `markformVersion`, `role_instructions` → `roleInstructions`\n3. Add tests to assert transform and round-trip serialization behavior\n4. Note that Markdoc attributes use camelCase (e.g., `approvalMode`, not `approval_mode`)\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (add Property Naming Conventions section)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:02:34.813173-08:00","updated_at":"2025-12-23T15:08:46.4109-08:00","closed_at":"2025-12-23T15:08:46.4109-08:00"}
{"id":"markform-132","title":"ROLE-004: Fix inconsistent attribute naming (approval_mode vs approvalMode)","description":"## Problem\nThe spec uses `approval_mode` (snake_case) in the summary section but `approvalMode` (camelCase) elsewhere. Markdoc attributes should consistently use camelCase.\n\n## Evidence\n- Line 51: 'Add `approval_mode` attribute for checkpoint/gate checkboxes'\n- Line 176: 'Attribute: `approvalMode` (camelCase per Markdoc attribute convention)'\n\n## Recommended Fix\n1. Change line 51 to use `approvalMode`\n2. Search entire spec for any other instances of `approval_mode` and fix\n3. Add note in spec that all Markdoc attributes use camelCase\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T15:02:41.316326-08:00","updated_at":"2025-12-23T15:08:46.410904-08:00","closed_at":"2025-12-23T15:08:46.410904-08:00"}
{"id":"markform-133","title":"ROLE-005: CLI safety for user-role fields","description":"## Problem\nNon-interactive fills could target `user` role fields unintentionally, causing poor UX. The spec doesn't protect against accidentally filling user fields with an agent.\n\n## Why It Matters\n- User-role fields are meant for human input\n- Accidentally filling them with agent data defeats the purpose of roles\n- No safeguard in current design\n\n## Recommended Fix\n1. Default behavior: non-interactive fill skips user role fields unless `--include-user-role` is explicitly provided\n2. Interactive mode defaults to `user` role; allow override with `--roles`\n3. Error/warn if `--interactive` + `--roles` includes roles not supported by interactive UI\n4. Add high-visibility warning on `--roles=*` when interactive=false\n5. Document these safeguards in CLI Interface section\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (CLI Interface section)\n- Add acceptance criteria for safety guards","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:02:50.578724-08:00","updated_at":"2025-12-23T15:08:46.410911-08:00","closed_at":"2025-12-23T15:08:46.410911-08:00"}
{"id":"markform-134","title":"ROLE-006: Role normalization and reserved identifiers","description":"## Problem\nRoles are free-form strings; case/whitespace and sentinel clashes may cause bugs (e.g., literal role named '*').\n\n## Why It Matters\n- Role 'Agent' vs 'agent' could cause filtering bugs\n- Whitespace in role names is likely unintentional\n- '*' is reserved for CLI role selection wildcard\n\n## Recommended Fix\n1. Normalize roles on parse and CLI input: trim, toLowerCase, reject/escape whitespace\n2. Reserve '*' strictly for CLI role selection; reject it as a defined role in forms (validation error)\n3. Add Zod refinements: roles must be non-empty, unique, and match pattern [a-z0-9_-]+\n4. Warn on unknown roles in fields vs roles list (already planned), and auto-suggest closest known role in inspect\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (add Role Validation Rules section)\n- Add Zod schema refinements in Architecture section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T15:02:59.807139-08:00","updated_at":"2025-12-23T15:08:46.410914-08:00","closed_at":"2025-12-23T15:08:46.410914-08:00"}
{"id":"markform-135","title":"ROLE-007: Define field clearing semantics per field type","description":"## Problem\nOverwrite mode implies 'clear and re-fill' but behavior per field type (strings, checkboxes, arrays) is not defined.\n\n## Why It Matters\n- Different field types have different 'empty' representations\n- Without clear semantics, implementations will diverge\n- Round-trip behavior must be predictable\n\n## Recommended Fix\nDefine a `clearFieldValue(kind)` table in the spec:\n- `string-field` → empty string\n- `number-field` → null/undefined (pick one consistently)\n- `checkboxes` → all unchecked\n- `single-select` → no selection\n- `array/repeater` → empty list\n- `richtext` → empty doc/empty string\n\nAdd tests per field type.\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (add Field Clearing Semantics section)\n- Add tests for each field type clear behavior","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T15:03:08.068633-08:00","updated_at":"2025-12-23T15:08:46.410917-08:00","closed_at":"2025-12-23T15:08:46.410917-08:00"}
{"id":"markform-136","title":"ROLE-008: Promote inspect role enhancements to Must Have","description":"## Problem\nRole-filtered inspect and blocked field reasoning are listed as 'Nice to Have' but are essential for UX.\n\n## Why It Matters\n- Users need to understand why fields can't be filled\n- Debugging multi-stage workflows requires role filtering\n- Blocked fields need 'blocked by' annotations\n\n## Recommended Fix\n1. Promote to Must Have:\n   - `inspect --roles` (filters issues by role)\n   - Show 'Blocked by: \u003cfieldId\u003e (approvalMode=blocking)' annotations on affected fields\n2. Add acceptance criteria for:\n   - inspect shows blocked field annotations\n   - inspect respects --roles filter\n3. Consider adding:\n   - `--dry-run` to fill to show which fields would be filled/blocked\n   - `--explain` to print why each field is (not) selected\n   - `markform inspect --list-roles` to see available roles\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (move items from Nice to Have to Must Have)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T15:03:17.91998-08:00","updated_at":"2025-12-23T15:08:46.410919-08:00","closed_at":"2025-12-23T15:08:46.410919-08:00"}
{"id":"markform-137","title":"ROLE-009: Role instructions merging and AI SDK integration","description":"## Problem\n1. The spec says role_instructions are passed to the agent but doesn't specify how they combine with global instructions\n2. AI SDK tools don't expose role filtering capabilities\n\n## Why It Matters\n- Prompt composition order affects agent behavior\n- AI SDK tools should support role-aware filling\n- Agents need to know which role they're filling for\n\n## Recommended Fix\n1. Define explicit prompt composition order and precedence:\n   - base form instructions → role_instructions[role] → per-field instructions → system defaults\n2. Add test that correct role_instructions text is present in agent prompt\n3. Allow passing `targetRoles` and `mode` through AI SDK tools\n4. Add tests for AI SDK tool behavior with roles and blocking\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (add Prompt Composition section)\n- Architecture section: extend AI SDK tool parameters","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T15:03:26.931771-08:00","updated_at":"2025-12-23T15:08:46.410922-08:00","closed_at":"2025-12-23T15:08:46.410922-08:00"}
{"id":"markform-138","title":"ROLE-010: Multi-form scoping clarification","description":"## Problem\nThe spec doesn't state whether blocking and role config are per-form or cross-form when a file contains multiple forms.\n\n## Why It Matters\n- Ambiguity could lead to incorrect implementations\n- Cross-form blocking would be surprising and likely unwanted\n- Need to be explicit about scope boundaries\n\n## Recommended Fix\nState explicitly that roles, instructions, and blocking are scoped per `form` tag:\n- Each form has its own roles list and role_instructions\n- Blocking checkpoints only affect fields within the same form\n- No cross-form blocking behavior\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (add clarification in Form Syntax or Background section)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T15:03:33.908429-08:00","updated_at":"2025-12-23T15:08:46.410925-08:00","closed_at":"2025-12-23T15:08:46.410925-08:00"}
{"id":"markform-139","title":"ROLE-011: Add backward compatibility template per workspace rules","description":"## Problem\nCurrent Backward Compatibility section is generic ('Fully backward compatible'). Workspace rules require the full template.\n\n## Why It Matters\n- Workspace rules mandate the specific template format\n- Template helps ensure all compatibility concerns are addressed\n- Provides clear guidance for implementers\n\n## Recommended Fix\nReplace current section with the required template:\n\n**BACKWARD COMPATIBILITY REQUIREMENTS:**\n- **Code types, methods, and function signatures**: [DO NOT MAINTAIN - new feature]\n- **Library APIs**: [DO NOT MAINTAIN - additive changes only]\n- **Server APIs**: [N/A]\n- **File formats**: [SUPPORT BOTH - forms without roles use defaults]\n- **Database schemas**: [N/A]\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (Backward Compatibility section)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T15:03:41.740453-08:00","updated_at":"2025-12-23T15:08:46.410927-08:00","closed_at":"2025-12-23T15:08:46.410927-08:00"}
{"id":"markform-140","title":"ROLE-012: Polish and consistency improvements","description":"## Summary\nGrouped low-priority polish items for spec consistency and quality.\n\n## Items\n\n### Constants Typing\n- Type `DEFAULT_ROLES` as `readonly [typeof USER_ROLE, typeof AGENT_ROLE]`\n- Expose helpers: `normalizeRoles(...)`, `parseRolesFlag(raw: string): string[]`\n\n### Warnings Taxonomy\n- Assign warning/error codes (e.g., MF_ROLE_UNKNOWN, MF_BLOCKING_NONREQUIRED)\n- Allows `inspect` and tests to assert specific diagnostics easily\n\n### Serializer Stability\n- Document that serializer outputs `role` and `approvalMode` only when non-default\n- Add golden snapshot test to ensure stable serialization across versions\n\n### Documentation Cross-references\n- Add short 'Safety' section under CLI describing overwrite protections\n- Document that blocking applies across all roles based on document order\n\n### Explicit Blocking Inclusion\n- Add explicit acceptance criterion: 'the first incomplete blocking checkpoint is included so it can be completed'\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (various sections)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T15:03:52.826847-08:00","updated_at":"2025-12-23T15:08:46.410932-08:00","closed_at":"2025-12-23T15:08:46.410932-08:00"}
{"id":"markform-141","title":"ROLE-013: Additional test plan items for role system","description":"## Summary\nTest plan additions beyond what's already listed in the spec.\n\n## Overwrite Safety Tests\n- [ ] Overwrite does not clear user-role checkpoints when roles exclude `user`\n- [ ] With `roles=*` and `--force-overwrite-blocking` absent, checkpoint not cleared if not in targetRoles\n- [ ] Overwrite that does not regress completion state\n\n## Normalization and Validation Tests\n- [ ] Roles normalization (case/whitespace trimming)\n- [ ] Reject literal '*' role in frontmatter\n- [ ] Role value constraints: non-empty, unique, lowercase pattern\n\n## Prompt Composition Tests\n- [ ] Ensures correct role_instructions precedence in agent prompt\n- [ ] Base form instructions → role instructions → field instructions\n\n## Serializer Stability Tests\n- [ ] Golden snapshot for serialization of role and approvalMode defaults\n- [ ] Round-trip preserves non-default values correctly\n\n## Inspect UX Tests\n- [ ] Blocked fields list includes 'blocked by' annotations\n- [ ] --roles filter works correctly\n- [ ] Shows role scoping in output\n\n## Files to Update\n- docs/project/specs/active/plan-2025-12-23-role-system.md (Phase 5: Tests section)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T15:04:04.076054-08:00","updated_at":"2025-12-23T15:08:46.410934-08:00","closed_at":"2025-12-23T15:08:46.410934-08:00"}
{"id":"markform-142","title":"Remove single-letter CLI flags except -o","description":"## Problem\n\nSingle-letter flags are confusing and should be avoided in most cases. The CLI currently has several short flags that should be removed:\n\n- `-f` for `--format` - confusing, could mean `--file` or `--force`\n- `-h` for `--help` - standard but unnecessary given `--help` is clear\n- `-V` for `--version` - unnecessary\n\n## Keep\n\n- `-o` for `--output` - this is ubiquitous and can stay\n\n## Files to Update\n\n- `packages/markform/src/cli/commands/*.ts` - Remove short flag definitions from Commander option declarations\n- Update any tests that use short flags\n\n## Implementation\n\nSearch for `.option('-f'`, `.option('-h'`, `.option('-V'` patterns and remove the short flag portion, keeping only the long form.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T15:23:09.116479-08:00","updated_at":"2025-12-23T17:34:00.130422-08:00","closed_at":"2025-12-23T17:34:00.130422-08:00"}
{"id":"markform-143","title":"Change versioned output suffix from -v1 to -filled1","description":"Change the versioned output suffix for filled form files from `-v1`, `-v2`, etc. to `-filled1`, `-filled2`, etc.\n\n## Rationale\n- Clearer naming: `simple-filled1.form.md` is more descriptive than `simple-v1.form.md`\n- Avoids confusion with other versioning schemes\n- Allows distinct names while preventing overwrites\n\n## Files to Update\n- `packages/markform/src/cli/lib/versioning.ts` - Change suffix pattern from `-v` to `-filled`\n- Tests in `packages/markform/tests/unit/cli/versioning.test.ts`\n- Any documentation mentioning the `-v1` pattern\n\n## Example\nBefore: `simple.form.md` → `simple-v1.form.md` → `simple-v2.form.md`\nAfter: `simple.form.md` → `simple-filled1.form.md` → `simple-filled2.form.md`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T16:50:51.556262-08:00","updated_at":"2025-12-23T17:14:38.274993-08:00","closed_at":"2025-12-23T17:14:38.274993-08:00"}
{"id":"markform-144","title":"Add groups-per-turn and fields-per-turn harness options","description":"Add CLI flags and API options to control how many groups and fields the agent can fill per conversation turn.\n\n## Approach\n\nThe harness should filter issues **before** giving them to the agent:\n\n1. Inspect form to get priority-ranked list of all issues\n2. Build candidate list by iterating issues in priority order:\n   - Track unique groups and fields seen\n   - Add issue if adding it keeps us within `maxGroupsPerTurn` AND `maxFieldsPerTurn`\n   - Stop once we can't add more without exceeding limits\n3. Give this filtered candidate list to the agent\n\nThis way the agent **never even sees** issues beyond the per-turn limits.\n\n## Current Behavior\n\nThe harness (`packages/markform/src/harness/harness.ts`) currently has:\n- `maxIssues`: 10 - limits issues shown to agent per turn\n- `maxPatchesPerTurn`: 20 - limits patches agent can submit per turn\n- `maxTurns`: 50 - limits total turns\n\n## Proposed New Options\n\n### `maxFieldsPerTurn` (default: unlimited)\n- Limits issues to only cover N unique fields per turn\n- CLI flag: `--max-fields \u003cn\u003e`\n\n### `maxGroupsPerTurn` (default: unlimited)  \n- Limits issues to only cover N unique groups per turn\n- Requires mapping field refs to their parent groups\n- CLI flag: `--max-groups \u003cn\u003e`\n\n## Implementation\n\n### Issue filtering in `step()`\n```typescript\n// After getting prioritized issues from inspect()\nconst candidateIssues: InspectIssue[] = [];\nconst seenFields = new Set\u003cstring\u003e();\nconst seenGroups = new Set\u003cstring\u003e();\n\nfor (const issue of prioritizedIssues) {\n  const fieldId = getFieldId(issue.ref);\n  const groupId = getGroupForField(fieldId, form);\n  \n  // Check if adding this issue would exceed limits\n  const newField = !seenFields.has(fieldId);\n  const newGroup = !seenGroups.has(groupId);\n  \n  if (newField \u0026\u0026 seenFields.size \u003e= config.maxFieldsPerTurn) continue;\n  if (newGroup \u0026\u0026 seenGroups.size \u003e= config.maxGroupsPerTurn) continue;\n  \n  candidateIssues.push(issue);\n  seenFields.add(fieldId);\n  seenGroups.add(groupId);\n}\n```\n\n### HarnessConfig changes\n```typescript\ninterface HarnessConfig {\n  maxIssues: number;\n  maxPatchesPerTurn: number;\n  maxTurns: number;\n  maxFieldsPerTurn?: number;  // NEW - default unlimited\n  maxGroupsPerTurn?: number;  // NEW - default unlimited\n}\n```\n\n### Files to modify\n- `packages/markform/src/harness/harness.ts` - Filter issues in `step()`\n- `packages/markform/src/engine/types.ts` - Add to HarnessConfig\n- `packages/markform/src/cli/commands/fill.ts` - Add CLI flags\n- `README.md` - Add multi-turn example\n\n## README Example\n\nShow multi-turn filling even with simple form:\n```bash\n# Fill one field at a time (forces multiple turns)\npnpm markform fill examples/simple/simple.form.md \\\n  --agent=live --model=openai/gpt-5.2 \\\n  --max-fields 1\n\n# Fill one group at a time\npnpm markform fill examples/simple/simple.form.md \\\n  --agent=live --model=openai/gpt-5.2 \\\n  --max-groups 1\n```\n\n## Use Cases\n- Pacing: Fill one group/field at a time for complex forms\n- Testing: Verify agent handles incremental fills correctly\n- Debugging: Watch agent progress step by step\n- Cost control: Limit scope of each LLM call","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:23:51.696023-08:00","updated_at":"2025-12-23T17:29:35.359334-08:00","closed_at":"2025-12-23T17:29:35.359334-08:00"}
{"id":"markform-145","title":"Test harness issue filtering for groups/fields per turn","description":"## Overview\n\nAdd unit tests for the issue filtering logic introduced in markform-144. Tests should verify that the harness correctly limits issues by group and field counts before passing to the agent.\n\n## Test Cases\n\n### 1. maxFieldsPerTurn filtering\n- Form with 10 required fields, maxFieldsPerTurn=3 → only 3 issues per step\n- Verify issues are priority-ranked (required before optional)\n- Verify filtering respects existing maxIssues cap\n\n### 2. maxGroupsPerTurn filtering  \n- Form with 3 groups, each with 5 fields, maxGroupsPerTurn=1 → only fields from 1 group per step\n- Verify group selection is deterministic (first incomplete group)\n- Verify fields within group still respect maxFieldsPerTurn\n\n### 3. Combined filtering\n- maxFieldsPerTurn=5, maxGroupsPerTurn=2 → max 5 fields from max 2 groups\n- Test edge case: group has fewer fields than maxFieldsPerTurn\n\n### 4. Turn count verification\n- Create form where filtering should result in predictable turn count\n- Example: 12 fields, maxFieldsPerTurn=4 → should complete in 3 turns (with mock agent)\n- This validates the whole filtering → agent → apply loop\n\n## Implementation Notes\n\n- Use createMockAgent with a fully-filled form as source\n- Mock agent will always produce correct patches for shown issues\n- Count actual turns taken vs expected turns\n- Tests go in packages/markform/src/harness/__tests__/harness.test.ts\n\n## Acceptance Criteria\n- [ ] Tests cover all filtering scenarios above\n- [ ] Tests verify expected turn counts match actual\n- [ ] Tests pass with both defaults and custom limits","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T17:28:10.761109-08:00","updated_at":"2025-12-23T17:32:35.730733-08:00","closed_at":"2025-12-23T17:32:35.730733-08:00","dependencies":[{"issue_id":"markform-145","depends_on_id":"markform-144","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-146","title":"Add --prompt flag to fill command for custom agent instructions","description":"## Problem\n\nThe `LiveAgentConfig` already supports `systemPrompt?: string` but there's no way to set it from the CLI.\n\n## Solution\n\nAdd flags to the `fill` command:\n\n```\n--prompt \u003cfile\u003e         Path to custom system prompt file (overrides form/role defaults)\n--instructions \u003ctext\u003e   Inline system prompt (overrides --prompt and form defaults)\n```\n\n## Behavior\n\n- `--prompt` reads a file and uses its contents as the system prompt\n- `--instructions` takes inline text (useful for simple overrides)\n- `--instructions` takes precedence over `--prompt` if both specified\n- Both override any form-level or role-level instructions\n\n## Files to Modify\n\n- `packages/markform/src/cli/commands/fill.ts` - Add options, pass to createLiveAgent\n- `packages/markform/src/harness/liveAgent.ts` - Already supports `systemPrompt` (no changes needed)\n\n## Spec Reference\n\nOriginally listed as \"Nice to Have\" in fill-command-live-agent spec (line 92).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:39:33.998058-08:00","updated_at":"2025-12-24T05:29:48.239115011Z","closed_at":"2025-12-24T05:29:48.239115011Z"}
{"id":"markform-147","title":"Connect form instructions to live agent prompt composition","description":"## Problem\n\nThe `buildContextPrompt()` function in `liveAgent.ts` doesn't use:\n1. Form-level doc blocks with `kind=\"instructions\"`\n2. Frontmatter `role_instructions` (planned in role-system spec)\n3. Per-field instruction attributes\n\nCurrently it just builds a static prompt from issues.\n\n## Solution\n\nUpdate `buildContextPrompt()` to compose instructions from multiple sources in this order:\n\n1. **Base form instructions** - Doc blocks with `ref` matching form ID and `kind=\"instructions\"`\n2. **Role-specific instructions** - From `role_instructions[targetRole]` in frontmatter\n3. **Per-field instructions** - From field `instructions` attributes (for fields being filled)\n4. **System defaults** - `DEFAULT_ROLE_INSTRUCTIONS[targetRole]` or `DEFAULT_SYSTEM_PROMPT`\n\nLater instructions augment (not replace) earlier ones.\n\n## Dependencies\n\n- **markform-XXX**: Role system implementation (for `role_instructions` frontmatter)\n\n## Files to Modify\n\n- `packages/markform/src/harness/liveAgent.ts` - Update `buildContextPrompt()`\n- `packages/markform/src/engine/types.ts` - May need `FormMetadata` type with `roleInstructions`\n- `packages/markform/src/settings.ts` - Add `DEFAULT_ROLE_INSTRUCTIONS`\n\n## Spec Reference\n\nDefined in role-system spec lines 401-413 (Role Instructions in Agent Prompts).","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T17:39:39.100427-08:00","updated_at":"2025-12-24T05:32:44.188021319Z","closed_at":"2025-12-24T05:32:44.188021319Z"}
{"id":"markform-148","title":"Fix release workflow pnpm version conflict in CI","description":"## Problem\n\nThe release workflow (.github/workflows/release.yml) fails with:\n```\nError: Multiple versions of pnpm specified:\n  - version 10 in the GitHub Action config with the key \"version\"\n  - version pnpm@10.26.1 in the package.json with the key \"packageManager\"\n```\n\n## Solution\n\nRemove the `version: 10` from `pnpm/action-setup@v4` in release.yml to match the pattern used in ci.yml. This lets pnpm/action-setup read the version from package.json's `packageManager` field.\n\n## Files to Modify\n- .github/workflows/release.yml","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-24T01:50:52.239798142Z","updated_at":"2025-12-24T01:52:28.023114653Z","closed_at":"2025-12-24T01:52:28.023114653Z"}
{"id":"markform-149","title":"Implement Role System for Multi-Stage Form Workflows","description":"## Overview\n\nImplement the role-based field assignment system as specified in:\n`docs/project/specs/active/plan-2025-12-23-role-system.md`\n\n## Key Features\n\n1. Form-level `roles` list and `role_instructions` in frontmatter\n2. Field-level `role` attribute (default: \"agent\")\n3. `FillMode` type: \"continue\" | \"overwrite\"\n4. `approvalMode` attribute on checkboxes: \"none\" | \"blocking\"\n5. CLI `--roles` and `--mode` flags on fill command\n6. Blocking checkpoint logic\n7. Role validation and normalization\n\n## Implementation Phases\n\n- Phase 1: Core Types and Settings\n- Phase 2: Parser Updates  \n- Phase 3: Fill Command and Harness Updates\n- Phase 4: Serializer Updates\n- Phase 5: Tests\n\n## Backward Compatibility\n\n- Forms without `roles` default to [\"user\", \"agent\"]\n- Fields without `role` default to \"agent\"\n- Existing CLI usage unchanged","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-24T02:06:39.151890922Z","updated_at":"2025-12-24T04:33:21.747446404Z","closed_at":"2025-12-24T04:33:21.747446404Z"}
{"id":"markform-149.1","title":"Phase 1: Add role types and constants to settings.ts and types.ts","description":"## Goal\nAdd all type definitions and constants without breaking existing code.\n\n## Changes to settings.ts\n- Add `AGENT_ROLE`, `USER_ROLE`, `DEFAULT_ROLES` constants\n- Add `DEFAULT_ROLE_INSTRUCTIONS` record\n- Add `ROLE_NAME_PATTERN` regex\n- Add `RESERVED_ROLE_NAMES` array\n- Add `normalizeRole()` helper function\n- Add `parseRolesFlag()` helper function\n\n## Changes to types.ts\n- Add `FillMode` type: 'continue' | 'overwrite'\n- Add `ApprovalMode` type: 'none' | 'blocking'\n- Add `FormMetadata` interface with roles and roleInstructions\n- Add `role: string` to FieldBase interface\n- Add `approvalMode: ApprovalMode` to CheckboxesField interface\n- Add optional `metadata?: FormMetadata` to ParsedForm\n- Add `blockedBy?: Id` to InspectIssue interface\n- Add Zod schemas for all new types\n- Update field Zod schemas to include role\n\n## Files\n- packages/markform/src/settings.ts\n- packages/markform/src/engine/types.ts\n\n## Acceptance\n- All new types have Zod schemas\n- Existing code still compiles (types are additive)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T02:06:56.221837598Z","updated_at":"2025-12-24T02:43:03.185552751Z","closed_at":"2025-12-24T02:43:03.185552751Z","dependencies":[{"issue_id":"markform-149.1","depends_on_id":"markform-149","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-149.2","title":"Phase 2: Update parser to extract roles from frontmatter and fields","description":"## Goal\nParse roles from YAML frontmatter and field attributes.\n\n## Changes to parse.ts\n- Update frontmatter parsing to extract `roles` and `role_instructions`\n- Apply `DEFAULT_ROLES` when not specified\n- Extract `role` attribute from all field types, default to `AGENT_ROLE`\n- Extract `approvalMode` from checkbox fields, default to 'none'\n- Add parse error if `approvalMode` used on non-checkbox field\n- Add validation warning for role not in form's roles list\n- Add warning if `approvalMode=\"blocking\"` but `required=false`\n- Return `metadata` in ParsedForm\n\n## Dependencies\n- Uses constants from settings.ts (Phase 1)\n- Uses types from types.ts (Phase 1)\n\n## Files\n- packages/markform/src/engine/parse.ts\n\n## Tests\n- Test parsing roles from frontmatter\n- Test parsing role_instructions\n- Test default role assignment (agent)\n- Test role parsing from field attributes\n- Test approvalMode parsing on checkboxes\n- Test error on approvalMode on non-checkbox fields","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T02:07:11.929933455Z","updated_at":"2025-12-24T02:43:03.2379688Z","closed_at":"2025-12-24T02:43:03.2379688Z","dependencies":[{"issue_id":"markform-149.2","depends_on_id":"markform-149.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-149.2","depends_on_id":"markform-149","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-149.3","title":"Phase 3: Update inspect for role filtering and blocking checkpoints","description":"## Goal\nFilter issues by role and detect blocking checkpoints in inspect.\n\n## Changes to inspect.ts\n- Add `isCheckboxComplete()` helper (checks completion based on checkboxMode)\n- Add `findBlockingCheckpoint()` helper (finds first incomplete blocking checkbox)\n- Add `getBlockedFieldIds()` helper (fields after blocking checkpoint)\n- Add `targetRoles?: string[]` to InspectOptions\n- Update `inspect()` to filter issues by target roles\n- Add \"blocked by\" annotations to blocked field issues\n- Update InspectIssue to include `blockedBy?: Id`\n\n## Checkbox Completion Semantics\n- mode='all': all options checked\n- mode='any': at least one (or minDone) checked\n- mode='explicit': no 'unfilled' values remain\n\n## Files\n- packages/markform/src/engine/inspect.ts\n\n## Tests\n- Test role filtering in inspect\n- Test blocking checkpoint detection  \n- Test \"blocked by\" annotations\n- Test checkbox completion semantics (all/any/explicit modes)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T02:07:27.996466369Z","updated_at":"2025-12-24T02:47:44.793897583Z","closed_at":"2025-12-24T02:47:44.793897583Z","dependencies":[{"issue_id":"markform-149.3","depends_on_id":"markform-149","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-149.3","depends_on_id":"markform-149.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-149.4","title":"Phase 4: Update fill command and harness for role-based filling","description":"## Goal\nAdd CLI flags and integrate role filtering into the harness.\n\n## CLI Changes (fill.ts)\n- Add `--roles \u003croles\u003e` option (comma-separated or '*')\n- Add `--mode \u003cmode\u003e` option ('continue' | 'overwrite')\n- Add `--dry-run` option\n- Update `--interactive` to default to USER_ROLE\n- Show warning when `--roles=*` in non-interactive mode\n\n## Harness Changes (harness.ts)\n- Add `targetRoles?: string[]` to HarnessConfig\n- Add `fillMode?: FillMode` to HarnessConfig\n- Update step() to filter issues by role\n- Update step() to respect blocking checkpoints\n\n## LiveAgent Changes (liveAgent.ts)\n- Update `buildContextPrompt()` to include role_instructions\n- Compose instructions from: role defaults → form instructions → role instructions\n\n## Files\n- packages/markform/src/cli/commands/fill.ts\n- packages/markform/src/harness/harness.ts\n- packages/markform/src/harness/liveAgent.ts\n\n## Tests\n- Test --roles flag parsing\n- Test --mode=continue skips filled fields\n- Test blocking checkpoint prevents filling subsequent fields","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T02:07:43.023955859Z","updated_at":"2025-12-24T02:54:59.199988019Z","closed_at":"2025-12-24T02:54:59.199988019Z","dependencies":[{"issue_id":"markform-149.4","depends_on_id":"markform-149","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-149.4","depends_on_id":"markform-149.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-149.5","title":"Phase 5: Update serializer to output role and approvalMode","description":"## Goal\nOutput role and approvalMode attributes when non-default in serialized output.\n\n## Changes to serialize.ts\n- Update field serialization to include `role` when != AGENT_ROLE\n- Update checkboxes serialization to include `approvalMode` when != 'none'\n- Update frontmatter serialization to include:\n  - `roles` list when != DEFAULT_ROLES\n  - `role_instructions` when present\n\n## Serialization Rules\n- Attributes only output when non-default (keeps forms clean)\n- Role order: alphabetical with other attributes via serializeAttrs()\n- Frontmatter uses snake_case (role_instructions)\n\n## Files\n- packages/markform/src/engine/serialize.ts\n\n## Tests\n- Test role attribute only output when non-default\n- Test approvalMode attribute only output when non-default\n- Test frontmatter with roles and role_instructions\n- Test round-trip stability (parse -\u003e serialize -\u003e parse)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T02:07:57.097954279Z","updated_at":"2025-12-24T02:55:03.420569764Z","closed_at":"2025-12-24T02:55:03.420569764Z","dependencies":[{"issue_id":"markform-149.5","depends_on_id":"markform-149.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-149.5","depends_on_id":"markform-149","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-149.6","title":"Phase 6: Update inspect CLI to show role info and blocked fields","description":"## Goal\nUpdate inspect CLI to support role filtering and display blocked field info.\n\n## Changes to inspect.ts (CLI command)\n- Add `--roles \u003croles\u003e` flag to filter issues by role\n- Update console output to show \"Blocked by: fieldId\" annotations\n- Optionally show role of each field in output\n\n## Files\n- packages/markform/src/cli/commands/inspect.ts\n\n## Tests\n- Test --roles flag works correctly\n- Test blocked fields display \"Blocked by\" annotation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:08:08.231102661Z","updated_at":"2025-12-24T04:27:50.489166772Z","closed_at":"2025-12-24T04:27:50.489166772Z","dependencies":[{"issue_id":"markform-149.6","depends_on_id":"markform-149.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-149.6","depends_on_id":"markform-149","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-149.7","title":"Phase 7: Update example forms to use role system","description":"## Goal\nUpdate bundled examples to demonstrate the role system.\n\n## Forms to Update\n1. simple.form.md - Add `role=\"user\"` to 1-2 fields\n2. political-figure.form.md - Add `role=\"user\"` to name field\n3. earnings-analysis.form.md (if exists) - Add user role to company identifier fields\n\n## Changes per Form\n- Add `roles: [user, agent]` to frontmatter\n- Add `role_instructions` for each role\n- Add `role=\"user\"` to context/seed fields\n\n## Files\n- packages/markform/examples/simple/simple.form.md\n- Other example forms\n\n## Acceptance\n- Each example parses correctly with role attributes\n- Two-stage workflow works: `fill --interactive` then `fill`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T02:08:22.570343421Z","updated_at":"2025-12-24T04:33:21.693103538Z","closed_at":"2025-12-24T04:33:21.693103538Z","dependencies":[{"issue_id":"markform-149.7","depends_on_id":"markform-149","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-149.7","depends_on_id":"markform-149.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-149.7","depends_on_id":"markform-149.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-150","title":"Implement examples CLI command","description":"Implement the `examples` CLI command per plan-2025-12-23-examples-cli-command.md.\n\nThis command provides a menu-driven console UI for users to discover and scaffold example forms into their current working directory.\n\n**Key Features:**\n- Interactive selection menu with 3 bundled examples\n- Editable filename prompt (pre-filled with default)\n- Overwrite confirmation if file exists\n- Display suggested next commands after writing\n- `--list` flag for non-interactive listing\n- `--name \u003cexample\u003e` flag to skip selection\n\n**Prerequisites:** Role System (done), Interactive Fill Mode (done), Political Research Example Form (needs to be created)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T22:17:39.900934-08:00","updated_at":"2025-12-24T07:00:00.498821586Z","closed_at":"2025-12-24T07:00:00.498821586Z","dependencies":[{"issue_id":"markform-150","depends_on_id":"markform-154","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-151","title":"Create political-research.form.md example","description":"Create the political-research.form.md example form per plan-2025-12-23-political-research-example.md.\n\nThis is a comprehensive example form for researching political figures via web search. It demonstrates:\n- Role-based field assignment (name field with role=\"user\")\n- Multiple field types (strings, lists, dates)\n- Repeating groups pattern (3 office slots)\n- Agent instructions for web research\n\n**Phases:**\n1. Create form template with all fields\n2. Create mock Lincoln form for testing\n3. Integrate with examples CLI command\n\n**Spec:** docs/project/specs/active/plan-2025-12-23-political-research-example.md","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T22:18:04.889549-08:00","updated_at":"2025-12-24T06:47:56.943547233Z","closed_at":"2025-12-24T06:47:56.943547233Z","dependencies":[{"issue_id":"markform-151","depends_on_id":"markform-155","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-151","depends_on_id":"markform-156","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-152","title":"Create example content modules (src/cli/examples/)","description":"Create the example content modules that export form content as string constants.\n\nFiles to create:\n- src/cli/examples/simple.ts - Export SIMPLE_FORM_CONTENT from existing simple.form.md\n- src/cli/examples/earnings-analysis.ts - Export EARNINGS_ANALYSIS_CONTENT from existing form\n- src/cli/examples/political-research.ts - Export POLITICAL_RESEARCH_CONTENT (depends on form being created)\n- src/cli/examples/index.ts - EXAMPLES registry array with ExampleDefinition interface\n\nInterface:\ninterface ExampleDefinition {\n  id: string;\n  title: string;\n  description: string;\n  filename: string;\n  content: string;\n}","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:18:05.479345-08:00","updated_at":"2025-12-24T06:51:09.865185286Z","closed_at":"2025-12-24T06:51:09.865185286Z","dependencies":[{"issue_id":"markform-152","depends_on_id":"markform-151","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-153","title":"Implement examples command with interactive selection","description":"Create src/cli/commands/examples.ts with interactive menu.\n\nFeatures to implement:\n1. Interactive selection using @clack/prompts.select()\n2. Filename prompt using @clack/prompts.text() with default value\n3. File existence check and overwrite confirmation using @clack/prompts.confirm()\n4. Success message with three-step workflow (interactive fill, agent fill, dump)\n5. --list flag for non-interactive listing\n6. --name \u003cexample\u003e flag to skip selection (still prompts for filename)\n7. Register command in src/cli/cli.ts\n\nDependencies: @clack/prompts (installed), picocolors (installed), fs/promises","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:18:06.084526-08:00","updated_at":"2025-12-24T06:54:01.942532967Z","closed_at":"2025-12-24T06:54:01.942532967Z","dependencies":[{"issue_id":"markform-153","depends_on_id":"markform-152","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-154","title":"Add tests for examples command","description":"Create unit tests for the examples command.\n\nTests to write:\n1. Example registry has all required fields (id, title, description, filename, content)\n2. All example content modules export valid form markdown\n3. --list output format is correct\n4. --name selection works with valid/invalid names\n5. File overwrite confirmation logic\n\nLocation: packages/markform/tests/unit/cli/examples.test.ts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:18:06.661628-08:00","updated_at":"2025-12-24T06:57:25.739942394Z","closed_at":"2025-12-24T06:57:25.739942394Z","dependencies":[{"issue_id":"markform-154","depends_on_id":"markform-153","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-154","depends_on_id":"markform-152","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-155","title":"Create political-research.form.md template","description":"Create the political-research.form.md template file per plan-2025-12-23-political-research-example.md.\n\n**Location:** packages/markform/examples/political-research/political-research.form.md\n\n**Structure:**\n1. Frontmatter with:\n   - markform_version: \"0.1.0\"\n   - roles: [user, agent]\n   - role_instructions for user and agent\n\n2. Field Groups:\n   - Basic Information: name (role=user, required), portrait_description, birth_date (pattern), birth_place, death_date, death_place, cause_of_death, resting_place\n   - Political Affiliation: political_party (required), other_parties (string_list)\n   - Personal Life: spouse, children (string_list), parents (string_list), education (string_list)\n   - Office 1: office_1_title (required), office_1_term_start (required, pattern), office_1_term_end (required), office_1_preceded_by, office_1_succeeded_by, office_1_running_mate\n   - Office 2: Same structure with office_2_ prefix\n   - Office 3: Same structure with office_3_ prefix\n   - Sources: sources (string_list)\n\n**Validation:**\n- markform inspect should succeed\n- Required fields should show as issues when empty","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:21:30.217289-08:00","updated_at":"2025-12-24T06:43:25.232981405Z","closed_at":"2025-12-24T06:43:25.232981405Z"}
{"id":"markform-156","title":"Create mock Lincoln form for testing","description":"Create a pre-filled political-research form with Abraham Lincoln data for mock agent testing.\n\n**Location:** packages/markform/examples/political-research/political-research.mock.lincoln.form.md\n\n**Data to include:**\n- name: Abraham Lincoln\n- birth_date: 1809-02-12\n- birth_place: Hodgenville, Kentucky\n- death_date: 1865-04-15\n- death_place: Washington, D.C.\n- cause_of_death: Assassination\n- resting_place: Oak Ridge Cemetery, Springfield, Illinois\n- political_party: Republican\n- other_parties: [Whig]\n- spouse: Mary Todd Lincoln (1842-1865)\n- children: Robert Todd Lincoln, Edward Baker Lincoln, William Wallace Lincoln, Thomas Lincoln III\n- parents: Thomas Lincoln, Nancy Hanks Lincoln\n- education: Self-educated\n\n**Offices:**\n- Office 1: 16th President of the United States (1861-03-04 to 1865-04-15)\n  - preceded_by: James Buchanan, succeeded_by: Andrew Johnson\n  - running_mate: Hannibal Hamlin, Andrew Johnson\n- Office 2: US Representative IL-7 (1847-03-04 to 1849-03-04)\n- Office 3: Illinois State Representative (1834-12-01 to 1842-12-05)\n\n**Validation:**\n- markform inspect should show no required field issues","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T22:21:30.836077-08:00","updated_at":"2025-12-24T06:47:21.818863307Z","closed_at":"2025-12-24T06:47:21.818863307Z","dependencies":[{"issue_id":"markform-156","depends_on_id":"markform-155","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-157","title":"examples: Change Filename prompt to Output filename","description":"The filename prompt in the examples command should say 'Output filename:' not just 'Filename:' for clarity.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-24T07:39:28.590945905Z","updated_at":"2025-12-24T07:51:44.436275989Z","closed_at":"2025-12-24T07:51:44.436275989Z"}
{"id":"markform-158","title":"examples: Prepopulate output filename with filled naming convention","description":"The output filename should default to the filled naming convention, e.g., simple-filled1.form.md instead of simple.form.md. Use the standard naming library for incrementing suffixes.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-24T07:39:51.431470517Z","updated_at":"2025-12-24T07:51:45.310164016Z","closed_at":"2025-12-24T07:51:45.310164016Z"}
{"id":"markform-159","title":"examples: Text input should have value filled not just placeholder","description":"The filename text input currently only shows the default as a placeholder, requiring user to press Tab to fill it in. Instead, the value should already be filled in with cursor at the end.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-24T07:39:56.702657873Z","updated_at":"2025-12-24T07:51:46.185285195Z","closed_at":"2025-12-24T07:51:46.185285195Z"}
{"id":"markform-160","title":"examples: Auto-run interactive fill after scaffolding","description":"After the user picks the output filename and the form is scaffolded, automatically proceed to run the interactive fill mode instead of just showing next steps.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T07:40:01.310367401Z","updated_at":"2025-12-24T07:51:47.048882642Z","closed_at":"2025-12-24T07:51:47.048882642Z"}
{"id":"markform-161","title":"examples: Simple form should have all fields with user role","description":"The simple test form should have ALL fields with user role so we can test interactive filling of all of them. Update docs and example descriptions to clarify that simple form is for testing all user fields, while political and financial examples each only have one user role field.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-24T07:40:06.647456825Z","updated_at":"2025-12-24T07:51:47.929031591Z","closed_at":"2025-12-24T07:51:47.929031591Z"}
{"id":"markform-162","title":"examples: Add agent fill step with multi-format export","description":"After the initial user fill is complete, proceed to agent fill step: 1) Pick a -filled2.form.md default name using standard naming library 2) Run agent in live mode on the previous file (typically -filled1.form.md) 3) Write outputs in multiple formats: .form.md (the filled form), .raw.md (export as raw markdown), .yml (values as YAML)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T07:40:11.599727213Z","updated_at":"2025-12-24T07:58:07.027529903Z","closed_at":"2025-12-24T07:58:07.027529903Z"}
{"id":"markform-163","title":"examples: Add prompt for agent fill after interactive fill","description":"After interactive fill completes, check for remaining agent-role fields. If present, prompt user to run agent fill or skip. This is step 4.1 of the complete workflow.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T07:57:22.886271687Z","updated_at":"2025-12-24T08:04:00.587666889Z","closed_at":"2025-12-24T08:04:00.587666889Z"}
{"id":"markform-164","title":"examples: Add model selection UI for agent fill","description":"Show common LLM model options (OpenAI, Anthropic, Google) and allow custom model ID entry. Validate model format and check for API keys. This is step 4.2 of the complete workflow.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T07:57:28.427526984Z","updated_at":"2025-12-24T08:04:05.62747876Z","closed_at":"2025-12-24T08:04:05.62747876Z"}
{"id":"markform-165","title":"examples: Add agent output filename prompt","description":"Use generateVersionedPath() to suggest -filled2 filename after -filled1. Use initialValue so cursor is at end. This is step 4.3 of the complete workflow.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T07:57:33.474418959Z","updated_at":"2025-12-24T08:04:09.669863914Z","closed_at":"2025-12-24T08:04:09.669863914Z"}
{"id":"markform-166","title":"examples: Integrate live agent harness for agent fill","description":"Import and use createLiveAgent and createHarness. Display progress during execution. Handle errors gracefully (API failures, rate limits). Support cancellation. This is step 4.4 of the complete workflow.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T07:57:38.398276488Z","updated_at":"2025-12-24T08:04:13.781831009Z","closed_at":"2025-12-24T08:04:13.781831009Z"}
{"id":"markform-167","title":"examples: Add multi-format export after agent fill","description":"After agent fill completes, export to .form.md (serialize), .raw.md (serializeRawMarkdown), and .yml (YAML values). Allow user to select formats. This is step 5.1-5.2 of the complete workflow.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T07:57:44.566436672Z","updated_at":"2025-12-24T08:04:18.770643273Z","closed_at":"2025-12-24T08:04:18.770643273Z"}
{"id":"markform-168","title":"Normalize file path display in examples output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:24:18.471280453Z","updated_at":"2025-12-24T08:34:57.551760049Z","closed_at":"2025-12-24T08:34:57.551760049Z"}
{"id":"markform-169","title":"Extract reusable multi-format export logic","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:24:22.733952646Z","updated_at":"2025-12-24T08:34:57.551859306Z","closed_at":"2025-12-24T08:34:57.551859306Z"}
{"id":"markform-170","title":"Enable verbose logging during agent fill in examples","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:24:26.466840285Z","updated_at":"2025-12-24T08:34:57.551877356Z","closed_at":"2025-12-24T08:34:57.551877356Z"}
{"id":"markform-171","title":"Check API availability at start of examples command","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T08:24:30.201507297Z","updated_at":"2025-12-24T08:34:57.551896176Z","closed_at":"2025-12-24T08:34:57.551896176Z"}
{"id":"markform-172","title":"Simplify doc block syntax: description/instructions/documentation tags","description":"## Summary\nSimplify the documentation block syntax by using distinct tag names instead of a generic `doc` tag with a `kind` attribute.\n\n**Implementation Spec:** docs/project/specs/active/impl-2025-12-24-doc-block-syntax-simplification.md\n\n## Current Syntax\n```\n{% doc ref=\"x\" kind=\"description\" %}...{% /doc %}\n{% doc ref=\"x\" kind=\"instructions\" %}...{% /doc %}\n```\n\n## New Syntax\n```\n{% description ref=\"x\" %}...{% /description %}\n{% instructions ref=\"x\" %}...{% /instructions %}\n{% documentation ref=\"x\" %}...{% /documentation %}\n```\n\n## Semantic Distinction\n- **description**: Brief, declarative statement of what something is\n- **instructions**: Action-oriented guidance for filling a field\n- **documentation**: General information, workflow context, data sources\n\n## Type Changes (Option B)\n```typescript\ninterface DocumentationBlock {\n  tag: \"description\" | \"instructions\" | \"documentation\";\n  ref: string;\n  bodyMarkdown: string;\n}\n```\n\n## Implementation Phases\n1. Core types and parser (types.ts, parse.ts)\n2. Serializer (serialize.ts)\n3. Migrate example files (11 .form.md files)\n4. Update tests and verify","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T09:08:17.060858-08:00","updated_at":"2025-12-26T15:40:19.125379-08:00","closed_at":"2025-12-26T15:40:19.125379-08:00","dependencies":[{"issue_id":"markform-172","depends_on_id":"markform-177","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-173","title":"[172.1] Update types.ts: DocumentationTag and DocumentationBlock","description":"**Parent:** markform-172\n**Spec:** docs/project/specs/active/impl-2025-12-24-doc-block-syntax-simplification.md#phase-1\n\n## Changes Required\n\n### types.ts\n\n1. Replace `DocBlockKind` with `DocumentationTag`:\n   ```typescript\n   export type DocumentationTag = \"description\" | \"instructions\" | \"documentation\";\n   ```\n\n2. Update `DocumentationBlock` interface:\n   ```typescript\n   export interface DocumentationBlock {\n     tag: DocumentationTag;\n     ref: string;\n     bodyMarkdown: string;\n   }\n   ```\n\n3. Update Zod schemas:\n   - `DocBlockKindSchema` → `DocumentationTagSchema`\n   - Update `DocumentationBlockSchema` to use `tag` (required) instead of `kind` (optional)\n\n## Files\n- packages/markform/src/engine/types.ts (lines 226-237, 767-778)\n\n## Acceptance\n- Types compile without errors\n- Zod schemas validate correctly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T09:30:52.162656-08:00","updated_at":"2025-12-24T17:42:53.291221917Z","closed_at":"2025-12-24T17:42:53.291221917Z"}
{"id":"markform-174","title":"[172.2] Update parse.ts: Parse new tag names","description":"**Parent:** markform-172\n**Spec:** docs/project/specs/active/impl-2025-12-24-doc-block-syntax-simplification.md#phase-1\n\n## Changes Required\n\n### parse.ts\n\nUpdate `extractDocBlocks()` function to:\n1. Look for `{% description %}`, `{% instructions %}`, `{% documentation %}` tags instead of `{% doc %}`\n2. Extract `ref` attribute (no longer need `kind` attribute)\n3. Set `tag` field based on which Markdoc tag was matched\n4. Update duplicate detection to key on `${ref}:${tag}`\n\n## Files\n- packages/markform/src/engine/parse.ts (lines 858-924)\n\n## Acceptance\n- Parser recognizes all three new tag types\n- Throws on missing `ref` attribute\n- Throws on duplicate `(ref, tag)` combinations\n- Allows different tags for same ref","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T09:30:53.298758-08:00","updated_at":"2025-12-24T17:42:53.340875526Z","closed_at":"2025-12-24T17:42:53.340875526Z","dependencies":[{"issue_id":"markform-174","depends_on_id":"markform-173","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-175","title":"[172.3] Update serialize.ts: Output new tag syntax","description":"**Parent:** markform-172\n**Spec:** docs/project/specs/active/impl-2025-12-24-doc-block-syntax-simplification.md#phase-2\n\n## Changes Required\n\n### serialize.ts\n\nUpdate `serializeDocBlock()` function:\n```typescript\n// Before\nreturn \\`{% doc \\${attrStr} %}\\\\n\\${doc.bodyMarkdown}\\\\n{% /doc %}\\`;\n\n// After  \nreturn \\`{% \\${doc.tag} \\${attrStr} %}\\\\n\\${doc.bodyMarkdown}\\\\n{% /\\${doc.tag} %}\\`;\n```\n\nRemove `kind` from attrs since tag name now carries semantics.\n\n## Files\n- packages/markform/src/engine/serialize.ts (lines 429-437)\n\n## Acceptance\n- Serializes to `{% description %}`, `{% instructions %}`, `{% documentation %}` based on `tag` field\n- Round-trip parse→serialize produces valid output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T09:30:53.96097-08:00","updated_at":"2025-12-24T17:42:53.393339528Z","closed_at":"2025-12-24T17:42:53.393339528Z","dependencies":[{"issue_id":"markform-175","depends_on_id":"markform-173","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-176","title":"[172.4] Migrate example .form.md files to new syntax","description":"**Parent:** markform-172\n**Spec:** docs/project/specs/active/impl-2025-12-24-doc-block-syntax-simplification.md#phase-3\n\n## Files to Migrate (11 total)\n\n### Package examples:\n- packages/markform/examples/simple/simple.form.md\n- packages/markform/examples/simple/simple-mock-filled.form.md\n- packages/markform/examples/political-research/political-research.form.md\n- packages/markform/examples/political-research/political-research.mock.lincoln.form.md\n- packages/markform/examples/earnings-analysis/earnings-analysis.form.md\n\n### Root-level filled forms:\n- political-research-filled1.form.md\n- political-research-filled2.form.md\n- political-research-filled3.form.md\n- simple-filled1.form.md\n- simple-filled1-filled.form.md\n- simple-filled2.form.md\n\n## Migration Pattern\n| Old | New |\n|-----|-----|\n| `{% doc ref=\"x\" kind=\"description\" %}` | `{% description ref=\"x\" %}` |\n| `{% doc ref=\"x\" kind=\"instructions\" %}` | `{% instructions ref=\"x\" %}` |\n| `{% /doc %}` | `{% /description %}` or `{% /instructions %}` |\n\n## Special Case\npolitical-research.form.md: The workflow/data sources block should become `{% documentation %}` (not instructions).\n\n## Acceptance\n- All files parse without errors\n- `pnpm markform inspect \u003cfile\u003e` works on all files","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T09:30:54.625503-08:00","updated_at":"2025-12-24T17:47:48.82300661Z","closed_at":"2025-12-24T17:47:48.82300661Z","dependencies":[{"issue_id":"markform-176","depends_on_id":"markform-174","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-176","depends_on_id":"markform-175","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-177","title":"[172.5] Update tests: parse.test.ts and serialize.test.ts","description":"**Parent:** markform-172\n**Spec:** docs/project/specs/active/impl-2025-12-24-doc-block-syntax-simplification.md#phase-4\n\n## Changes Required\n\n### parse.test.ts (lines 424-531)\n- Rename \"doc block edge cases\" → \"documentation tag edge cases\"\n- Update test markdown to use new syntax\n- Update assertions: `.kind` → `.tag`\n- Update error message expectations\n\n### serialize.test.ts (lines 630-650)\n- Update test that includes doc blocks to use new syntax\n\n## Acceptance\n- `pnpm test --filter=markform` passes\n- All doc block / documentation tag tests updated\n- Golden tests still pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T09:30:55.269065-08:00","updated_at":"2025-12-26T15:40:19.10512-08:00","closed_at":"2025-12-26T15:40:19.10512-08:00","dependencies":[{"issue_id":"markform-177","depends_on_id":"markform-176","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-178","title":"Programmatic Fill API","description":"## Summary\nAdd a high-level programmatic API (`fillForm()`) that enables external agentic systems \nto execute form-filling sessions with a single function call.\n\n## Spec\nSee: docs/project/specs/active/plan-2025-12-24-programmatic-fill-api.md\n\n## Key Deliverables\n1. Value coercion layer (`src/engine/values.ts`)\n2. LiveAgent enhancement (systemPromptAddition)\n3. `fillForm()` function (`src/harness/programmaticFill.ts`)\n4. Export updates\n5. Comprehensive tests\n\n## Acceptance Criteria\n- `fillForm()` exported from `markform` package\n- Input context pre-fills fields before agent runs\n- `systemPromptAddition` appends to composed prompt\n- Progress callbacks and AbortSignal cancellation work\n- All tests pass","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-24T09:36:41.653673-08:00","updated_at":"2025-12-24T18:21:06.435639166Z","closed_at":"2025-12-24T18:21:06.435639166Z","dependencies":[{"issue_id":"markform-178","depends_on_id":"markform-183","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-179","title":"Value coercion layer (values.ts)","description":"## Summary\nCreate unified value coercion layer for converting raw input values to typed Patches.\n\n## Files\n- NEW: `src/engine/values.ts`\n\n## Deliverables\n1. `findFieldById()` - O(1) lookup using idIndex\n2. `coerceToFieldPatch()` - raw value → typed Patch with validation\n3. `coerceInputContext()` - batch coercion with warnings/errors\n4. Types: `RawFieldValue`, `InputContext`, `CoercionResult`, `CoerceInputContextResult`\n\n## Coercion Rules\n| Field Kind | Accepts | Coerces | Rejects |\n|------------|---------|---------|---------|\n| string | string | number→string, boolean→string | array, object |\n| number | number | numeric string→number | non-numeric, array |\n| string_list | string[] | string→[string] | non-array non-string |\n| single_select | string | - | invalid option ID |\n| multi_select | string[] | string→[string] | invalid option IDs |\n| checkboxes | Record | - | wrong structure |\n\n## Tests\n- tests/unit/values.test.ts (see Testing Plan in spec)\n\n## Spec Reference\ndocs/project/specs/active/plan-2025-12-24-programmatic-fill-api.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T09:37:01.370722-08:00","updated_at":"2025-12-24T18:06:03.654949742Z","closed_at":"2025-12-24T18:06:03.654949742Z"}
{"id":"markform-180","title":"LiveAgent systemPromptAddition support","description":"## Summary\nAdd `systemPromptAddition` config option to LiveAgent for appending context to composed prompt.\n\n## Files\n- MODIFY: `src/harness/liveAgent.ts`\n\n## Deliverables\n1. Add `systemPromptAddition?: string` to `LiveAgentConfig`\n2. Append to composed prompt in `generatePatches()` method\n3. Ensure form's built-in instructions are preserved\n\n## Behavior\n- If `systemPromptAddition` provided: append after composed prompt\n- If null/undefined: no change to prompt\n- Never override form instructions\n\n## Tests\n- tests/unit/liveAgent.test.ts\n  - systemPromptAddition is appended to composed prompt\n  - Null/undefined doesn't affect prompt\n\n## Spec Reference\ndocs/project/specs/active/plan-2025-12-24-programmatic-fill-api.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T09:37:09.507001-08:00","updated_at":"2025-12-24T18:07:50.700538229Z","closed_at":"2025-12-24T18:07:50.700538229Z"}
{"id":"markform-181","title":"fillForm() programmatic API","description":"## Summary\nImplement the main `fillForm()` function that provides a single-call entry point for form filling.\n\n## Files\n- NEW: `src/harness/programmaticFill.ts`\n\n## Deliverables\n1. `fillForm()` async function\n2. Types: `FillOptions`, `FillResult`, `FillStatus`, `TurnProgress`\n3. Input context handling via coercion layer\n4. Progress callback support (`onTurnComplete`)\n5. Cancellation via AbortSignal\n6. Proper status handling (ok, max_turns, cancelled, error)\n\n## Algorithm\n1. Parse form if string\n2. Resolve model if string\n3. Apply input context using coerceInputContext()\n4. Create harness + agent\n5. Run harness loop with abort check\n6. Return structured FillResult\n\n## Dependencies\n- markform-179 (value coercion layer)\n- markform-180 (LiveAgent systemPromptAddition)\n\n## Tests\n- tests/unit/programmaticFill.test.ts (see Testing Plan in spec)\n\n## Spec Reference\ndocs/project/specs/active/plan-2025-12-24-programmatic-fill-api.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T09:37:18.826308-08:00","updated_at":"2025-12-24T18:16:04.575789633Z","closed_at":"2025-12-24T18:16:04.575789633Z","dependencies":[{"issue_id":"markform-181","depends_on_id":"markform-180","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-181","depends_on_id":"markform-179","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-182","title":"Export updates for programmatic API","description":"## Summary\nUpdate package exports to expose the new programmatic fill API.\n\n## Files\n- MODIFY: `src/harness/index.ts`\n- MODIFY: `src/index.ts`\n\n## Deliverables\n1. Export from harness/index.ts:\n   - `fillForm`\n   - `FillOptions`, `FillResult`, `FillStatus`, `TurnProgress`\n\n2. Export from main index.ts:\n   - `fillForm`\n   - All types above\n   - Coercion types: `InputContext`, `RawFieldValue`\n\n## Dependencies\n- markform-181 (fillForm implementation)\n\n## Spec Reference\ndocs/project/specs/active/plan-2025-12-24-programmatic-fill-api.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T09:37:31.78954-08:00","updated_at":"2025-12-24T18:17:25.540848873Z","closed_at":"2025-12-24T18:17:25.540848873Z","dependencies":[{"issue_id":"markform-182","depends_on_id":"markform-181","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-183","title":"Integration tests for programmatic fill API","description":"## Summary\nAdd integration tests for the programmatic fill API using MockAgent.\n\n## Files\n- NEW: `tests/integration/programmaticFill.test.ts`\n\n## Test Cases\n1. End-to-end with MockAgent:\n   - Complete fill of simple.form.md using mock values\n   - Complete fill of political-research.form.md with inputContext for user fields\n   - Verify round-trip: fillForm result can be re-parsed\n\n2. Error scenarios:\n   - Form parse error returns appropriate error\n   - Model resolution error returns appropriate error\n\n## Dependencies\n- markform-182 (exports complete)\n\n## Spec Reference\ndocs/project/specs/active/plan-2025-12-24-programmatic-fill-api.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T09:37:43.715331-08:00","updated_at":"2025-12-24T18:21:06.435537337Z","closed_at":"2025-12-24T18:21:06.435537337Z","dependencies":[{"issue_id":"markform-183","depends_on_id":"markform-182","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-184","title":"Programmatic Fill API: Post-implementation cleanups","description":"Umbrella issue for cleanups and spec/code alignment issues discovered during review of plan-2025-12-24-programmatic-fill-api.md after implementation.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-24T12:55:33.695777-08:00","updated_at":"2025-12-26T15:51:38.516803-08:00","closed_at":"2025-12-26T15:51:38.516803-08:00"}
{"id":"markform-184.1","title":"Spec: Fix remainingIssues severity type ('optional' should be 'recommended')","description":"In plan-2025-12-24-programmatic-fill-api.md lines 440-442, FillResult.remainingIssues specifies severity: 'required' | 'optional'. But the implementation (programmaticFill.ts:115-117) correctly uses 'required' | 'recommended' to match InspectIssue. Update the spec to match the implementation.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-24T12:55:43.826807-08:00","updated_at":"2025-12-26T15:46:59.977734-08:00","closed_at":"2025-12-26T15:46:59.977734-08:00","dependencies":[{"issue_id":"markform-184.1","depends_on_id":"markform-184","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-184.2","title":"Spec: Fix remainingIssues priority type (1|2|3 should be number for 1-5)","description":"In plan-2025-12-24-programmatic-fill-api.md line 441, FillResult.remainingIssues specifies priority: 1 | 2 | 3. But the implementation (programmaticFill.ts:117) uses 'priority: number' to match InspectIssue's 1-5 priority tiers. Update the spec to match.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-24T12:55:49.926114-08:00","updated_at":"2025-12-26T15:46:59.99752-08:00","closed_at":"2025-12-26T15:46:59.99752-08:00","dependencies":[{"issue_id":"markform-184.2","depends_on_id":"markform-184","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-184.3","title":"CLI: Update --prompt/--instructions help text to reflect 'addition' behavior","description":"CLI fill command (fill.ts:192-197) says --prompt 'overrides default' and --instructions 'overrides --prompt and default'. But the implementation (fill.ts:423) passes these as systemPromptAddition which appends, not overrides. Update help text to say 'appends to' or 'additional context for' the system prompt.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-24T12:55:55.959604-08:00","updated_at":"2025-12-26T15:47:00.02338-08:00","closed_at":"2025-12-26T15:47:00.02338-08:00","dependencies":[{"issue_id":"markform-184.3","depends_on_id":"markform-184","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-184.4","title":"Spec/Code: findFieldById is not truly O(1) - still iterates groups","description":"The spec (lines 590, 678) claims findFieldById uses idIndex for O(1) lookup. But values.ts:59-75 first checks idIndex (O(1)) then still iterates all groups/fields to find the Field object (O(n)). Either extend idIndex to store Field references directly, add a fieldsById map to ParsedForm, or update the spec to clarify the O(1)+O(n) behavior. Low priority since forms are typically small.","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-24T12:56:02.645067-08:00","updated_at":"2025-12-26T15:51:38.495552-08:00","closed_at":"2025-12-26T15:51:38.495552-08:00","dependencies":[{"issue_id":"markform-184.4","depends_on_id":"markform-184","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-184.5","title":"Consistency: fillForm default maxTurns (30) differs from CLI (100)","description":"programmaticFill.ts:124 sets DEFAULT_FILL_MAX_TURNS=30, while settings.ts:95 has DEFAULT_MAX_TURNS=100 used by CLI. This could cause confusion: library users get 30 turns, CLI users get 100. Either align to one default, or document the difference explicitly in both spec and CLI help. Consider using the same constant from settings.ts.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-24T12:56:09.020401-08:00","updated_at":"2025-12-26T15:47:00.042548-08:00","closed_at":"2025-12-26T15:47:00.042548-08:00","dependencies":[{"issue_id":"markform-184.5","depends_on_id":"markform-184","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-184.6","title":"Spec: Mark completed test cases in Testing Plan section","description":"The Testing Plan section (lines 185-310) has unchecked checkboxes for test cases that have now been implemented. Update the spec to check off completed test cases: values.test.ts tests (findFieldById, coerceToFieldPatch per field kind, coercion warnings, coerceInputContext), programmaticFill.test.ts tests (basic functionality, input context, progress callback, cancellation, max turns, fill modes), and integration tests.","status":"closed","priority":4,"issue_type":"chore","created_at":"2025-12-24T12:56:19.857498-08:00","updated_at":"2025-12-26T15:47:00.065893-08:00","closed_at":"2025-12-26T15:47:00.065893-08:00","dependencies":[{"issue_id":"markform-184.6","depends_on_id":"markform-184","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-185","title":"Refactor: Extract and rename type files for consistency","description":"## Summary\nRefactor type organization across the markform package for consistency and clarity.\n\n## Goals\n1. Use descriptive filenames (e.g., coreTypes.ts instead of generic types.ts)\n2. Extract embedded types from implementation files into dedicated type files\n3. Keep related types together in logical groupings\n\n## Changes\n\n### 1. Rename engine/types.ts to engine/coreTypes.ts\n- Simple rename, no content changes\n- Update all imports across the codebase\n\n### 2. Create harness/harnessTypes.ts\nExtract types from:\n- programmaticFill.ts: FillOptions, TurnProgress, FillStatus, FillResult\n- mockAgent.ts: Agent\n- liveAgent.ts: LiveAgentConfig\n- modelResolver.ts: ProviderName, ParsedModelId, ResolvedModel, ProviderInfo\n\n### 3. Create integrations/toolTypes.ts\nExtract from ai-sdk.ts:\n- CreateMarkformToolsOptions\n- InspectToolResult, ApplyToolResult, ExportToolResult, GetMarkdownToolResult\n- MarkformTool, MarkformToolSet\n\n### 4. Create cli/lib/cliTypes.ts\nExtract from:\n- shared.ts: OutputFormat, CommandContext\n- exportHelpers.ts: ExportResult\n- examples/index.ts: ExampleDefinition\n\n## Non-Goals\n- Splitting engine/coreTypes.ts further (well-organized with section comments)\n- Changing any type definitions (pure refactor)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T13:25:57.017394-08:00","updated_at":"2025-12-24T13:40:30.841003-08:00","closed_at":"2025-12-24T13:40:30.841003-08:00"}
{"id":"markform-186","title":"Rename engine/types.ts to engine/coreTypes.ts","description":"Rename engine/types.ts to engine/coreTypes.ts and update all imports.\n\nFiles to update:\n- Rename: src/engine/types.ts -\u003e src/engine/coreTypes.ts\n- Update imports in ~20 files that import from ./engine/types.js\n\nThis is the foundational step - must complete before other type extraction tasks.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T13:26:54.993114-08:00","updated_at":"2025-12-24T13:35:24.69029-08:00","closed_at":"2025-12-24T13:35:24.69029-08:00"}
{"id":"markform-187","title":"Create harness/harnessTypes.ts and extract types","description":"Create harness/harnessTypes.ts and extract embedded types.\n\nExtract from:\n- programmaticFill.ts: FillOptions, TurnProgress, FillStatus, FillResult\n- mockAgent.ts: Agent interface\n- liveAgent.ts: LiveAgentConfig\n- modelResolver.ts: ProviderName, ParsedModelId, ResolvedModel, ProviderInfo\n\nUpdate imports in source files and harness/index.ts exports.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T13:26:55.602823-08:00","updated_at":"2025-12-24T13:40:30.840967-08:00","closed_at":"2025-12-24T13:40:30.840967-08:00","dependencies":[{"issue_id":"markform-187","depends_on_id":"markform-186","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-188","title":"Create integrations/toolTypes.ts and extract types","description":"Create integrations/toolTypes.ts and extract AI SDK tool types.\n\nExtract from ai-sdk.ts:\n- CreateMarkformToolsOptions\n- InspectToolResult, ApplyToolResult, ExportToolResult, GetMarkdownToolResult\n- MarkformTool, MarkformToolSet\n\nUpdate imports in ai-sdk.ts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T13:26:56.21629-08:00","updated_at":"2025-12-24T13:40:30.840996-08:00","closed_at":"2025-12-24T13:40:30.840996-08:00","dependencies":[{"issue_id":"markform-188","depends_on_id":"markform-186","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-189","title":"Create cli/lib/cliTypes.ts and extract types","description":"Create cli/lib/cliTypes.ts and extract CLI types.\n\nExtract from:\n- shared.ts: OutputFormat, CommandContext\n- exportHelpers.ts: ExportResult\n- examples/index.ts: ExampleDefinition\n\nUpdate imports in CLI command files.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T13:26:56.939375-08:00","updated_at":"2025-12-24T13:40:30.841-08:00","closed_at":"2025-12-24T13:40:30.841-08:00","dependencies":[{"issue_id":"markform-189","depends_on_id":"markform-186","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-190","title":"Remove dead harness/index.ts barrel file","description":"Delete src/harness/index.ts - a barrel re-export file that nobody imports. All consumers (src/index.ts and CLI commands) import directly from source files like ./harness/harness.js. Zero imports use the barrel. Per typescript-rules.md: Avoid re-exporting unless for library consumers.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-24T13:31:29.240433-08:00","updated_at":"2025-12-24T13:50:10.377151-08:00","closed_at":"2025-12-24T13:50:10.377151-08:00"}
{"id":"markform-191","title":"Rename cli/examples/index.ts to exampleRegistry.ts","description":"Rename src/cli/examples/index.ts to exampleRegistry.ts. The file contains actual logic (ExampleDefinition interface, EXAMPLE_DEFINITIONS array, loadExampleContent function) - not a re-export barrel. Per typescript-rules.md: Avoid non-descriptive index.ts names for source modules.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-24T13:31:31.381556-08:00","updated_at":"2025-12-24T13:51:55.917394-08:00","closed_at":"2025-12-24T13:51:55.917394-08:00"}
{"id":"markform-192","title":"Add URL field types (url-field, url-list) with end-to-end support","description":"Add dedicated URL field types to markform:\n- url-field: Single URL value with built-in format validation\n- url-list: List of URLs (for citations, sources)\n- Includes parser, serializer, validator, patches, apply, and tests\n- Example: startup-deep-research.form.md demonstrating citation patterns\n\n**Spec:** docs/project/specs/active/plan-2025-12-24-url-field-types.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-24T15:24:15.914446-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z"}
{"id":"markform-192.1","title":"Core types: Add UrlField, UrlListField, UrlValue, UrlListValue to coreTypes.ts","description":"Add to coreTypes.ts:\n- FieldKind: add 'url' and 'url_list'\n- UrlField interface (kind: 'url', base fields only)\n- UrlListField interface (kind: 'url_list', minItems, maxItems, uniqueItems)\n- UrlValue interface (kind: 'url', value: string | null)\n- UrlListValue interface (kind: 'url_list', items: string[])\n- Update Field and FieldValue union types\n- Add Zod schemas for all new types","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T15:24:22.119447-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.1","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.10","title":"Golden test: E2E session test for startup-deep-research form","description":"Create golden session test:\n- tests/golden/sessions/startup-deep-research.session.yaml\n- Test mock agent filling the startup research form\n- Verify URL validation catches invalid URLs\n- Verify round-trip serialization preserves URLs\n- Test that url-list items are properly stored and retrieved","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:25:08.328445-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.10","depends_on_id":"markform-192.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.10","depends_on_id":"markform-192.11","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.10","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.10","depends_on_id":"markform-192.9","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.10","depends_on_id":"markform-192.6","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.11","title":"Update simple.form.md with URL field examples","description":"Add URL field examples to packages/markform/examples/simple/simple.form.md:\n- Add new field-group 'url_fields' with:\n  - url-field for website (user role)\n  - url-list for references (agent role, minItems=1)\n- Update simple.mock.filled.form.md with mock URL values\n\n**Spec:** docs/project/specs/active/plan-2025-12-24-url-field-types.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:43:41.500447-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.11","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.11","depends_on_id":"markform-192.8","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.2","title":"Parser: Add parsing for url-field and url-list tags","description":"Update parse.ts:\n- parseUrlField(): Parse url-field tag, extract fence value\n- parseUrlListField(): Parse url-list tag with minItems/maxItems/uniqueItems\n- Update parseField() switch to handle 'url-field' and 'url-list'\n- URL value extraction from fence content (same as string-field)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T15:24:26.871505-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.2","depends_on_id":"markform-192.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.2","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.3","title":"Serializer: Add serialization for url-field and url-list","description":"Update serialize.ts:\n- serializeUrlField(): Serialize url-field tag with fence value\n- serializeUrlListField(): Serialize url-list tag with items in fence\n- Update serializeField() switch to handle url and url_list kinds","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T15:24:31.089495-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.3","depends_on_id":"markform-192.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.3","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.4","title":"Validator: Add URL format validation","description":"Update validate.ts:\n- URL_PATTERN: Regex for http/https URLs\n- validateUrlField(): Check URL format\n- validateUrlListField(): Check minItems, maxItems, uniqueItems, format for each item\n- Update field validation switch to handle url and url_list kinds","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T15:24:35.142198-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.4","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.4","depends_on_id":"markform-192.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.5","title":"Patches: Add SetUrlPatch and SetUrlListPatch types","description":"Update coreTypes.ts patch section:\n- SetUrlPatch: { op: 'set_url', fieldId, value: string | null }\n- SetUrlListPatch: { op: 'set_url_list', fieldId, items: string[] }\n- Add to Patch union type\n- Add Zod schemas: SetUrlPatchSchema, SetUrlListPatchSchema\n- Update PatchSchema discriminated union","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T15:24:40.108317-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.5","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.5","depends_on_id":"markform-192.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.6","title":"Apply: Handle applying URL patches in applyPatch()","description":"Update apply.ts (or wherever applyPatch is):\n- Handle 'set_url' patch: validate field kind is 'url', set value\n- Handle 'set_url_list' patch: validate field kind is 'url_list', set items\n- URL format validation on apply (before accepting value)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T15:24:45.154161-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.6","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.6","depends_on_id":"markform-192.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.7","title":"Inspect: Handle URL fields in progress/issue computation","description":"Update inspect.ts:\n- computeFieldProgress: Handle url and url_list field kinds\n- computeInspectIssues: Include URL fields in issue generation\n- URL fields follow same pattern as string/string_list for progress","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-24T15:24:49.505495-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.7","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.7","depends_on_id":"markform-192.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.8","title":"Unit tests: URL field parsing, serialization, validation","description":"Create/update tests:\n- tests/unit/parse.test.ts: Test parseUrlField, parseUrlListField\n- tests/unit/serialize.test.ts: Test URL field serialization round-trip\n- tests/unit/validate.test.ts: Test URL format validation\n- Test edge cases: empty values, invalid URLs, minItems/maxItems","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:24:54.501846-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.8","depends_on_id":"markform-192.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.8","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.8","depends_on_id":"markform-192.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.8","depends_on_id":"markform-192.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-192.9","title":"Example: Create startup-deep-research.form.md demonstrating URL fields","description":"Create packages/markform/examples/startup-deep-research/:\n- startup-deep-research.form.md: Template form with URL fields for citations\n- startup-deep-research.mock.filled.form.md: Completed mock for testing\n- README.md: Brief description of the example\n\nForm structure:\n- Basic Info (company_name, website url, founded, hq, one_liner, sources)\n- Founders (names, linkedin urls, backgrounds, sources)\n- Funding (total_raised, last_round, investors, funding sources)\n- Product/Market (description, target_market, competitors, sources)\n- Community (hacker_news_posts, product_hunt_launches, press urls)\n- Assessment (strengths, risks, sources)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T15:25:02.891298-08:00","updated_at":"2025-12-25T00:00:00Z","closed_at":"2025-12-25T00:00:00Z","dependencies":[{"issue_id":"markform-192.9","depends_on_id":"markform-192.8","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-192.9","depends_on_id":"markform-192","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-193","title":"Implement skip_field operation and answered/skipped tracking","description":"Implementation of plan-2025-12-25-skip-field-and-answered-tracking.md. Adds skip_field patch operation for explicitly skipping optional fields, tracks answered vs skipped fields, and updates completion semantics to require answered+skipped==total.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-25T02:43:46.825544801Z","updated_at":"2025-12-24T20:05:43.348569-08:00","closed_at":"2025-12-24T20:05:43.348569-08:00"}
{"id":"markform-194","title":"Phase 1: Add skip_field types and schemas to coreTypes.ts","description":"Add SkipFieldPatch type, SkipInfo type, skipsByFieldId to ParsedForm, skipped/skipReason to FieldProgress, answeredFields/skippedFields to ProgressCounts. Reference: plan-2025-12-25-skip-field-and-answered-tracking.md Stage 2 Type Changes.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T02:44:05.677042667Z","updated_at":"2025-12-25T03:03:33.433490616Z","closed_at":"2025-12-25T03:03:33.433490616Z","dependencies":[{"issue_id":"markform-194","depends_on_id":"markform-193","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-195","title":"Phase 2: Handle skip_field in applyPatches()","description":"Implement applySkipField() in apply.ts. Reject skip on required fields with error. Clear value when skipping. Store skip state in skipsByFieldId. Clear skip state when setting value. Reference: plan-2025-12-25-skip-field-and-answered-tracking.md Stage 2 apply.ts.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T02:44:29.959411694Z","updated_at":"2025-12-25T03:06:55.215493193Z","closed_at":"2025-12-25T03:06:55.215493193Z","dependencies":[{"issue_id":"markform-195","depends_on_id":"markform-194","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-195","depends_on_id":"markform-193","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-196","title":"Phase 3: Update progress computation in summaries.ts","description":"Update computeFieldProgress() to include skipped and skipReason fields. Update computeProgressCounts() to compute answeredFields and skippedFields. Reference: plan-2025-12-25-skip-field-and-answered-tracking.md Stage 2 summaries.ts.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T02:44:33.964632479Z","updated_at":"2025-12-25T03:10:06.452724399Z","closed_at":"2025-12-25T03:10:06.452724399Z","dependencies":[{"issue_id":"markform-196","depends_on_id":"markform-193","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-196","depends_on_id":"markform-194","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-197","title":"Phase 4: Update completion logic in inspect.ts","description":"Update inspect() completion check to require answered+skipped==total (for target roles) AND no required issues. New isComplete = allFieldsAccountedFor \u0026\u0026 hasNoRequiredIssues. Reference: plan-2025-12-25-skip-field-and-answered-tracking.md Stage 2 inspect.ts.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T02:44:37.96859686Z","updated_at":"2025-12-25T03:15:48.753953427Z","closed_at":"2025-12-25T03:15:48.753953427Z","dependencies":[{"issue_id":"markform-197","depends_on_id":"markform-195","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-197","depends_on_id":"markform-196","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-197","depends_on_id":"markform-193","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-198","title":"Phase 5: Enforce checkboxMode/required constraints in parse.ts","description":"Add parse-time validation: explicit mode with required=false is error. Default required=true for explicit mode. Default required=false for multi/simple modes. Emit lint warning for redundant required=true on explicit. Reference: plan-2025-12-25-skip-field-and-answered-tracking.md Checkbox Mode section.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T02:44:42.180452983Z","updated_at":"2025-12-25T02:56:04.817956276Z","closed_at":"2025-12-25T02:56:04.817956276Z","dependencies":[{"issue_id":"markform-198","depends_on_id":"markform-193","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-199","title":"Phase 6: Golden tests and CLI inspect updates","description":"Update SessionTurn.after to include answeredFieldCount/skippedFieldCount. Create test session with skips (simple-with-skips.session.yaml). Update CLI inspect to show skipped status. Reference: plan-2025-12-25-skip-field-and-answered-tracking.md Testing Plan.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T02:44:46.146970494Z","updated_at":"2025-12-24T19:52:54.606374-08:00","closed_at":"2025-12-25T03:19:24.246793673Z","dependencies":[{"issue_id":"markform-199","depends_on_id":"markform-193","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-199","depends_on_id":"markform-197","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-1hn","title":"1.3 Canonical Serialization (engine/serialize.ts)","description":"Implement serialize(form: ParsedForm, opts?): string\n- Frontmatter generation with computed summaries\n- Tag serialization with alphabetical attributes\n- Value fence generation\n- Option list serialization with markers\n- Doc block placement\n- Round-trip tests: parse -\u003e serialize -\u003e parse -\u003e compare","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:41.512809-08:00","updated_at":"2025-12-23T15:03:22.034125062Z","closed_at":"2025-12-23T15:02:24.951660706Z","dependencies":[{"issue_id":"markform-1hn","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.105721-08:00","created_by":"daemon"},{"issue_id":"markform-1hn","depends_on_id":"markform-25g","type":"blocks","created_at":"2025-12-23T00:34:35.056018-08:00","created_by":"daemon"},{"issue_id":"markform-1hn","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.51323-08:00","created_by":"daemon"},{"issue_id":"markform-1hn","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.392378-08:00","created_by":"daemon"}]}
{"id":"markform-1qs","title":"ARCH-004: InspectIssue needs scope field for group-level validators","description":"## Problem\nInspectIssue uses `fieldId` but group-level validators exist. The current structure can't properly represent issues from group or form-level validators.\n\n## Why It Matters\n- Group-level validators validate across multiple fields\n- Form-level validators validate the entire form\n- Current `fieldId` property can't represent these scopes\n\n## Recommended Fix\n- Rename `fieldId` to `ref` or `targetId`\n- Add `scope: 'form' | 'group' | 'field' | 'option'` field\n- Allow `QualifiedOptionRef` for option-level issues\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (InspectIssue interface)\n\n## Blocks\n- markform-bve (1.7 Inspect implementation)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:10.397034-08:00","updated_at":"2025-12-23T09:07:13.788184675Z","closed_at":"2025-12-23T09:07:13.788184675Z"}
{"id":"markform-1xj","title":"4.2 Live Agent Test Script","description":"Create scripts/test-live-agent.ts:\n- Load simple form template for quick iteration\n- Configure AI SDK with tools\n- Run agent loop to fill form\n- Log session transcript\n- Validate final form completeness\n- Test with complex form","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:21:06.760651-08:00","updated_at":"2025-12-23T16:31:19.762438775Z","closed_at":"2025-12-23T16:29:52.471441055Z","dependencies":[{"issue_id":"markform-1xj","depends_on_id":"markform-cx7","type":"blocks","created_at":"2025-12-22T23:21:14.630102-08:00","created_by":"daemon"},{"issue_id":"markform-1xj","depends_on_id":"markform-x39","type":"blocks","created_at":"2025-12-22T23:21:13.738064-08:00","created_by":"daemon"}]}
{"id":"markform-1zs","title":"ARCH-005: Fix doc block placement rules to match fixtures","description":"## Problem\nSpec says doc blocks 'must be siblings of the referenced element', but fixtures show docs nested inside `{% form %}` and `{% field-group %}` bodies.\n\n## Evidence\n- In `simple.form.md`: `{% doc ref=\"simple_test\" %}` is inside the `{% form %}` body\n- In `earnings-analysis.form.md`: group docs (e.g., `ref=\"offerings_primary\"`) are inside the `{% field-group %}` body\n\nThis is a direct spec↔fixtures mismatch.\n\n## Recommended Fix\nReplace 'must be siblings' rule with:\n1. Doc blocks MAY appear inside `form` and `field-group` as direct children\n2. Doc blocks MUST NOT appear inside a field tag body (this is the actual parsing constraint)\n3. For field-level docs: place immediately after the field block (sibling within the group)\n\nThis keeps field value extraction simple (the important part) without forcing awkward 'docs outside container' layout.\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (Documentation Blocks section)\n\n## Blocks\n- markform-7mt (1.2 Markdoc Parsing)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:11.120353-08:00","updated_at":"2025-12-23T09:08:36.999507593Z","closed_at":"2025-12-23T09:08:36.999507593Z"}
{"id":"markform-200","title":"Phase 7: Console and Web UI skip support","description":"Console: Add skip option for optional fields in interactivePrompts.ts. Web: Add skip button for optional fields in serve.ts. Show visual indicators for skipped fields in both. Reference: plan-2025-12-25-skip-field-and-answered-tracking.md UI Parity section.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T02:44:50.483024401Z","updated_at":"2025-12-24T20:05:33.009141-08:00","closed_at":"2025-12-24T20:05:33.009141-08:00","dependencies":[{"issue_id":"markform-200","depends_on_id":"markform-197","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-200","depends_on_id":"markform-193","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-201","title":"Simplify fill command: replace --agent flag with --mock","description":"## Summary\nThe `--agent=live|mock` flag on the `fill` command is confusing. Simplify by defaulting to live and adding a `--mock` boolean flag instead.\n\n## Current Behavior\n```bash\npnpm markform fill form.md --agent=live --model=openai/gpt-4o\npnpm markform fill form.md --agent=mock --mock-source=filled.form.md\n```\n\n## New Behavior\n```bash\npnpm markform fill form.md --model=openai/gpt-4o           # live is default\npnpm markform fill form.md --mock --mock-source=filled.form.md\n```\n\n## Changes Required\n\n### Code Changes\n1. `packages/markform/src/cli/commands/fill.ts` - Replace `--agent` option with `--mock` boolean flag\n2. Update logic to default to live agent when `--mock` is not specified\n\n### Documentation Updates\nSearch and update all references to `--agent=live` or `--agent=mock`:\n- README.md\n- docs/*.md files\n- Example comments\n- Any CLI help text\n\n### No Backward Compatibility\n- This is a breaking change but acceptable per user direction\n- No deprecation warnings needed\n\n## Acceptance Criteria\n- [ ] `--mock` flag replaces `--agent` option\n- [ ] Default behavior (no flag) uses live agent\n- [ ] `--mock` requires `--mock-source`\n- [ ] All docs and examples updated\n- [ ] Tests pass","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-24T23:36:07.048062-08:00","updated_at":"2025-12-24T23:49:50.466873-08:00","closed_at":"2025-12-24T23:49:50.466873-08:00"}
{"id":"markform-202","title":"Stateless agent turns with full form context","description":"Make agent turns stateless by including full form markdown in each turn's context. Agent sees current form state + remaining issues each turn. No conversation history needed - form IS the state.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-25T00:48:33.886357-08:00","updated_at":"2025-12-25T01:37:51.20671-08:00","closed_at":"2025-12-25T01:37:51.20671-08:00"}
{"id":"markform-202.1","title":"Add LlmTurnStats and AgentResponse types","description":"Add LlmTurnStats type with historyMessages, responseMessages, inputTokens, outputTokens. Add AgentResponse type with patches and optional stats.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:48:41.71155-08:00","updated_at":"2025-12-25T01:24:38.064404-08:00","closed_at":"2025-12-25T01:24:38.064404-08:00","dependencies":[{"issue_id":"markform-202.1","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.10","title":"Update golden test runner to verify LLM stats","description":"Update runner.ts to compare llm stats in TurnResult if present in session. For mock sessions, llm should be undefined. For live sessions, verify historyMessages grows across turns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:50:40.608159-08:00","updated_at":"2025-12-25T01:24:38.064464-08:00","closed_at":"2025-12-25T01:24:38.064464-08:00","dependencies":[{"issue_id":"markform-202.10","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.10","depends_on_id":"markform-202.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.11","title":"Add live session golden test with LLM stats","description":"Create or record a live session test that exercises the LLM stats tracking. Verify stats show growing historyMessages and valid token counts across turns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:50:42.657877-08:00","updated_at":"2025-12-25T01:24:38.064466-08:00","closed_at":"2025-12-25T01:24:38.064466-08:00","dependencies":[{"issue_id":"markform-202.11","depends_on_id":"markform-202.10","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.11","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.12","title":"Verify LLM stats are stable across test runs","description":"Run the live session golden test multiple times and confirm historyMessages/responseMessages are deterministic. Token counts may vary slightly by provider but should be in expected ranges.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:50:44.896952-08:00","updated_at":"2025-12-25T01:24:38.064469-08:00","closed_at":"2025-12-25T01:24:38.064469-08:00","dependencies":[{"issue_id":"markform-202.12","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.12","depends_on_id":"markform-202.11","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.13","title":"Revert messageHistory from LiveAgent","description":"Remove the uncommitted messageHistory field and related code from liveAgent.ts. Each turn should be stateless with no conversation accumulation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:24:48.78297-08:00","updated_at":"2025-12-25T01:28:53.634687-08:00","closed_at":"2025-12-25T01:28:53.634687-08:00","dependencies":[{"issue_id":"markform-202.13","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.14","title":"Add full form markdown to context prompt","description":"Update buildContextPrompt() to include serialize(form) so agent sees the complete form with current values. This provides full visibility of filled vs unfilled fields each turn.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:24:51.366647-08:00","updated_at":"2025-12-25T01:29:36.898296-08:00","closed_at":"2025-12-25T01:29:36.898296-08:00","dependencies":[{"issue_id":"markform-202.14","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.14","depends_on_id":"markform-202.13","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.15","title":"Add comprehensive per-turn stats tracking","description":"Add per-turn stats to TurnProgress and SessionTurn:\n- Token usage: inputTokens, outputTokens from result.usage\n- Tool usage: tool call counts, which tools used (generatePatches, web_search)\n- Form tallies: answeredFields, skippedFields, requiredIssuesRemaining (from progressSummary)\nDisplay in CLI verbose output and record in session logs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:24:53.426738-08:00","updated_at":"2025-12-25T01:26:22.279528-08:00","closed_at":"2025-12-25T01:26:22.279528-08:00","dependencies":[{"issue_id":"markform-202.15","depends_on_id":"markform-202.14","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.15","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.16","title":"Test stateless form context with live agent","description":"Run live agent tests to verify the stateless form context approach works correctly. Agent should see full form each turn and successfully fill fields across multiple turns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:24:55.481655-08:00","updated_at":"2025-12-25T01:37:45.531496-08:00","closed_at":"2025-12-25T01:37:45.531496-08:00","dependencies":[{"issue_id":"markform-202.16","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.16","depends_on_id":"markform-202.14","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.17","title":"Define TurnStats type with token, tool, and form metrics","description":"Add TurnStats interface with: inputTokens, outputTokens, toolCalls (count + names), and form metrics (answeredFields, skippedFields, requiredRemaining, optionalRemaining).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:26:08.733853-08:00","updated_at":"2025-12-25T01:30:04.595828-08:00","closed_at":"2025-12-25T01:30:04.595828-08:00","dependencies":[{"issue_id":"markform-202.17","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.17","depends_on_id":"markform-202.14","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.18","title":"Collect stats in LiveAgent.generatePatches","description":"After generateText call, extract: result.usage (tokens), step.toolCalls (tool usage). Return stats alongside patches in AgentResponse.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:26:11.395972-08:00","updated_at":"2025-12-25T01:31:06.2558-08:00","closed_at":"2025-12-25T01:31:06.2558-08:00","dependencies":[{"issue_id":"markform-202.18","depends_on_id":"markform-202.17","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.18","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.19","title":"Add stats to TurnProgress callback","description":"Extend TurnProgress with optional turnStats field. Pass combined LLM stats + form metrics to onTurnComplete callback.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:26:13.459707-08:00","updated_at":"2025-12-25T01:34:37.93445-08:00","closed_at":"2025-12-25T01:34:37.93445-08:00","dependencies":[{"issue_id":"markform-202.19","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.19","depends_on_id":"markform-202.18","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.2","title":"Change Agent.generatePatches() return type to AgentResponse","description":"Update Agent interface to return Promise\u003cAgentResponse\u003e instead of Promise\u003cPatch[]\u003e.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:48:46.477482-08:00","updated_at":"2025-12-25T01:24:38.064439-08:00","closed_at":"2025-12-25T01:24:38.064439-08:00","dependencies":[{"issue_id":"markform-202.2","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.2","depends_on_id":"markform-202.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.20","title":"Add stats to SessionTurn for session logs","description":"Extend SessionTurn with optional stats field. Record in harness session transcript for golden tests and debugging.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:26:15.470132-08:00","updated_at":"2025-12-25T01:37:22.019826-08:00","closed_at":"2025-12-25T01:37:22.019826-08:00","dependencies":[{"issue_id":"markform-202.20","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.20","depends_on_id":"markform-202.19","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.21","title":"Display turn stats in CLI verbose output","description":"When --verbose is set, display per-turn stats: tokens (in/out), tool calls, form progress. Format similar to existing form summaries.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:26:17.635206-08:00","updated_at":"2025-12-25T01:34:39.40577-08:00","closed_at":"2025-12-25T01:34:39.40577-08:00","dependencies":[{"issue_id":"markform-202.21","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.21","depends_on_id":"markform-202.20","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.22","title":"Update Agent interface to return AgentResponse with stats","description":"Change Agent.generatePatches() return type from Promise\u003cPatch[]\u003e to Promise\u003cAgentResponse\u003e where AgentResponse = { patches: Patch[], stats?: TurnStats }.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:26:35.520302-08:00","updated_at":"2025-12-25T01:30:05.906068-08:00","closed_at":"2025-12-25T01:30:05.906068-08:00","dependencies":[{"issue_id":"markform-202.22","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.22","depends_on_id":"markform-202.17","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.23","title":"Update MockAgent to return AgentResponse","description":"Update MockAgent.generatePatches() to return { patches, stats: undefined }. MockAgent doesn't track stats.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:26:38.110427-08:00","updated_at":"2025-12-25T01:31:04.843525-08:00","closed_at":"2025-12-25T01:31:04.843525-08:00","dependencies":[{"issue_id":"markform-202.23","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.23","depends_on_id":"markform-202.22","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.24","title":"Update callers to handle AgentResponse","description":"Update programmaticFill.ts, fill.ts, examples.ts to destructure { patches, stats } from agent.generatePatches() result.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:26:39.470169-08:00","updated_at":"2025-12-25T01:34:36.323899-08:00","closed_at":"2025-12-25T01:34:36.323899-08:00","dependencies":[{"issue_id":"markform-202.24","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.24","depends_on_id":"markform-202.22","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.24","depends_on_id":"markform-202.23","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.25","title":"Add verbose LLM context logging to fill command","description":"When --verbose is selected, log full LLM messages including system prompt, context prompt with form markdown, and all turns/patches. Normal mode shows only patches and turns.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T01:39:17.709704-08:00","updated_at":"2025-12-25T01:40:24.223026-08:00","closed_at":"2025-12-25T01:40:24.223026-08:00","dependencies":[{"issue_id":"markform-202.25","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.3","title":"Update LiveAgent to track and return stats","description":"Track historyMessages/responseMessages counts and use result.usage for inputTokens/outputTokens. Return stats in AgentResponse.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:48:50.69923-08:00","updated_at":"2025-12-25T01:24:38.064443-08:00","closed_at":"2025-12-25T01:24:38.064443-08:00","dependencies":[{"issue_id":"markform-202.3","depends_on_id":"markform-202.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.3","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.4","title":"Update MockAgent to return AgentResponse","description":"Update MockAgent.generatePatches() to return { patches, stats: undefined }.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:48:52.663946-08:00","updated_at":"2025-12-25T01:24:38.064446-08:00","closed_at":"2025-12-25T01:24:38.064446-08:00","dependencies":[{"issue_id":"markform-202.4","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.4","depends_on_id":"markform-202.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.5","title":"Update callers to handle AgentResponse","description":"Update programmaticFill.ts, fill.ts command, and examples.ts to destructure { patches, stats } from agent response.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:48:59.081934-08:00","updated_at":"2025-12-25T01:24:38.06445-08:00","closed_at":"2025-12-25T01:24:38.06445-08:00","dependencies":[{"issue_id":"markform-202.5","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.5","depends_on_id":"markform-202.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.5","depends_on_id":"markform-202.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.6","title":"Add llmStats to TurnProgress callback","description":"Add optional llmStats field to TurnProgress interface. Pass stats from agent response to onTurnComplete callback.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:49:01.145067-08:00","updated_at":"2025-12-25T01:24:38.064453-08:00","closed_at":"2025-12-25T01:24:38.064453-08:00","dependencies":[{"issue_id":"markform-202.6","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.6","depends_on_id":"markform-202.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.7","title":"Add llm stats to SessionTurn","description":"Add optional llm field to SessionTurn interface and SessionTurnSchema. Record stats in harness.apply() or fill loop.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:49:03.326266-08:00","updated_at":"2025-12-25T01:24:38.064456-08:00","closed_at":"2025-12-25T01:24:38.064456-08:00","dependencies":[{"issue_id":"markform-202.7","depends_on_id":"markform-202.6","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.7","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.8","title":"Display LLM stats in CLI verbose output","description":"When --verbose is set, display LLM stats (history messages, response messages, tokens) at each turn in fill command output.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:49:08.103154-08:00","updated_at":"2025-12-25T01:24:38.064458-08:00","closed_at":"2025-12-25T01:24:38.064458-08:00","dependencies":[{"issue_id":"markform-202.8","depends_on_id":"markform-202.6","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.8","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-202.9","title":"Update tests for AgentResponse return type","description":"Update unit tests that mock or call generatePatches to handle new return type. Verify stats are correctly tracked and passed through.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T00:49:10.180934-08:00","updated_at":"2025-12-25T01:24:38.064461-08:00","closed_at":"2025-12-25T01:24:38.064461-08:00","dependencies":[{"issue_id":"markform-202.9","depends_on_id":"markform-202","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.9","depends_on_id":"markform-202.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-202.9","depends_on_id":"markform-202.8","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-203","title":"Unified Response Model: Skip/Abort Sentinels and Notes","description":"Implement unified response model with ResponseState/FieldResponse wrapper and notes as first-class concepts.\n\nKey design: Response state (empty/answered/skipped/aborted) is orthogonal to field type. FieldValue.kind remains strictly for field types. Each field has a FieldResponse with state and optional value.\n\nReplaces valuesByFieldId + skipsByFieldId with unified responsesByFieldId. Adds notes as general-purpose mechanism for attaching text to form elements.\n\nSpecs:\n- Plan: docs/project/specs/active/plan-2025-12-25-unified-response-model-with-notes.md\n- Implementation: docs/project/specs/active/impl-2025-12-25-unified-response-model-with-notes.md\n\n8 implementation phases: Core Types, Parsing, Serialization, Apply Logic, Progress \u0026 Completion, Testing, CLI Updates, Architecture Documentation.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-25T13:36:38.100057-08:00","updated_at":"2025-12-26T08:27:07.251490918Z","closed_at":"2025-12-26T08:27:07.251490918Z"}
{"id":"markform-204","title":"Phase 1.1: Add ResponseState type and FieldResponse interface","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:36:54.582133-08:00","updated_at":"2025-12-26T01:15:31.872217739Z","closed_at":"2025-12-26T01:15:31.872217739Z","dependencies":[{"issue_id":"markform-204","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-205","title":"Phase 1.2: Add Note and NoteId types","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:36:55.347372-08:00","updated_at":"2025-12-26T01:15:31.928038551Z","closed_at":"2025-12-26T01:15:31.928038551Z","dependencies":[{"issue_id":"markform-205","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-206","title":"Phase 1.3: Update ParsedForm - replace valuesByFieldId + skipsByFieldId with responsesByFieldId, add notes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:36:56.713893-08:00","updated_at":"2025-12-26T01:15:31.98523704Z","closed_at":"2025-12-26T01:15:31.98523704Z","dependencies":[{"issue_id":"markform-206","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-207","title":"Phase 1.4: Update Patch union - add abort_field, add_note, remove_note, remove_notes; update skip_field with role","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:36:58.144241-08:00","updated_at":"2025-12-26T01:15:32.038386383Z","closed_at":"2025-12-26T01:15:32.038386383Z","dependencies":[{"issue_id":"markform-207","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-208","title":"Phase 1.5: Update FieldProgress - replace submitted/skipped with responseState, add hasNotes, noteCount","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:36:59.423465-08:00","updated_at":"2025-12-26T01:15:32.094273204Z","closed_at":"2025-12-26T01:15:32.094273204Z","dependencies":[{"issue_id":"markform-208","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-209","title":"Phase 1.6: Update ProgressCounts - add abortedFields, emptyFields, totalNotes; remove submittedFields","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:00.834245-08:00","updated_at":"2025-12-26T01:15:32.150359836Z","closed_at":"2025-12-26T01:15:32.150359836Z","dependencies":[{"issue_id":"markform-209","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-210","title":"Phase 1.7: Add ParseError and ValidationError types with error taxonomy","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:01.978902-08:00","updated_at":"2025-12-26T01:15:32.209380802Z","closed_at":"2025-12-26T01:15:32.209380802Z","dependencies":[{"issue_id":"markform-210","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-211","title":"Phase 1.8: Update fieldRegistry.ts for new sentinel FieldValue kinds","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:03.236677-08:00","updated_at":"2025-12-25T15:35:50.650786-08:00","closed_at":"2025-12-25T15:35:50.650786-08:00","dependencies":[{"issue_id":"markform-211","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-212","title":"Phase 2.1: Parse state attribute on field tags (skipped/aborted/empty/answered)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:09.853216-08:00","updated_at":"2025-12-26T07:53:12.305408992Z","closed_at":"2025-12-26T07:53:12.305408992Z","dependencies":[{"issue_id":"markform-212","depends_on_id":"markform-204","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-212","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-213","title":"Phase 2.2: Parse sentinel values (|SKIP|, |ABORT|) in text value fences","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:11.856095-08:00","updated_at":"2025-12-26T07:53:12.362522929Z","closed_at":"2025-12-26T07:53:12.362522929Z","dependencies":[{"issue_id":"markform-213","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-213","depends_on_id":"markform-204","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-214","title":"Phase 2.3: Parse note tags with id, ref, role, optional state","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:13.480578-08:00","updated_at":"2025-12-26T07:53:12.416088929Z","closed_at":"2025-12-26T07:53:12.416088929Z","dependencies":[{"issue_id":"markform-214","depends_on_id":"markform-205","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-214","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-215","title":"Phase 2.4: Validate state vs filled consistency; note ref validation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:15.230815-08:00","updated_at":"2025-12-26T07:53:12.472606146Z","closed_at":"2025-12-26T07:53:12.472606146Z","dependencies":[{"issue_id":"markform-215","depends_on_id":"markform-213","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-215","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-215","depends_on_id":"markform-212","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-216","title":"Phase 3.1: Serialize state attribute on field tags for skipped/aborted responses","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:20.076779-08:00","updated_at":"2025-12-26T07:53:12.582480577Z","closed_at":"2025-12-26T07:53:12.582480577Z","dependencies":[{"issue_id":"markform-216","depends_on_id":"markform-212","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-216","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-217","title":"Phase 3.2: Serialize notes at end of form, sorted numerically by ID","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:21.684655-08:00","updated_at":"2025-12-26T07:53:12.638889222Z","closed_at":"2025-12-26T07:53:12.638889222Z","dependencies":[{"issue_id":"markform-217","depends_on_id":"markform-214","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-217","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-218","title":"Phase 3.3: Value export - structured format by default ({ state, value? })","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:23.334482-08:00","updated_at":"2025-12-26T07:53:12.694546206Z","closed_at":"2025-12-26T07:53:12.694546206Z","dependencies":[{"issue_id":"markform-218","depends_on_id":"markform-204","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-218","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-219","title":"Phase 3.4: Include notes in YAML/JSON export output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:24.809428-08:00","updated_at":"2025-12-26T07:53:12.750968615Z","closed_at":"2025-12-26T07:53:12.750968615Z","dependencies":[{"issue_id":"markform-219","depends_on_id":"markform-217","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-219","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-220","title":"Phase 4.1: Update skip_field - set response to { state: skipped }; reject on required fields","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:29.686262-08:00","updated_at":"2025-12-26T08:07:39.13251581Z","closed_at":"2025-12-26T08:07:39.13251581Z","dependencies":[{"issue_id":"markform-220","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-220","depends_on_id":"markform-207","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-221","title":"Phase 4.2: Implement abort_field patch - set response to { state: aborted }; optional note","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:31.154333-08:00","updated_at":"2025-12-26T08:07:39.132634609Z","closed_at":"2025-12-26T08:07:39.132634609Z","dependencies":[{"issue_id":"markform-221","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-221","depends_on_id":"markform-207","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-222","title":"Phase 4.3: Implement add_note patch - validate ref, generate ID, add to notes array","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:32.622872-08:00","updated_at":"2025-12-26T08:07:39.132664033Z","closed_at":"2025-12-26T08:07:39.132664033Z","dependencies":[{"issue_id":"markform-222","depends_on_id":"markform-207","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-222","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-223","title":"Phase 4.4: Implement remove_note and remove_notes handlers","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:34.234962-08:00","updated_at":"2025-12-26T08:07:39.132691257Z","closed_at":"2025-12-26T08:07:39.132691257Z","dependencies":[{"issue_id":"markform-223","depends_on_id":"markform-207","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-223","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-224","title":"Phase 4.5: Auto-cleanup - when setting value on skipped/aborted field, remove state-linked notes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:36.114506-08:00","updated_at":"2025-12-26T08:07:39.132699418Z","closed_at":"2025-12-26T08:07:39.132699418Z","dependencies":[{"issue_id":"markform-224","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-224","depends_on_id":"markform-220","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-224","depends_on_id":"markform-222","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-225","title":"Phase 5.1: Implement getResponseState(response) helper","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:41.13143-08:00","updated_at":"2025-12-26T08:07:39.13271411Z","closed_at":"2025-12-26T08:01:51.299829259Z","dependencies":[{"issue_id":"markform-225","depends_on_id":"markform-208","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-225","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-226","title":"Phase 5.2: Update computeProgressSummary() - take responsesByFieldId, compute counts from state","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:43.001992-08:00","updated_at":"2025-12-26T08:07:39.132722629Z","closed_at":"2025-12-26T08:01:51.299923946Z","dependencies":[{"issue_id":"markform-226","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-226","depends_on_id":"markform-225","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-227","title":"Phase 5.3: Update isFormComplete() - require abortedFields == 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:44.752783-08:00","updated_at":"2025-12-26T08:07:39.132734422Z","closed_at":"2025-12-26T08:01:51.299941681Z","dependencies":[{"issue_id":"markform-227","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-227","depends_on_id":"markform-226","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-228","title":"Phase 5.4: Update computeFormState() - return invalid when abortedFields \u003e 0","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:46.942797-08:00","updated_at":"2025-12-26T08:07:39.132744782Z","closed_at":"2025-12-26T08:01:51.300046319Z","dependencies":[{"issue_id":"markform-228","depends_on_id":"markform-227","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-228","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-229","title":"Phase 5.5: Update inspect.ts - role-filtered completion, new counts","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:47.910439-08:00","updated_at":"2025-12-26T08:07:39.132752169Z","closed_at":"2025-12-26T08:01:51.300075514Z","dependencies":[{"issue_id":"markform-229","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-229","depends_on_id":"markform-228","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-230","title":"Phase 6.1: Unit tests - parse state attribute on fields","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:53.484195-08:00","updated_at":"2025-12-26T08:24:35.556023932Z","closed_at":"2025-12-26T08:24:35.556023932Z","dependencies":[{"issue_id":"markform-230","depends_on_id":"markform-215","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-230","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-231","title":"Phase 6.2: Unit tests - parse sentinel in value fence","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:55.044437-08:00","updated_at":"2025-12-26T08:24:35.556117589Z","closed_at":"2025-12-26T08:24:35.556117589Z","dependencies":[{"issue_id":"markform-231","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-231","depends_on_id":"markform-215","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-232","title":"Phase 6.3: Unit tests - parse note tags","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:56.518606-08:00","updated_at":"2025-12-26T08:24:35.556143304Z","closed_at":"2025-12-26T08:24:35.556143304Z","dependencies":[{"issue_id":"markform-232","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-232","depends_on_id":"markform-219","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-233","title":"Phase 6.4: Unit tests - serialize state attribute and notes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:58.135043-08:00","updated_at":"2025-12-26T08:24:35.556170222Z","closed_at":"2025-12-26T08:24:35.556170222Z","dependencies":[{"issue_id":"markform-233","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-233","depends_on_id":"markform-224","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-234","title":"Phase 6.5: Unit tests - patch operations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:37:59.787409-08:00","updated_at":"2025-12-26T08:24:35.556179394Z","closed_at":"2025-12-26T08:24:35.556179394Z","dependencies":[{"issue_id":"markform-234","depends_on_id":"markform-229","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-234","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-235","title":"Phase 6.6: Unit tests - progress computation with responseState","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:01.313445-08:00","updated_at":"2025-12-26T08:24:35.556186605Z","closed_at":"2025-12-26T08:24:35.556186605Z","dependencies":[{"issue_id":"markform-235","depends_on_id":"markform-229","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-235","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-236","title":"Phase 6.7: Unit tests - completion logic with abortedFields","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:03.057949-08:00","updated_at":"2025-12-26T08:24:35.556194012Z","closed_at":"2025-12-26T08:24:35.556194012Z","dependencies":[{"issue_id":"markform-236","depends_on_id":"markform-234","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-236","depends_on_id":"markform-235","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-236","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-237","title":"Phase 6.8: Golden tests - sessions with skip/abort/notes patches","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:04.707148-08:00","updated_at":"2025-12-26T08:24:35.556201082Z","closed_at":"2025-12-26T08:24:35.556201082Z","dependencies":[{"issue_id":"markform-237","depends_on_id":"markform-232","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-237","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-238","title":"Phase 7.1: Update CLI inspect to show notes and responseState per field","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:09.608387-08:00","updated_at":"2025-12-26T08:24:35.556218792Z","closed_at":"2025-12-26T08:22:43.636778514Z","dependencies":[{"issue_id":"markform-238","depends_on_id":"markform-229","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-238","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-239","title":"Phase 7.2: Update CLI dump/export to include notes in all formats","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:11.156918-08:00","updated_at":"2025-12-26T08:24:35.55622754Z","closed_at":"2025-12-26T08:22:43.70049847Z","dependencies":[{"issue_id":"markform-239","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-239","depends_on_id":"markform-219","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-240","title":"Phase 8.1: Add ResponseState and FieldResponse documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:15.974394-08:00","updated_at":"2025-12-26T08:24:35.5562346Z","closed_at":"2025-12-26T08:24:35.5562346Z","dependencies":[{"issue_id":"markform-240","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-241","title":"Phase 8.2: Add Note type documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:17.595577-08:00","updated_at":"2025-12-26T08:24:35.556241591Z","closed_at":"2025-12-26T08:24:35.556241591Z","dependencies":[{"issue_id":"markform-241","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-242","title":"Phase 8.3: Update ParsedForm documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:18.962181-08:00","updated_at":"2025-12-26T08:24:35.556250421Z","closed_at":"2025-12-26T08:24:35.556250421Z","dependencies":[{"issue_id":"markform-242","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-243","title":"Phase 8.4: Update Patch operations documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:20.523026-08:00","updated_at":"2025-12-26T08:24:35.556257731Z","closed_at":"2025-12-26T08:24:35.556257731Z","dependencies":[{"issue_id":"markform-243","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-244","title":"Phase 8.5: Add Field State attribute and serialization formats","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:22.061792-08:00","updated_at":"2025-12-26T08:24:35.556268841Z","closed_at":"2025-12-26T08:24:35.556268841Z","dependencies":[{"issue_id":"markform-244","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-245","title":"Phase 8.6: Update ProgressCounts documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:23.496325-08:00","updated_at":"2025-12-26T08:24:35.556280458Z","closed_at":"2025-12-26T08:24:35.556280458Z","dependencies":[{"issue_id":"markform-245","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-246","title":"Phase 8.7: Update completion formula documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:25.005763-08:00","updated_at":"2025-12-26T08:24:35.556294888Z","closed_at":"2025-12-26T08:24:35.556294888Z","dependencies":[{"issue_id":"markform-246","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-247","title":"Phase 8.8: Add error taxonomy section","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:26.692577-08:00","updated_at":"2025-12-26T08:24:35.556311571Z","closed_at":"2025-12-26T08:24:35.556311571Z","dependencies":[{"issue_id":"markform-247","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-248","title":"Phase 8.9: Add design decision for unified response model","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T13:38:28.252823-08:00","updated_at":"2025-12-26T08:24:35.55632164Z","closed_at":"2025-12-26T08:24:35.55632164Z","dependencies":[{"issue_id":"markform-248","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-249","title":"Phase 8.10: Final review - terminology consistency, organization","description":"Final review of architecture doc to ensure all terminology is consistent and well-organized. Key concepts like validation vs parse errors, form filling model, etc. should be clearly presented as part of the markform core model, separate from implementation details.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-25T13:38:32.227515-08:00","updated_at":"2025-12-26T08:24:35.556334201Z","closed_at":"2025-12-26T08:24:35.556334201Z","dependencies":[{"issue_id":"markform-249","depends_on_id":"markform-247","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-246","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-244","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-240","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-245","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-241","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-248","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-243","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-249","depends_on_id":"markform-242","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-250","title":"Phase 2.5: Validate state=skipped on required field -\u003e error; state on field-group -\u003e error","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:36:46.584395-08:00","updated_at":"2025-12-26T07:53:12.527910899Z","closed_at":"2025-12-26T07:53:12.527910899Z","dependencies":[{"issue_id":"markform-250","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-251","title":"Phase 3.5: Friendly YAML export with sentinel strings (optional --friendly flag)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:36:48.319235-08:00","updated_at":"2025-12-26T08:24:35.556343994Z","closed_at":"2025-12-26T08:24:35.556343994Z","dependencies":[{"issue_id":"markform-251","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-252","title":"Phase 4.6: Note ID generation - sequential n1, n2, n3","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:36:49.731934-08:00","updated_at":"2025-12-26T08:07:39.1327069Z","closed_at":"2025-12-26T08:07:39.1327069Z","dependencies":[{"issue_id":"markform-252","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-253","title":"Phase 6.9: Round-trip tests - markdown, YAML, JSON with notes and sentinels","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-25T15:36:51.316015-08:00","updated_at":"2025-12-26T08:24:35.556207999Z","closed_at":"2025-12-26T08:24:35.556207999Z","dependencies":[{"issue_id":"markform-253","depends_on_id":"markform-203","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254","title":"Skip/abort reason embedded in sentinel value","description":"Simplify skip/abort reason storage: embed reason directly in sentinel value using parenthesized syntax |SKIP| (reason) instead of separate notes with state attribute. See plan-2025-12-26-skip-abort-reason-in-sentinel.md","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-26T13:00:21.827536-08:00","updated_at":"2025-12-26T15:40:23.720613-08:00","closed_at":"2025-12-26T15:40:23.720613-08:00"}
{"id":"markform-254.1","title":"Update FieldResponse to add reason field","description":"Add 'reason?: string' field to FieldResponse interface in coreTypes.ts. This field is present only when state is 'skipped' or 'aborted'.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:02.620631-08:00","updated_at":"2025-12-26T15:40:28.940158-08:00","closed_at":"2025-12-26T15:40:28.940158-08:00","dependencies":[{"issue_id":"markform-254.1","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.10","title":"Add round-trip tests for reason serialization","description":"Add tests verifying parse -\u003e serialize -\u003e parse preserves reason exactly for both markdown and structured export formats.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:29.75052-08:00","updated_at":"2025-12-26T15:40:29.130972-08:00","closed_at":"2025-12-26T15:40:29.130972-08:00","dependencies":[{"issue_id":"markform-254.10","depends_on_id":"markform-254.6","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.10","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.11","title":"Add tests for skip/abort patch reason handling","description":"Add tests verifying skip_field/abort_field patches store reason in FieldResponse, setting value clears reason, no notes created.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:36.170018-08:00","updated_at":"2025-12-26T15:40:29.150887-08:00","closed_at":"2025-12-26T15:40:29.150887-08:00","dependencies":[{"issue_id":"markform-254.11","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.11","depends_on_id":"markform-254.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.12","title":"Update architecture documentation","description":"Update arch-markform-design.md.md: Field State Attributes, Note Serialization Format, Layer 2 types, Layer 4 patch definitions, Export formats, Design decisions.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:38.586168-08:00","updated_at":"2025-12-26T15:40:29.17141-08:00","closed_at":"2025-12-26T15:40:29.17141-08:00","dependencies":[{"issue_id":"markform-254.12","depends_on_id":"markform-254.8","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.12","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.12","depends_on_id":"markform-254.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.2","title":"Remove state field from Note interface","description":"Remove 'state?: skipped | aborted' from Note interface and NoteSchema in coreTypes.ts. Notes become purely general-purpose annotations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:07.199532-08:00","updated_at":"2025-12-26T15:40:28.959843-08:00","closed_at":"2025-12-26T15:40:28.959843-08:00","dependencies":[{"issue_id":"markform-254.2","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.3","title":"Remove state parameter from AddNotePatch","description":"Remove 'state?: skipped | aborted' from AddNotePatch type and AddNotePatchSchema in coreTypes.ts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:08.943118-08:00","updated_at":"2025-12-26T15:40:28.982749-08:00","closed_at":"2025-12-26T15:40:28.982749-08:00","dependencies":[{"issue_id":"markform-254.3","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.4","title":"Update sentinel parsing to use parenthesized format","description":"Update parse.ts to parse |SKIP| (reason) and |ABORT| (reason) format. Extract reason from parentheses and store in FieldResponse.reason.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:11.12673-08:00","updated_at":"2025-12-26T15:40:29.004071-08:00","closed_at":"2025-12-26T15:40:29.004071-08:00","dependencies":[{"issue_id":"markform-254.4","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.4","depends_on_id":"markform-254.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.5","title":"Ignore state attribute on notes during parsing","description":"Update parseNotes in parse.ts to ignore state attribute for backward compatibility with legacy forms.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:17.269247-08:00","updated_at":"2025-12-26T15:40:29.025282-08:00","closed_at":"2025-12-26T15:40:29.025282-08:00","dependencies":[{"issue_id":"markform-254.5","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.5","depends_on_id":"markform-254.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.6","title":"Update serialization to emit |SKIP| (reason) format","description":"Update serialize.ts to emit sentinel with parenthesized reason when FieldResponse has a reason. Remove state attribute from note serialization.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:19.250488-08:00","updated_at":"2025-12-26T15:40:29.046585-08:00","closed_at":"2025-12-26T15:40:29.046585-08:00","dependencies":[{"issue_id":"markform-254.6","depends_on_id":"markform-254.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.6","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.7","title":"Update apply.ts to store reason in FieldResponse","description":"Modify applySkipField and applyAbortField to store reason in FieldResponse.reason instead of creating notes. Remove state from applyAddNote.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:21.260669-08:00","updated_at":"2025-12-26T15:40:29.070089-08:00","closed_at":"2025-12-26T15:40:29.070089-08:00","dependencies":[{"issue_id":"markform-254.7","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.7","depends_on_id":"markform-254.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.7","depends_on_id":"markform-254.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.7","depends_on_id":"markform-254.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.8","title":"Update export to include reason field","description":"Update toStructuredValues in exportHelpers.ts to include reason field for skipped/aborted responses. Update friendly format to use |SKIP| (reason).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:26.366039-08:00","updated_at":"2025-12-26T15:40:29.090601-08:00","closed_at":"2025-12-26T15:40:29.090601-08:00","dependencies":[{"issue_id":"markform-254.8","depends_on_id":"markform-254.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.8","depends_on_id":"markform-254.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.8","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-254.9","title":"Add unit tests for sentinel reason parsing","description":"Add tests for parsing |SKIP| (reason), |ABORT| (reason), empty parens, nested parens, and no-reason variants.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:01:28.179317-08:00","updated_at":"2025-12-26T15:40:29.110238-08:00","closed_at":"2025-12-26T15:40:29.110238-08:00","dependencies":[{"issue_id":"markform-254.9","depends_on_id":"markform-254.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-254.9","depends_on_id":"markform-254","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255","title":"AnswerState and FieldState Refactor","description":"Refactor field state model per plan-2025-12-26-answer-state-field-state-refactor.md:\n- Rename ResponseState -\u003e AnswerState with 'empty' -\u003e 'unanswered'\n- Replace ProgressState with valid+empty booleans\n- Refactor ProgressCounts to three orthogonal dimensions\n- Update all types, schemas, and CLI display","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-26T13:45:14.067701-08:00","updated_at":"2025-12-26T15:40:23.74186-08:00","closed_at":"2025-12-26T15:40:23.74186-08:00"}
{"id":"markform-255.1","title":"coreTypes.ts: Rename ResponseState to AnswerState","description":"Phase 1: Core type renames in coreTypes.ts\n- Rename ResponseState type to AnswerState\n- Change 'empty' value to 'unanswered'\n- Rename ResponseStateSchema to AnswerStateSchema\n- Update FieldResponse to use AnswerState\n- Update any comments/docstrings","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:45:23.543082-08:00","updated_at":"2025-12-26T15:40:29.19451-08:00","closed_at":"2025-12-26T15:40:29.19451-08:00","dependencies":[{"issue_id":"markform-255.1","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.10","title":"Documentation: Update architecture doc","description":"Phase 10: Documentation updates\n- Update terminology section with AnswerState definition\n- Update Layer 2 type definitions\n- Update Zod schemas section\n- Replace ProgressState Definitions with Field State Computation section\n- Update InspectResult/ApplyResult documentation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:46:09.812948-08:00","updated_at":"2025-12-26T15:40:29.377848-08:00","closed_at":"2025-12-26T15:40:29.377848-08:00","dependencies":[{"issue_id":"markform-255.10","depends_on_id":"markform-255.9","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.10","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.2","title":"coreTypes.ts: Remove ProgressState, update FieldProgress","description":"Phase 2: ProgressState removal\n- Remove ProgressState type and ProgressStateSchema\n- Update FieldProgress: remove state property, add empty boolean\n- Rename responseState -\u003e answerState property\n- Update FieldProgressSchema accordingly","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:45:29.052905-08:00","updated_at":"2025-12-26T15:40:29.214406-08:00","closed_at":"2025-12-26T15:40:29.214406-08:00","dependencies":[{"issue_id":"markform-255.2","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.2","depends_on_id":"markform-255.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.3","title":"coreTypes.ts: Refactor ProgressCounts to three dimensions","description":"Phase 3: ProgressCounts refactor\n- Rename emptyFields -\u003e unansweredFields (AnswerState dimension)\n- Add validFields (Validity dimension)\n- Add new emptyFields + filledFields (Value dimension)\n- Remove completeFields, incompleteFields, emptyOptionalFields\n- Update ProgressCountsSchema","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:45:34.668372-08:00","updated_at":"2025-12-26T15:40:29.235385-08:00","closed_at":"2025-12-26T15:40:29.235385-08:00","dependencies":[{"issue_id":"markform-255.3","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.3","depends_on_id":"markform-255.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.4","title":"coreTypes.ts: Update InspectResult and ApplyResult","description":"Phase 4: Result type updates\n- Replace formState: ProgressState with formValid + formComplete booleans\n- Update InspectResult interface and schema\n- Update ApplyResult interface and schema","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:45:39.400974-08:00","updated_at":"2025-12-26T15:40:29.25532-08:00","closed_at":"2025-12-26T15:40:29.25532-08:00","dependencies":[{"issue_id":"markform-255.4","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.4","depends_on_id":"markform-255.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.5","title":"summaries.ts: Update computation logic","description":"Phase 5: Computation logic updates\n- Remove computeFieldState function (no longer needed)\n- Update computeFieldProgress to set valid+empty instead of state\n- Replace computeFormState with computeFormStatus returning formValid+formComplete\n- Update computeProgressCounts for three dimensions\n- Update all ResponseState refs to AnswerState","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:45:45.191415-08:00","updated_at":"2025-12-26T15:40:29.275767-08:00","closed_at":"2025-12-26T15:40:29.275767-08:00","dependencies":[{"issue_id":"markform-255.5","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.5","depends_on_id":"markform-255.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.6","title":"apply.ts and inspect.ts: Update engine files","description":"Phase 6: Engine file updates\n- apply.ts: Update ResponseState refs to AnswerState\n- inspect.ts: Update result construction for formValid/formComplete\n- Update any responseState property refs to answerState","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:45:50.379064-08:00","updated_at":"2025-12-26T15:40:29.296101-08:00","closed_at":"2025-12-26T15:40:29.296101-08:00","dependencies":[{"issue_id":"markform-255.6","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.6","depends_on_id":"markform-255.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.7","title":"CLI commands: Update display logic","description":"Phase 7: CLI display updates\n- inspect.ts: Update formatState to formatFormStatus/formatFieldState\n- validate.ts: Same updates\n- apply.ts: Same updates\n- Update report structures for formValid/formComplete","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:45:54.934377-08:00","updated_at":"2025-12-26T15:40:29.316274-08:00","closed_at":"2025-12-26T15:40:29.316274-08:00","dependencies":[{"issue_id":"markform-255.7","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.7","depends_on_id":"markform-255.6","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.8","title":"index.ts: Update exports","description":"Phase 8: Export updates\n- Replace ResponseState export with AnswerState\n- Replace ResponseStateSchema export with AnswerStateSchema\n- Remove ProgressState and ProgressStateSchema exports\n- Verify all new types are exported","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:45:59.519281-08:00","updated_at":"2025-12-26T15:40:29.336732-08:00","closed_at":"2025-12-26T15:40:29.336732-08:00","dependencies":[{"issue_id":"markform-255.8","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.8","depends_on_id":"markform-255.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-255.9","title":"Tests: Update coreTypes.test.ts","description":"Phase 9: Test updates\n- Update ResponseStateSchema tests to AnswerStateSchema\n- Remove ProgressStateSchema tests\n- Add tests for new AnswerState values\n- Add tests for ProgressCounts three dimensions\n- Verify all tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T13:46:04.774936-08:00","updated_at":"2025-12-26T15:40:29.358244-08:00","closed_at":"2025-12-26T15:40:29.358244-08:00","dependencies":[{"issue_id":"markform-255.9","depends_on_id":"markform-255.8","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-255.9","depends_on_id":"markform-255","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-256","title":"Extract standalone specification from architecture doc","description":"Split arch-markform-design.md.md into two documents:\n\n1. **markform-spec.md** - Standalone normative specification containing:\n   - Condensed overview\n   - Terminology/glossary\n   - Layer 1: Syntax (file format, tags, checkbox modes, serialization)\n   - Layer 2: Form Data Model (types, Zod schemas, summaries)\n   - Layer 3: Validation \u0026 Form Filling (rules, hook validators, error taxonomy)\n   - Layer 4: Tool API (operations, patches, result types, priority scoring)\n\n2. **arch-markform-design.md.md** (revised) - Implementation details:\n   - Motivation with spec references\n   - Architecture overview (simplified, refs spec)\n   - v0.1 Scope\n   - Core Architecture\n   - Implementation Components (harness, CLI, web UI, AI SDK, MCP, testing)\n   - NPM Package, Golden Examples, Implementation Order\n   - Future Extensions, Design Decisions\n\nKey changes:\n- Spec uses normative language (MUST/SHOULD/MAY)\n- Architecture doc adds spec references, removes duplicated content\n- Consolidate scattered engine implementation details\n- Cross-link between documents\n\nEstimated: Spec ~1500-1800 lines, Architecture ~2800-3000 lines (from ~4600)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T16:10:22.761277-08:00","updated_at":"2025-12-26T16:36:10.080044-08:00","closed_at":"2025-12-26T16:36:10.080044-08:00"}
{"id":"markform-257","title":"Add 'markform spec' CLI command to print specification","description":"Add a new CLI command 'markform spec' that prints the Markform specification document.\n\nSimilar to how 'markform instructions' (soon 'markform readme') prints the README, this command should print the standalone specification document (markform-spec.md once markform-256 is complete).\n\nImplementation:\n- Add 'spec' command to CLI\n- Load and print the spec document from the package\n- Bundle the spec.md file with the package (similar to README)\n\nDepends on markform-256 (spec extraction) being completed first.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-26T16:14:13.956018-08:00","updated_at":"2025-12-26T16:37:42.504601-08:00","closed_at":"2025-12-26T16:37:42.504601-08:00","dependencies":[{"issue_id":"markform-257","depends_on_id":"markform-256","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-258","title":"Rename 'markform instructions' to 'markform readme'","description":"Simplify the CLI by renaming 'markform instructions' to just 'markform readme'.\n\nPreviously both names were supported as aliases. Simplify to just 'readme':\n- Remove 'instructions' command/alias\n- Keep only 'markform readme'\n- Update any documentation references\n\nThis is a minor cleanup for CLI consistency.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-26T16:14:19.235491-08:00","updated_at":"2025-12-26T16:25:26.729854-08:00","closed_at":"2025-12-26T16:25:26.729854-08:00"}
{"id":"markform-259","title":"Replace non-atomic file writes with atomically library","description":"The project has a rule to use the `atomically` library for file writes (see docs/general/agent-rules/typescript-rules.md), but several files still use `writeFileSync` or `fs.promises.writeFile`.\n\n## Implementation Approach\n\n**CLI code in `src/`**: Use centralized `writeFile` helper in `shared.ts`\n**Package scripts**: Import `atomically` directly (self-contained)\n**Root scripts**: Import `atomically` directly (outside package)\n\n## Files to Fix\n\n### 1. Fix shared helper (highest impact)\n- **packages/markform/src/cli/lib/shared.ts:181** - Change `writeFile` to use `atomically`\n- This automatically fixes 5 command files that use it:\n  - serve.ts:402\n  - fill.ts:516, 542\n  - apply.ts:198, 207\n  - render.ts:79\n\n### 2. Fix exportHelpers to use shared helper\n- **packages/markform/src/cli/lib/exportHelpers.ts:142,146,156,174** - Replace 4x `writeFileSync` with `shared.writeFile`\n\n### 3. Fix package scripts (import atomically directly)\n- **packages/markform/scripts/regen-golden-sessions.ts:114** - 1x `writeFileSync`\n- **packages/markform/scripts/test-live-agent.ts:228,394** - 2x `writeFileSync`\n\n### 4. Fix CLI commands with direct writes\n- **packages/markform/src/cli/commands/examples.ts:316** - 1x `writeFileSync`\n\n### 5. Fix root scripts (import atomically directly)\n- **scripts/create-changeset.ts:42** - 1x `writeFileSync`\n\n## Notes\n- `atomically` is already a dependency\n- Total: ~11 call sites across 6 files\n- For sync contexts, convert to async or use `atomically.writeFileSync()`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T16:16:11.935481-08:00","updated_at":"2025-12-27T01:09:51.653232918Z","closed_at":"2025-12-27T01:09:51.653232918Z"}
{"id":"markform-25g","title":"ARCH-010: Resolve canonical formatting vs fixture blank line conflict","description":"## Problem\nCanonical formatting rule says 'no blank lines between fields' but fixtures (`simple.form.md`, `simple-mock-filled.form.md`) use blank lines between tags.\n\n## Why It Matters\n- Plan relies on golden fixtures and deterministic formatting\n- If canonical output removes all blank lines, fixtures won't match unless regenerated\n- This could cause spurious test failures\n\n## Recommended Fix\nChoose ONE approach:\n- **Option A (recommended):** Loosen canonical formatting to allow ONE blank line between adjacent blocks (improves readability)\n- **Option B:** Keep strict compaction, regenerate all fixtures to match, document as 'canonical expected output'\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (Canonical Serialization section)\n- Possibly: test fixture files if keeping strict formatting\n\n## Blocks\n- markform-1hn (1.3 Canonical Serialization)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:32:06.948886-08:00","updated_at":"2025-12-23T09:24:31.826848587Z","closed_at":"2025-12-23T09:24:31.826848587Z"}
{"id":"markform-260","title":"Include scripts/ in TypeScript type checking","description":"Currently `packages/markform/tsconfig.json` explicitly excludes `scripts/` directory. This means scripts like `regen-golden-sessions.ts` are not type-checked during `pnpm typecheck`.\n\n**Why excluded:** `test-live-agent.ts` has type errors from outdated AI SDK usage:\n- Uses `maxSteps` instead of `stopWhen: stepCountIs(n)`\n- `MarkformToolSet` doesn't satisfy `ToolSet` index signature\n- Missing `answeredFieldCount`/`skippedFieldCount` in session turn recording\n- Missing `expectedCompletedForm` in session final\n\n**To fix:**\n1. Update `test-live-agent.ts` to use current AI SDK API (`stopWhen: stepCountIs()`)\n2. Fix `MarkformToolSet` type to include index signature\n3. Update session recording to include all required fields\n4. Remove `exclude: [\"scripts\"]` from tsconfig.json\n5. Verify `pnpm typecheck` passes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T16:17:22.781044-08:00","updated_at":"2025-12-27T01:13:08.958812468Z","closed_at":"2025-12-27T01:13:08.958812468Z"}
{"id":"markform-261","title":"Spec: Add date-field and year-field types","description":"Epic: Implement date-field and year-field types per plan-2025-12-27-date-field-type.md. Core engine support complete. Remaining: interactive prompts, web UI, examples, documentation.","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-27T00:51:15.446136-08:00","updated_at":"2025-12-28T00:00:00Z"}
{"id":"markform-261.1","title":"Core types: DateField, DateValue, SetDatePatch","description":"Add DateField interface, DateValue type, SetDatePatch, and Zod schemas to coreTypes.ts. Add 'date' to FieldKind union.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:51:48.339112-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.1","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.10","title":"Summaries: date and year in counts","description":"Update computeStructureSummary() and computeProgressSummary() in summaries.ts to handle date and year field kinds.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:52:29.929784-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.10","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.10","depends_on_id":"markform-261.3","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.11","title":"Interactive prompts: date and year input","description":"Add date and year prompts in interactivePrompts.ts. Text input with format validation. Show expected format in prompt.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T00:52:35.076453-08:00","updated_at":"2025-12-27T00:52:35.076453-08:00","dependencies":[{"issue_id":"markform-261.11","depends_on_id":"markform-261.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.11","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.11","depends_on_id":"markform-261.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.11","depends_on_id":"markform-261.6","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.12","title":"Web UI: date and year input rendering","description":"Add date input (type=date) and year input (type=number) rendering in web/serve. Handle min/max attributes as HTML input attributes.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T00:52:40.087154-08:00","updated_at":"2025-12-27T00:52:40.087154-08:00","dependencies":[{"issue_id":"markform-261.12","depends_on_id":"markform-261.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.12","depends_on_id":"markform-261.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.12","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.13","title":"Unit tests: date and year field types","description":"Add unit tests for coreTypes schemas, parser, serializer, validator, apply. Test valid/invalid dates, year ranges, min/max constraints, round-trip.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:52:45.256109-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.13","depends_on_id":"markform-261.6","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.13","depends_on_id":"markform-261.7","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.13","depends_on_id":"markform-261.8","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.13","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.13","depends_on_id":"markform-261.4","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.13","depends_on_id":"markform-261.5","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.14","title":"Example forms: date and year fields","description":"Update simple.form.md with date/year examples. Update startup-deep-research.form.md to use year-field for founded_year and date-field for funding dates.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T00:52:50.268087-08:00","updated_at":"2025-12-27T00:52:50.268087-08:00","dependencies":[{"issue_id":"markform-261.14","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.14","depends_on_id":"markform-261.13","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.15","title":"Documentation: date and year field types","description":"Update arch-markform-design.md (move date from MF/0.2, add year spec). Update README.md to list new field types. Update terminology table.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T00:52:55.479176-08:00","updated_at":"2025-12-27T00:52:55.479176-08:00","dependencies":[{"issue_id":"markform-261.15","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.15","depends_on_id":"markform-261.14","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.2","title":"Core types: YearField, YearValue, SetYearPatch","description":"Add YearField interface, YearValue type, SetYearPatch, and Zod schemas to coreTypes.ts. Add 'year' to FieldKind union. Year stored as number with default range 1000-2500.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:51:53.031746-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.2","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.3","title":"Field registry: date and year types","description":"Add date and year to FIELD_KINDS tuple, FieldTypeMap, createEmptyValue(), and FIELD_SCHEMAS in fieldRegistry.ts. Import new types and schemas.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:51:57.519754-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.3","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.3","depends_on_id":"markform-261.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.3","depends_on_id":"markform-261.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.4","title":"Parser: date-field and year-field tags","description":"Add parseDateField() and parseYearField() functions to parse.ts. Update parseFieldNode() switch. Handle value fences and attributes (format, min, max).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:52:02.23957-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.4","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.4","depends_on_id":"markform-261.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.4","depends_on_id":"markform-261.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.5","title":"Serializer: date and year field output","description":"Add date and year field serialization in serialize.ts. Handle format/min/max attributes. Ensure round-trip consistency.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:52:06.236438-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.5","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.5","depends_on_id":"markform-261.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.5","depends_on_id":"markform-261.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.6","title":"Validator: date format and min/max","description":"Add validateDateField() in validate.ts. Validate YYYY-MM-DD format (default), custom formats, min/max date constraints. Handle impossible dates (Feb 30).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:52:10.837875-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.6","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.6","depends_on_id":"markform-261.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.7","title":"Validator: year range validation","description":"Add validateYearField() in validate.ts. Validate 4-digit integer, default range 1000-2500, custom min/max constraints.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:52:15.456024-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.7","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.7","depends_on_id":"markform-261.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.8","title":"Apply: set_date and set_year patches","description":"Handle set_date and set_year patch operations in apply.ts. Validate patch values match field type.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:52:19.982669-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.8","depends_on_id":"markform-261.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.8","depends_on_id":"markform-261.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.8","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-261.9","title":"Value coercion: date and year types","description":"Add date and year value coercion in valueCoercion.ts. Handle string-to-date and string-to-year conversion from patch input.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T00:52:24.797166-08:00","updated_at":"2025-12-27T17:00:00Z","closed_at":"2025-12-27T17:00:00Z","dependencies":[{"issue_id":"markform-261.9","depends_on_id":"markform-261","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.9","depends_on_id":"markform-261.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-261.9","depends_on_id":"markform-261.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-262","title":"Spec: Refactor parser sentinel handling","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-27T20:54:59.34260643Z","updated_at":"2025-12-27T21:02:22.67999117Z","closed_at":"2025-12-27T21:02:22.67999117Z"}
{"id":"markform-262.1","title":"Add sentinel tests for date-field and year-field","status":"done","priority":1,"issue_type":"task","created_at":"2025-12-27T20:55:19.844184369Z","updated_at":"2025-12-27T20:56:41.223183226Z","dependencies":[{"issue_id":"markform-262.1","depends_on_id":"markform-262","type":"parent-child","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-262.2","title":"Create tryParseSentinelResponse helper function","status":"done","priority":1,"issue_type":"task","created_at":"2025-12-27T20:55:19.940523837Z","updated_at":"2025-12-27T20:57:33.439723975Z","dependencies":[{"issue_id":"markform-262.2","depends_on_id":"markform-262","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-262.2","depends_on_id":"markform-262.1","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-262.3","title":"Refactor all field parsers to use helper","status":"done","priority":1,"issue_type":"task","created_at":"2025-12-27T20:55:20.038920388Z","updated_at":"2025-12-27T21:02:22.62567019Z","dependencies":[{"issue_id":"markform-262.3","depends_on_id":"markform-262","type":"parent-child","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-262.3","depends_on_id":"markform-262.2","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-263","title":"Smart fence serialization for value fences","description":"Implement safe serialization of value fences that prevents fence collision when values contain Markdown with fenced code blocks. Spec: docs/project/specs/active/plan-2025-12-27-smart-fence-serialization.txt","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-27T15:24:08.531393-08:00","updated_at":"2025-12-27T23:48:22.131250916Z","closed_at":"2025-12-27T23:48:22.131250916Z"}
{"id":"markform-264","title":"Add maxRunAtLineStart() helper function","description":"Add maxRunAtLineStart(value: string, char: string): number function to serialize.ts. Matches lines starting with 0-3 spaces followed by runs of the fence char and returns the maximum run length found. Pattern: /^( {0,3})(char+)/gm","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T15:24:16.00468-08:00","updated_at":"2025-12-27T23:42:48.169561248Z","closed_at":"2025-12-27T23:42:48.169561248Z","dependencies":[{"issue_id":"markform-264","depends_on_id":"markform-263","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-265","title":"Add pickFence() helper function","description":"Add pickFence(value: string): { char: '`' | '~'; len: number; processFalse: boolean } function. Check if content contains Markdoc tags (/{%/), compute max backtick and tilde runs at line start, pick char with smaller max-run (length = max(3, maxRun + 1)), prefer backticks on tie.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T15:24:22.79417-08:00","updated_at":"2025-12-27T23:42:48.169655089Z","closed_at":"2025-12-27T23:42:48.169655089Z","dependencies":[{"issue_id":"markform-265","depends_on_id":"markform-263","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-265","depends_on_id":"markform-264","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-266","title":"Update formatValueFence() for smart fence selection","description":"Modify formatValueFence(content: string): string to use pickFence() for determining fence char, length, and process=false flag. Build fence with appropriate char/length and add {% process=false %} after language marker when needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T15:24:39.293333-08:00","updated_at":"2025-12-27T23:42:48.169673451Z","closed_at":"2025-12-27T23:42:48.169673451Z","dependencies":[{"issue_id":"markform-266","depends_on_id":"markform-263","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-266","depends_on_id":"markform-265","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-267","title":"Add unit tests for smart fence selection","description":"Create tests/unit/engine/serialize-fence.test.ts with tests for: maxRunAtLineStart() (no fence chars, triple backticks, tildes, 4+ indent ignored, mixed), pickFence() (plain text, content with code blocks, Markdoc tags, tie-breaker), formatValueFence() (plain content, code blocks, Markdoc).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T15:24:44.690999-08:00","updated_at":"2025-12-27T23:45:21.585409068Z","closed_at":"2025-12-27T23:45:21.585409068Z","dependencies":[{"issue_id":"markform-267","depends_on_id":"markform-263","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-267","depends_on_id":"markform-266","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-268","title":"Add round-trip integration tests for fence escaping","description":"Add integration tests in serialize.test.ts for parse-serialize-parse round-trips with: values containing triple-backtick code blocks, tilde code blocks, Markdoc tags, both backticks and tildes, pathological cases with many fence chars. Verify values are preserved exactly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T15:24:49.831683-08:00","updated_at":"2025-12-27T23:45:21.585495872Z","closed_at":"2025-12-27T23:45:21.585495872Z","dependencies":[{"issue_id":"markform-268","depends_on_id":"markform-267","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-268","depends_on_id":"markform-263","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-269","title":"Verify existing tests pass with fence changes","description":"Run full test suite (pnpm test) to ensure all existing tests pass with the smart fence selection changes. No regressions allowed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-27T15:24:53.766146-08:00","updated_at":"2025-12-27T23:42:48.16969423Z","closed_at":"2025-12-27T23:42:48.16969423Z","dependencies":[{"issue_id":"markform-269","depends_on_id":"markform-266","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-269","depends_on_id":"markform-263","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-270","title":"Update SPEC.md and arch docs with smart fence selection","description":"After implementation is verified working, update documentation to reflect smart fence selection behavior:\n\nSPEC.md changes (Layer 1: Syntax):\n1. Add new section 'Value fence selection' before 'The process=false Attribute' (line ~684) documenting:\n   - Smart fence char selection algorithm (backticks vs tildes)\n   - Fence length determination: max(3, maxRun + 1) where maxRun is max run of fence chars at line start (indent ≤ 3)\n   - Tie-breaker rule: prefer backticks\n\n2. Update 'Canonical formatting rules' table (line ~886) to add:\n   - 'Value fence char' | Backticks preferred; use tildes when backticks would require longer fence\n   - 'Value fence length' | Minimum 3; increase to maxRun+1 when content contains fence chars at line start\n\n3. Add examples showing fence selection in action (after line ~728):\n   - Content with inner triple backticks → outer uses 4 backticks\n   - Content with many tildes → use backticks (shorter)\n   - Content with Markdoc tags + code blocks → process=false + smart fence\n\narch-markform-design.md changes:\n1. Under '### 3) Canonical serialization' (line ~963), add detail about smart fence selection preventing value fence collision\n\n2. Add note in 'Design Decisions' section about the algorithm choice (simple content scan, no escaping)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T15:26:01.371531-08:00","updated_at":"2025-12-27T23:48:22.131113477Z","closed_at":"2025-12-27T23:48:22.131113477Z","dependencies":[{"issue_id":"markform-270","depends_on_id":"markform-263","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-270","depends_on_id":"markform-268","type":"depends-on","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-271","title":"Forms directory feature: centralize all form output to configurable forms/ directory","description":"Add a configurable forms directory (default ./forms) as the parent directory for all form output. CLI commands (examples, fill) and APIs should write forms, YAML exports, and raw markdown to this directory. The directory should be auto-created if missing and gitignored in this repo.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-27T16:45:14.907579-08:00","updated_at":"2025-12-27T16:45:19.758314-08:00"}
{"id":"markform-272","title":"Add DEFAULT_FORMS_DIR setting to settings.ts","description":"Add DEFAULT_FORMS_DIR constant (default './forms') to settings.ts. Include helper function getFormsDir() that returns the resolved absolute path to the forms directory.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T16:45:25.347603-08:00","updated_at":"2025-12-27T16:45:25.347603-08:00","dependencies":[{"issue_id":"markform-272","depends_on_id":"markform-271","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-273","title":"Add ensureFormsDir() utility to create forms directory if missing","description":"Add ensureFormsDir() async function to CLI lib/shared.ts or a new formsDir.ts. Uses the forms directory setting and creates the directory if it doesn't exist using fs.mkdir with recursive: true.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T16:45:30.437135-08:00","updated_at":"2025-12-27T16:45:30.437135-08:00","dependencies":[{"issue_id":"markform-273","depends_on_id":"markform-272","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-273","depends_on_id":"markform-271","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-274","title":"Update examples command to write output to forms directory","description":"Modify examples.ts to: 1) Call ensureFormsDir() at start, 2) Change default output path from process.cwd() to forms directory, 3) Write all outputs (.form.md, .raw.md, .yml) to forms directory.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T16:45:35.190079-08:00","updated_at":"2025-12-27T16:45:35.190079-08:00","dependencies":[{"issue_id":"markform-274","depends_on_id":"markform-273","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-274","depends_on_id":"markform-271","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-275","title":"Update fill command to write output to forms directory","description":"Modify fill.ts to: 1) Call ensureFormsDir() before writing output, 2) When no --output specified, use forms directory as base for versioned path generation instead of input file directory.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T16:45:39.376308-08:00","updated_at":"2025-12-27T16:45:39.376308-08:00","dependencies":[{"issue_id":"markform-275","depends_on_id":"markform-273","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-275","depends_on_id":"markform-271","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-276","title":"Update versioning.ts to support forms directory paths","description":"Add new function generateVersionedPathInFormsDir() that generates versioned filename (e.g., simple-filled1.form.md) within the forms directory. Handles both form basename derivation from input path and version incrementing within forms dir.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T16:45:43.856123-08:00","updated_at":"2025-12-27T16:45:43.856123-08:00","dependencies":[{"issue_id":"markform-276","depends_on_id":"markform-272","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-276","depends_on_id":"markform-271","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-277","title":"Add forms/ to .gitignore","description":"Add 'forms/' entry to the root .gitignore file so that user-generated forms are not committed to the repository.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T16:45:48.365359-08:00","updated_at":"2025-12-27T16:45:48.365359-08:00","dependencies":[{"issue_id":"markform-277","depends_on_id":"markform-271","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-278","title":"Add --forms-dir CLI option to override default forms directory","description":"Add global --forms-dir option to CLI that overrides DEFAULT_FORMS_DIR. Pass this through getCommandContext() or similar mechanism so all commands can access it.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T16:45:53.345473-08:00","updated_at":"2025-12-27T16:45:53.345473-08:00","dependencies":[{"issue_id":"markform-278","depends_on_id":"markform-272","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-278","depends_on_id":"markform-271","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-279","title":"Add unit tests for forms directory utilities","description":"Add tests for: 1) getFormsDir() resolution, 2) ensureFormsDir() creation, 3) generateVersionedPathInFormsDir() versioning logic. Tests should use temp directories to avoid polluting workspace.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T16:45:57.726142-08:00","updated_at":"2025-12-27T16:45:57.726142-08:00","dependencies":[{"issue_id":"markform-279","depends_on_id":"markform-276","type":"depends-on","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-279","depends_on_id":"markform-271","type":"subtask-of","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-2j6","title":"Phase 1: Core Engine with Unit Tests","description":"Implement all core engine functionality using TDD with simple test form.\n\nSub-tasks:\n1.1 Types and Schemas (engine/types.ts)\n1.2 Markdoc Parsing (engine/parse.ts)\n1.3 Canonical Serialization (engine/serialize.ts)\n1.4 Summaries (engine/summaries.ts)\n1.5 Validation (engine/validate.ts)\n1.6 Patch Application (engine/apply.ts)\n1.7 Inspect (engine/inspect.ts)\n1.8 Validate with Simple Form\n1.9 Session Transcript Handling (engine/session.ts)\n\nCheckpoints:\n- All unit tests pass\n- Parse simple.form.md → structure summary matches\n- Round-trip test passes\n- Validation tests pass\n- Patch tests pass","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:36.913155-08:00","updated_at":"2025-12-23T16:41:39.88258266Z","closed_at":"2025-12-23T16:36:36.831987827Z","dependencies":[{"issue_id":"markform-2j6","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:46.002331-08:00","created_by":"daemon"},{"issue_id":"markform-2j6","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:18:47.199817-08:00","created_by":"daemon"},{"issue_id":"markform-2j6","depends_on_id":"markform-2v3","type":"blocks","created_at":"2025-12-22T23:23:06.035801-08:00","created_by":"daemon"},{"issue_id":"markform-2j6","depends_on_id":"markform-069","type":"blocks","created_at":"2025-12-23T00:36:33.174159-08:00","created_by":"daemon"}]}
{"id":"markform-2v3","title":"Verify GitHub Actions CI passes","description":"Push Phase 0 work and verify CI passes on GitHub Actions:\n\n1. Commit and push all Phase 0 scaffolding to a branch\n2. Create PR to trigger CI workflow\n3. Use gh CLI to monitor CI run:\n   - gh run list --limit 5\n   - gh run watch \u003crun-id\u003e\n   - gh run view \u003crun-id\u003e --log-failed (if fails)\n\n4. Verify all CI steps pass:\n   - pnpm install\n   - pnpm lint\n   - pnpm typecheck\n   - pnpm build\n   - pnpm publint\n   - pnpm test\n\n5. Fix any CI failures and re-verify\n\n6. Merge PR to main when CI is green\n\nThis ensures the scaffolding works in a clean environment,\nnot just locally where caches and installed tools may mask issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:22:50.435199-08:00","updated_at":"2025-12-23T16:51:15.926214789Z","closed_at":"2025-12-23T16:51:02.8845981Z","dependencies":[{"issue_id":"markform-2v3","depends_on_id":"markform-o8l","type":"blocks","created_at":"2025-12-22T23:22:59.512576-08:00","created_by":"daemon"},{"issue_id":"markform-2v3","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:22:59.355844-08:00","created_by":"daemon"}]}
{"id":"markform-300","title":"Research API and CLI Command","description":"Implement complete research workflow for markform with web search capabilities.\n\nSee spec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md\n\nPhases:\n- Phase 0a: Naming consistency cleanup (maxIssues -\u003e maxIssuesPerTurn)\n- Phase 0b: LLM settings consolidation (new src/llms.ts)\n- Phase 1: Frontmatter harness config (parse \u0026 resolve)\n- Phase 2: Core research types and validation (src/research/)\n- Phase 3: Research API (runResearch - follows fillForm pattern)\n- Phase 4: CLI commands (research.ts, initial values, file I/O at CLI layer)\n- Phase 5: Examples command integration\n- Phase 6: Update research example forms\n\nDesign principle: Core API (runResearch) works with strings like fillForm(). File I/O is handled at CLI layer using shared helpers.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:55:00Z"}
{"id":"markform-301","title":"Phase 0a: Rename maxIssues to maxIssuesPerTurn","description":"Engineering cleanup for naming consistency. All per-turn limits should use *PerTurn suffix.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 0a)\n\nFiles to update:\n- src/settings.ts: DEFAULT_MAX_ISSUES -\u003e DEFAULT_MAX_ISSUES_PER_TURN\n- src/harness/harnessTypes.ts: maxIssues -\u003e maxIssuesPerTurn in FillOptions\n- src/harness/harness.ts: Update HarnessConfig usage\n- src/harness/programmaticFill.ts: Update fillForm() implementation\n- src/cli/commands/fill.ts: Update CLI option mapping (keep --max-issues flag short)\n- tests/*: Update all test usages\n\nRationale: Distinguishes total limits (maxTurns) from per-turn limits (maxIssuesPerTurn, maxPatchesPerTurn).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-301","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-302","title":"Phase 0b: Create src/llms.ts for LLM settings","description":"Consolidate all LLM-related settings into a new src/llms.ts file.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 0b)\n\nMove from settings.ts:\n- SUGGESTED_LLMS constant\n- formatSuggestedLlms() function\n- WebSearchConfig interface\n- WEB_SEARCH_CONFIG constant\n- hasWebSearchSupport() function\n- getWebSearchConfig() function\n\nAdd new helpers:\n- getWebSearchProviders(): string[] - returns ['openai', 'google', 'xai']\n- formatWebSearchModels(): string - formats for error messages\n- isWebSearchModel(modelId: string): boolean - validates full model ID\n- getSuggestedModels(provider: string): string[] - get models for provider\n\nUpdate imports in:\n- src/harness/liveAgent.ts\n- src/harness/modelResolver.ts\n- src/cli/commands/fill.ts\n- src/index.ts (public exports)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-302","depends_on_id":"markform-301","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-302","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-303","title":"Phase 1.1: Add research defaults to settings.ts","description":"Add research-specific default constants to settings.ts.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 1)\n\nAdd constants:\n- RESEARCH_DEFAULT_MAX_ISSUES_PER_TURN = 3 (research uses focused issues)\n- RESEARCH_DEFAULT_MAX_GROUPS_PER_TURN = 1 (one section at a time)\n\nThese are used by harnessConfigResolver.ts for RESEARCH_DEFAULTS.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-303","depends_on_id":"markform-302","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-303","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-304","title":"Phase 1.2: Add FrontmatterHarnessConfig type to coreTypes.ts","description":"Add harness config type for YAML frontmatter parsing.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 1)\n\nAdd to coreTypes.ts:\n- FrontmatterHarnessConfig interface with snake_case fields:\n  - max_turns?: number\n  - max_issues_per_turn?: number\n  - max_fields_per_turn?: number\n  - max_groups_per_turn?: number\n  - max_patches_per_turn?: number\n\nUpdate FormMetadata interface:\n- Add optional harness?: FrontmatterHarnessConfig field\n\nNaming: YAML uses snake_case, TypeScript uses camelCase.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-304","depends_on_id":"markform-303","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-304","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-305","title":"Phase 1.3: Update parseForm() to populate metadata from frontmatter","description":"Currently parseForm() extracts frontmatter but discards it. Update to populate FormMetadata.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 1)\n\nUpdate src/engine/parse.ts parseForm():\n1. Parse frontmatter YAML properly (use yaml package)\n2. Extract markform.spec -\u003e markformVersion\n3. Extract markform.roles -\u003e roles (default: ['user', 'agent'])\n4. Extract markform.role_instructions -\u003e roleInstructions\n5. Extract markform.harness -\u003e harness config (FrontmatterHarnessConfig)\n6. Return metadata in ParsedForm\n\nNote: Current extractFrontmatter() is very basic - may need yaml package for proper parsing.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-305","depends_on_id":"markform-304","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-305","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-306","title":"Phase 1.4: Add harnessConfigResolver.ts","description":"Create shared harness config resolution with override hierarchy.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 1)\n\nCreate src/cli/lib/harnessConfigResolver.ts:\n- FILL_DEFAULTS: { maxTurns: 100, maxIssuesPerTurn: 10, maxPatchesPerTurn: 20 }\n- RESEARCH_DEFAULTS: { maxTurns: 100, maxIssuesPerTurn: 3, maxPatchesPerTurn: 20, maxGroupsPerTurn: 1 }\n- frontmatterToHarnessConfig(fm): converts snake_case to camelCase\n- resolveHarnessConfig(workflow, frontmatter?, cliOptions?): HarnessConfig\n  - Merge order: defaults \u003c frontmatter \u003c CLI\n  - workflow: 'fill' | 'research' selects defaults\n\nUnit tests for override hierarchy in tests/unit/cli/harnessConfigResolver.test.ts.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-306","depends_on_id":"markform-305","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-306","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-307","title":"Phase 2.1: Create src/research/ module with researchTypes.ts","description":"Create the research module with core types.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 2)\n\nCreate src/research/researchTypes.ts:\n- ResearchOptions interface (extends pattern from FillOptions):\n  - form: string | ParsedForm\n  - model: string (must support web search)\n  - inputContext?: InputContext\n  - maxTurns?, maxIssuesPerTurn?, maxPatchesPerTurn?, maxFieldsPerTurn?, maxGroupsPerTurn?\n  - targetRoles?, fillMode?, onTurnComplete?, signal?\n  - skipValidation?: boolean (for testing)\n\n- ResearchResult interface (extends FillResult):\n  - researchFormValid: boolean\n  - modelId: string\n  - webSearchUsed: boolean\n\n- ResearchFileOptions (for file-based workflow)\n\nRe-export ResearchFormValidation from researchFormValidation.ts.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-307","depends_on_id":"markform-306","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-307","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-308","title":"Phase 2.2: Create researchFormValidation.ts","description":"Validate form structure for research workflow.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 2)\n\nCreate src/research/researchFormValidation.ts:\n\n- ResearchFormValidation interface:\n  - valid: boolean\n  - errors: string[], warnings: string[]\n  - hasUserFields, hasAgentFields: boolean\n  - userFieldCount, agentFieldCount: number\n  - lastUserFieldIndex, firstAgentFieldIndex: number\n\n- validateResearchForm(form: ParsedForm): ResearchFormValidation\n  Checks:\n  1. Frontmatter includes both 'user' and 'agent' roles\n  2. At least one user-role field exists\n  3. At least one agent-role field exists\n  4. All user fields come before agent fields (no interleaving)\n  Uses form.orderIndex to check field order.\n\n- isResearchForm(form: ParsedForm): boolean\n  Quick check - returns true if form appears valid for research.\n\nUnit tests in tests/unit/research/researchFormValidation.test.ts.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-308","depends_on_id":"markform-307","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-308","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-309","title":"Phase 3: Implement runResearch() API","description":"Main research API implementation.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 3)\n\nCreate src/research/research.ts:\n\nasync function runResearch(options: ResearchOptions): Promise\u003cResearchResult\u003e\n1. Parse form if string (use parseForm)\n2. Validate research form structure (unless skipValidation)\n3. Validate model supports web search (use isWebSearchModel from llms.ts)\n4. Resolve harness config: resolveHarnessConfig('research', form.metadata?.harness, options)\n5. Call fillForm() with resolved config and webSearch: true\n6. Build ResearchResult with research-specific metadata\n\nAdd model web search validation:\n- If !isWebSearchModel(options.model), throw with formatWebSearchModels() error\n\nCreate src/research/index.ts with public exports.\n\nIntegration tests with mock agent in tests/integration/research.test.ts.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-309","depends_on_id":"markform-308","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-309","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-310","title":"","description":"CANCELLED: File I/O handled at CLI layer, not in core API. This follows fillForm() pattern.","status":"cancelled","priority":0,"issue_type":"task","created_at":"0001-01-01T00:00:00Z","updated_at":"2025-12-27T17:55:00Z","closed_at":"2025-12-27T17:55:00Z","dependencies":[{"issue_id":"markform-310","depends_on_id":"markform-309","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-310","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-311","title":"Phase 4.1: Create initialValues.ts for CLI field input","description":"Parse and merge field values from CLI.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 4)\n\nCreate src/cli/lib/initialValues.ts:\n\n- parseInlineFieldValues(args: string[]): InputContext\n  Parse 'field=value' pairs after -- separator.\n  Split on first = only (values can contain =).\n\n- loadInitialValuesFile(path: string): Promise\u003cInputContext\u003e\n  Load JSON or YAML file (yaml parser handles both).\n  Error on missing file or invalid syntax.\n\n- mergeInitialValues(file: InputContext, inline: InputContext): InputContext\n  Merge with inline overriding file values.\n\nUnit tests in tests/unit/cli/initialValues.test.ts.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:55:00Z","dependencies":[{"issue_id":"markform-311","depends_on_id":"markform-309","type":"blocks","created_at":"2025-12-27T17:55:00Z"},{"issue_id":"markform-311","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-312","title":"Phase 4.2: Create research.ts CLI command","description":"CLI command for research workflow.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 4)\n\nCreate src/cli/commands/research.ts:\n\n1. Arguments: \u003cform-path\u003e [-- field=value...]\n2. Options:\n   --model, -m (required, must support web search)\n   --initial-values, -i (JSON/YAML file)\n   --output, -o (output path)\n   --export-formats (form,raw,yaml)\n   --max-turns, --max-issues, --max-patches, --max-fields, --max-groups\n   --interactive (prompt for missing user fields)\n   --verbose, -v\n\n3. Validation:\n   - Model must be web-search-capable (fail fast)\n   - Form must be valid research form (isResearchForm)\n\n4. Execution:\n   - Load and parse form\n   - Parse initial values from --initial-values and -- args\n   - Call runResearch()\n   - Write output using exportMultiFormat()\n\nFile I/O handled here at CLI layer, not in core API.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:55:00Z","dependencies":[{"issue_id":"markform-312","depends_on_id":"markform-311","type":"blocks","created_at":"2025-12-27T17:55:00Z"},{"issue_id":"markform-312","depends_on_id":"markform-309","type":"blocks","created_at":"2025-12-27T17:55:00Z"},{"issue_id":"markform-312","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-313","title":"Phase 4.3: Update fill.ts to use resolveHarnessConfig()","description":"Refactor fill command to use shared config resolution.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 4)\n\n1. Import resolveHarnessConfig from cli/lib/harnessConfigResolver\n2. Replace inline defaults with resolveHarnessConfig('fill', frontmatter, cliOptions)\n3. Ensure fill command respects frontmatter harness config if present\n4. Tests for config override hierarchy","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:55:00Z","dependencies":[{"issue_id":"markform-313","depends_on_id":"markform-306","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-313","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-314","title":"Phase 5.1: Add type field to ExampleDefinition","description":"Add type field to distinguish standard vs research examples.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 5)\n\n1. Update ExampleDefinition in cli/lib/cliTypes.ts:\n   type?: 'standard' | 'research'\n\n2. Add docstring explaining the type field\n\n3. Update exampleRegistry.ts to add type field:\n   - startup-deep-research: type: 'research'\n   - celebrity-deep-research: type: 'research'\n   - simple (and others): type: 'standard' (or omit for default)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:55:00Z","dependencies":[{"issue_id":"markform-314","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-315","title":"Phase 5.2: Add promptForWebSearchModel() helper","description":"Model selection helper for research workflow.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 5)\n\nCreate helper in cli/lib/modelHelpers.ts (or add to existing):\n\nasync function promptForWebSearchModel(): Promise\u003cstring\u003e\n\n1. Filter SUGGESTED_LLMS to only include web-search-capable providers\n2. Use inquirer to prompt user to select from filtered list\n3. Format options similar to existing model prompts\n4. Return selected model ID (provider/model)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:55:00Z","dependencies":[{"issue_id":"markform-315","depends_on_id":"markform-302","type":"blocks","created_at":"2025-12-27T17:55:00Z"},{"issue_id":"markform-315","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-316","title":"Phase 5.3: Update examples.ts for research workflow","description":"Integrate research workflow into examples command.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 5)\n\n1. Update menu display:\n   - Show [research] or [interactive] label in example list\n   - Group or sort by type if helpful\n\n2. After user selects example:\n   - Check example.type or use isResearchForm(parsedForm)\n   - If research form:\n     - Use promptForWebSearchModel() instead of regular model prompt\n     - Use resolveHarnessConfig('research', ...)\n     - Call runResearch() or reuse research command logic\n   - If standard form:\n     - Continue with existing interactive fill logic\n\n3. Integration tests for both paths","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:55:00Z","dependencies":[{"issue_id":"markform-316","depends_on_id":"markform-314","type":"blocks","created_at":"2025-12-27T17:55:00Z"},{"issue_id":"markform-316","depends_on_id":"markform-315","type":"blocks","created_at":"2025-12-27T17:55:00Z"},{"issue_id":"markform-316","depends_on_id":"markform-309","type":"blocks","created_at":"2025-12-27T17:55:00Z"},{"issue_id":"markform-316","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-317","title":"Phase 6: Update research example forms with best practices","description":"Apply research form best practices to examples.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Phase 6)\n\nForms to update:\n- packages/markform/examples/startup-deep-research/startup-deep-research.form.md\n- packages/markform/examples/celebrity-deep-research/celebrity-deep-research.form.md\n\nChanges:\n1. Frontmatter order: spec, roles, role_instructions, harness\n2. Add harness config: max_issues_per_turn: 3, max_groups_per_turn: 1\n3. Each field group ends with *_sources URL list field\n4. Source field labels are descriptive (not generic)\n5. Instructions use 'URLs used as sources' (not 'consulted')\n6. Remove redundant all_sources field from metadata section\n\nNote: Some of these changes may already be done - verify current state first.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:55:00Z","dependencies":[{"issue_id":"markform-317","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-318","title":"Add llms.test.ts unit tests","description":"Unit tests for new src/llms.ts module.\n\nSpec: docs/project/specs/active/plan-2025-12-27-research-api-and-cli.md (Test Plan)\n\nCreate tests/unit/llms.test.ts:\n- getWebSearchProviders() returns ['openai', 'google', 'xai']\n- hasWebSearchSupport('openai') returns true\n- hasWebSearchSupport('anthropic') returns false\n- isWebSearchModel('openai/gpt-4o') returns true\n- isWebSearchModel('anthropic/claude-3-5-sonnet') returns false\n- formatWebSearchModels() includes all web-search providers\n- All existing imports work after refactoring","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-318","depends_on_id":"markform-302","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-318","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-319","title":"Update src/index.ts public exports","description":"Export new research module types and llms utilities.\n\nUpdate src/index.ts:\n- Export from './llms.js': hasWebSearchSupport, isWebSearchModel, getWebSearchProviders, formatWebSearchModels, SUGGESTED_LLMS\n- Export from './research/index.js': runResearch, runResearchFromFile, ResearchOptions, ResearchResult, ResearchFormValidation, validateResearchForm, isResearchForm","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T17:40:00Z","updated_at":"2025-12-27T17:40:00Z","dependencies":[{"issue_id":"markform-319","depends_on_id":"markform-309","type":"blocks","created_at":"2025-12-27T17:40:00Z"},{"issue_id":"markform-319","depends_on_id":"markform-300","type":"parent-child","created_at":"2025-12-27T17:40:00Z"}]}
{"id":"markform-4va","title":"ARCH-003: Fix contradictory InspectIssue priority sorting","description":"## Problem\nSpec says 'sorted by priority (descending)' but also says 'priority: 1 = highest'. These are contradictory.\n\nIf 1 = highest and we sort descending, highest priority items appear last.\n\n## Recommended Fix\nPick ONE convention and make both sections match:\n- **Option A (recommended):** 'sorted by priority (ascending)' with '1 = highest' \n- **Option B:** 'sorted by priority (descending)' with 'higher number = higher priority'\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (InspectResult section)\n\n## Blocks\n- markform-bve (1.7 Inspect implementation)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:09.697787-08:00","updated_at":"2025-12-23T09:01:39.74333426Z","closed_at":"2025-12-23T09:01:39.74333426Z"}
{"id":"markform-50a","title":"1.8 Validate with Simple Form","description":"Integration tests with simple.form.md:\n- Verify parse/serialize round-trip\n- Verify all field types parse correctly\n- Verify all checkbox modes work\n- Verify validation catches expected issues","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:45.416377-08:00","updated_at":"2025-12-23T14:17:16.123167101Z","closed_at":"2025-12-23T14:17:16.123167101Z","dependencies":[{"issue_id":"markform-50a","depends_on_id":"markform-1hn","type":"blocks","created_at":"2025-12-22T23:20:02.096667-08:00","created_by":"daemon"},{"issue_id":"markform-50a","depends_on_id":"markform-aae","type":"blocks","created_at":"2025-12-22T23:20:02.246023-08:00","created_by":"daemon"},{"issue_id":"markform-50a","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:58.271985-08:00","created_by":"daemon"},{"issue_id":"markform-50a","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.933867-08:00","created_by":"daemon"}]}
{"id":"markform-70","title":"CLI-REVIEW: Audit CLI commands against typescript-cli-tool-rules.md","description":"## Problem\nPhase 2 CLI commands were implemented before the speculate-update merge brought in updated `typescript-cli-tool-rules.md` best practices.\n\n## Scope\nReview all CLI implementation files against the rules:\n- `packages/markform/src/cli/cli.ts`\n- `packages/markform/src/cli/lib/shared.ts`\n- `packages/markform/src/cli/lib/formatting.ts`\n- `packages/markform/src/cli/commands/inspect.ts`\n- `packages/markform/src/cli/commands/export.ts`\n- `packages/markform/src/cli/commands/serve.ts`\n\n## Rules to Verify (from docs/general/agent-rules/typescript-cli-tool-rules.md)\n\n### Color and Output Formatting\n- [x] Uses picocolors (aliased as pc) for all colors\n- [ ] No hardcoded ANSI escape codes\n- [x] Has shared color utilities in formatting.ts\n\n### Commander.js Patterns\n- [x] Uses Commander.js\n- [ ] Has colored help wrapper (withColoredHelp)\n- [x] Has CommandContext with dryRun, verbose, quiet\n- [ ] Has logDryRun helper with details support\n- [x] Supports --dry-run, --verbose, --quiet global options\n\n### Progress and Feedback\n- [ ] Consider using @clack/prompts for interactive UI (spinners, prompts)\n- [ ] Consistent emoji usage (✅, ❌, ⚠️, ⏰, 🧪)\n\n### Timing and Performance\n- [ ] Display timing for long operations (⏰ emoji)\n\n### Script Structure\n- [x] TypeScript files\n- [x] Handles errors gracefully with exit code 1\n\n### Documentation\n- [x] File-level comments describing purpose\n- [x] Help text on commands and options\n\n## Files to Reference\n- docs/general/agent-rules/typescript-cli-tool-rules.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T15:39:18.678444065Z","updated_at":"2025-12-23T16:17:36.82512157Z","closed_at":"2025-12-23T15:44:45.585663255Z"}
{"id":"markform-71","title":"Migrate to ESM-only output (remove CJS dual-publish)","description":"The build outputs both ESM and CJS formats (tsdown format: [\"esm\", \"cjs\"]). Node.js docs recommend single-format publishing to avoid the dual-package hazard. Since this is a new Node 24+ project with \"type: module\", migrating to ESM-only would eliminate the tsdown warning, follow Node.js best practices, and reduce package size. Changes needed: Update tsdown.config.ts format to [\"esm\"], update package.json exports to remove require/CJS paths.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T16:07:57.499739842Z","updated_at":"2025-12-23T17:32:58.453531214Z","closed_at":"2025-12-23T17:26:34.296664401Z"}
{"id":"markform-72","title":"CLI-REVIEW: Audit CLI against typescript-cli-tool-rules.md best practices","description":"## Objective\nReview all CLI implementation files against docs/general/agent-rules/typescript-cli-tool-rules.md best practices.\n\n## Files to Review\n- packages/markform/src/cli/cli.ts\n- packages/markform/src/cli/lib/shared.ts\n- packages/markform/src/cli/lib/formatting.ts\n- packages/markform/src/cli/commands/inspect.ts\n- packages/markform/src/cli/commands/export.ts\n- packages/markform/src/cli/commands/serve.ts\n- packages/markform/src/cli/commands/apply.ts\n- packages/markform/src/cli/commands/run.ts\n\n## Checklist (from typescript-cli-tool-rules.md)\n\n### Color and Output Formatting\n- [ ] Uses picocolors (aliased as pc) for all colors\n- [ ] No hardcoded ANSI escape codes\n- [ ] Has shared color utilities\n\n### Commander.js Patterns  \n- [ ] Has colored help wrapper (withColoredHelp)\n- [ ] Has CommandContext with dryRun, verbose, quiet\n- [ ] Has logDryRun helper with details support\n- [ ] Supports --dry-run, --verbose, --quiet global options\n\n### Progress and Feedback\n- [ ] Consider using @clack/prompts for interactive UI\n- [ ] Consistent emoji usage (✅, ❌, ⚠️, ⏰, 🧪)\n\n### Timing and Performance\n- [ ] Display timing for long operations\n\n### Documentation\n- [ ] File-level comments describing purpose\n- [ ] Help text on commands and options\n\n## Reference\ndocs/general/agent-rules/typescript-cli-tool-rules.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T16:44:05.605670518Z","updated_at":"2025-12-23T17:32:58.455685199Z","closed_at":"2025-12-23T17:24:31.749724592Z"}
{"id":"markform-73","title":"CLI package setup: make it easier to run markform CLI (pnpm run markform, npx markform, etc)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T17:17:19.822604987Z","updated_at":"2025-12-23T17:19:48.773345361Z","closed_at":"2025-12-23T17:19:48.773345361Z"}
{"id":"markform-74","title":"Update development.md: add usage/testing section with CLI commands, golden tests, and CI consistency","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T17:17:24.100536993Z","updated_at":"2025-12-23T17:20:40.440453241Z","closed_at":"2025-12-23T17:20:40.440453241Z"}
{"id":"markform-75","title":"Expand validation spec: add golden tests, CLI help testing, comprehensive manual validation steps","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T17:17:28.13372025Z","updated_at":"2025-12-23T17:22:19.161484119Z","closed_at":"2025-12-23T17:22:19.161484119Z"}
{"id":"markform-76","title":"Investigate pnpm esbuild build scripts warning and run pnpm approve-builds if needed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T17:17:32.178083279Z","updated_at":"2025-12-23T17:23:42.468840916Z","closed_at":"2025-12-23T17:23:42.468840916Z"}
{"id":"markform-77","title":"CLI: add systematic --format flag (console/plaintext/yaml/json) across all commands","description":"Add consistent output format support across all CLI commands:\n\n**Format options:**\n- console: auto-detect TTY, use ANSI colors if available (default)\n- plaintext: same as console but no ANSI colors  \n- yaml: structured YAML output (existing behavior)\n- json: structured JSON output (existing behavior)\n\n**Commands to update:**\n- inspect: already has --json, add console/plaintext/yaml\n- export: currently JSON only, add other formats\n- apply: add format options for result output\n- serve: may not need (web-based)\n- run: add format for session output\n\n**Implementation:**\n- Add shared --format \u003cformat\u003e option to relevant commands\n- Create output formatter utility\n- Respect NO_COLOR and FORCE_COLOR env vars\n- picocolors handles TTY detection for console mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T17:33:27.787675864Z","updated_at":"2025-12-23T11:27:53.898243-08:00","closed_at":"2025-12-23T11:27:53.898243-08:00"}
{"id":"markform-78","title":"Review simple.form.md covers all major features and tests pass","description":"Review that simple.form.md example form includes:\n\n- All field types (string, number, string_list, single_select, multi_select, checkboxes)\n- All checkbox modes (multi, simple, explicit)\n- Required and optional fields\n- Validation attributes (pattern, minLength, maxLength, min/max for numbers)\n- Custom validators\n- Documentation blocks (description, instructions)\n- Field groups\n\nEnsure tests cover all features and pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T17:37:03.602596645Z","updated_at":"2025-12-23T11:26:32.233108-08:00","closed_at":"2025-12-23T11:26:32.233108-08:00"}
{"id":"markform-79","title":"Make 'required' field explicit in export schema","description":"Currently the export command omits the 'required' field when it's false/undefined, relying on implicit 'absence = optional' semantics. For a schema export consumed by external systems, this should be explicit.\n\n**Current behavior:**\n- Fields with required=true → output has \"required\": true\n- Fields without required → output has no required key (implicit false)\n\n**Desired behavior:**\n- Always output \"required\": true or \"required\": false explicitly\n\n**Files to update:**\n1. Architecture doc - clarify export schema includes explicit required boolean\n2. export.ts - change to always emit required: field.required ?? false","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:21:44.824819-08:00","updated_at":"2025-12-23T11:23:22.199305-08:00","closed_at":"2025-12-23T11:23:22.199305-08:00","dependencies":[{"issue_id":"markform-79","depends_on_id":"markform-80","type":"blocks","created_at":"0001-01-01T00:00:00Z"},{"issue_id":"markform-79","depends_on_id":"markform-81","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-7mt","title":"1.2 Markdoc Parsing (engine/parse.ts)","description":"Implement parseForm(markdown: string): ParsedForm\n- Frontmatter extraction and parsing\n- AST traversal for form/group/field tags\n- Option extraction from list items\n- Value extraction from fence nodes\n- Documentation block extraction\n- Semantic validation (ID uniqueness, refs, etc.)\n- Build orderIndex and idIndex\n- Unit tests for all field types and edge cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:40.796759-08:00","updated_at":"2025-12-23T15:03:22.036684019Z","closed_at":"2025-12-23T15:02:24.951647399Z","dependencies":[{"issue_id":"markform-7mt","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.372862-08:00","created_by":"daemon"},{"issue_id":"markform-7mt","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.219353-08:00","created_by":"daemon"},{"issue_id":"markform-7mt","depends_on_id":"markform-1zs","type":"blocks","created_at":"2025-12-23T00:34:30.312444-08:00","created_by":"daemon"},{"issue_id":"markform-7mt","depends_on_id":"markform-0oa","type":"blocks","created_at":"2025-12-23T00:34:45.995326-08:00","created_by":"daemon"},{"issue_id":"markform-7mt","depends_on_id":"markform-cre","type":"blocks","created_at":"2025-12-23T00:34:46.167081-08:00","created_by":"daemon"}]}
{"id":"markform-7sy","title":"PLAN-001: Update plan to reference existing complex fixture","description":"## Problem\nPlan says 'complex quarterly form to be provided' but `earnings-analysis.form.md` already exists in the test fixtures.\n\n## Why It Matters\n- The fixture is ready to use for testing\n- Plan should reference it in acceptance criteria\n- Avoids duplicate work creating a new complex fixture\n\n## Recommended Fix\n1. Update plan to explicitly use `earnings-analysis.form.md` as the complex fixture\n2. List it in acceptance criteria for relevant phases\n3. Add it to testing plan for end-to-end validation\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T00:32:59.376539-08:00","updated_at":"2025-12-23T09:31:28.252936737Z","closed_at":"2025-12-23T09:31:28.252936737Z"}
{"id":"markform-7to","title":"PLAN-002: Remove nested group references from v0.1 plan","description":"## Problem\nPlan refers to nested groups in complex example, but v0.1 architecture defers nested groups to v0.2.\n\n## Why It Matters\n- Creates confusion about v0.1 scope\n- Could lead to implementing features meant for v0.2\n- Complex fixture should stay within v0.1 constraints\n\n## Recommended Fix\n1. Review plan tasks and examples\n2. Remove or defer any nested-group references\n3. Ensure complex fixture stays within v0.1 scope (flat groups only)\n4. Add explicit 'v0.2 scope' section for nested groups if mentioned\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:00.339123-08:00","updated_at":"2025-12-23T09:31:28.260140912Z","closed_at":"2025-12-23T09:31:28.260140912Z"}
{"id":"markform-80","title":"Update arch doc to specify explicit required in export schema","description":"Add clarification to arch-markform-design.md.md that the export schema always includes an explicit 'required: boolean' field, never omitting it.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:21:59.356064-08:00","updated_at":"2025-12-23T11:23:17.608432-08:00","closed_at":"2025-12-23T11:23:17.608432-08:00"}
{"id":"markform-81","title":"Fix export.ts to always emit required field","description":"Change export.ts line 54 from 'required: field.required' to 'required: field.required ?? false' so the JSON export always includes an explicit boolean.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:22:00.179099-08:00","updated_at":"2025-12-23T11:23:17.608467-08:00","closed_at":"2025-12-23T11:23:17.608467-08:00"}
{"id":"markform-82","title":"CLI apply: implement --dry-run support","description":"The global --dry-run flag is documented but not implemented for the apply command. When --dry-run is passed, the command should output the patch result report without modifying the file. This was discovered during v0.1 validation testing.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T11:24:13.039501-08:00","updated_at":"2025-12-23T11:51:06.64759-08:00","closed_at":"2025-12-23T11:51:06.64759-08:00"}
{"id":"markform-83","title":"CLI export: add --markdown flag to include canonical markdown","description":"The export command outputs schema and values JSON but not the canonical markdown. Add a --markdown flag to optionally include the markdown in the output. This aligns with the markform_get_markdown tool in the AI SDK integration. Discovered during v0.1 validation testing.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T11:24:13.60849-08:00","updated_at":"2025-12-23T11:51:06.647588-08:00","closed_at":"2025-12-23T11:51:06.647588-08:00"}
{"id":"markform-84","title":"CLI serve: auto-open browser by default with --no-open flag to disable","description":"The serve command should automatically open the localhost URL in the user's default browser when the server starts.\n\n**Current behavior:**\n- Server starts and prints URL\n- User must manually open browser and navigate to URL\n\n**Desired behavior:**\n- Server starts and automatically opens default browser to the URL\n- Add `--no-open` flag to disable auto-open (for headless/CI environments)\n\n**Implementation approach:**\nUse the `open` npm package (cross-platform) or Node's native mechanisms to open the default browser. This is the standard pattern used by:\n- Convex CLI\n- Vite dev server\n- Create React App\n- Next.js dev server\n\n**Files to update:**\n- `src/cli/commands/serve.ts` - add browser open logic and `--no-open` flag\n\nNote: The command already has `--no-open` defined but may not be wired up. Verify and implement.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:30:30.367515-08:00","updated_at":"2025-12-23T11:51:06.647584-08:00","closed_at":"2025-12-23T11:51:06.647584-08:00"}
{"id":"markform-85","title":"CLI serve: fix frozen form fields and use proper HTML form elements","description":"The serve command's web UI has critical usability issues that make it non-functional for editing:\n\n**Issues identified:**\n\n1. **Form fields appear frozen** - Users cannot enter values into any fields. The form renders but is not interactive/editable.\n\n2. **Selection fields use text markers instead of HTML controls** - single_select and multi_select fields render as text like:\n   ```\n   ( ) Low\n   ( ) Medium  \n   ( ) High\n   ```\n   Instead of using proper HTML form elements.\n\n**Expected behavior:**\n\n1. All text fields (string, number, string_list) should be editable input elements\n2. `single_select` should render as HTML `\u003cselect\u003e` dropdown or radio buttons\n3. `multi_select` should render as HTML checkboxes\n4. `checkboxes` fields should render as HTML checkboxes with appropriate state markers\n5. All field values should be captured and included when the Save button is clicked\n\n**Files to investigate:**\n- `src/web/server.ts` - HTML template generation\n- `src/web/templates/` - if templates exist\n\n**Reproduction:**\n```bash\npnpm markform serve packages/markform/examples/simple/simple.form.md\n# Open http://localhost:3000\n# Try to edit any field - they appear frozen\n```","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T11:32:55.505189-08:00","updated_at":"2025-12-23T11:43:26.066543-08:00","closed_at":"2025-12-23T11:43:26.066543-08:00"}
{"id":"markform-86","title":"Ensure inspect output structure is consistent across all formats","description":"The inspect command's console/plaintext output should systematically mirror the YAML output structure.\n\n**Current gap:**\n- Progress tallies don't include 'invalid' count (YAML has it, console doesn't)\n- Need to audit all sections for structural parity\n\n**Example of inconsistency:**\nConsole shows:\n```\nProgress:\n  Total fields: 12\n  Required: 9\n  Complete: 0\n  Incomplete: 0\n  Empty (required): 9\n```\n\nBut YAML likely includes an 'invalid' count that's missing from console.\n\n**Task:**\n1. Compare YAML output structure with console output\n2. Ensure all fields present in YAML are also in console/plaintext\n3. Keep same logical groupings and ordering\n4. Only difference should be syntax (YAML vs human-readable formatting)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:37:46.726277-08:00","updated_at":"2025-12-23T11:43:33.314569-08:00","closed_at":"2025-12-23T11:43:33.314569-08:00"}
{"id":"markform-87","title":"Replace --json flag with --format=json consistently across all commands","description":"Remove the standalone `--json` flag from all CLI commands and standardize on `--format=json` (and `--format=yaml`, etc.) everywhere.\n\n**What needs to change:**\n1. Audit all CLI commands for `--json` flag usage\n2. Replace with `--format` option supporting json/yaml/etc.\n3. Update architecture docs to reflect the consistent `--format` pattern\n4. Ensure help text and examples use `--format=json` not `--json`\n\n**Rationale:**\n- Consistency: `--format` is more flexible and extensible\n- Already using `--format` in some places (e.g., `run` command)\n- Single pattern is easier to document and remember","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T11:38:54.801115-08:00","updated_at":"2025-12-23T11:43:33.31461-08:00","closed_at":"2025-12-23T11:43:33.31461-08:00"}
{"id":"markform-88","title":"Add render command for static HTML output","description":"Add a `render` command that generates static HTML output (same rendering as serve command but without the server).\n\n**Default behavior:**\n- Renders the form to HTML and writes to a file with the same stem + .html extension\n- Example: `markform render sample.form.md` → writes `sample.form.html`\n\n**Options:**\n- `--output \u003cpath\u003e` or `-o \u003cpath\u003e`: Override output filename\n\n**Implementation notes:**\n- Reuse `renderFormHtml()` from serve.ts (already exported)\n- Write the complete HTML document to the output file\n- Update architecture docs to document this command\n- **Important:** Serve and render commands MUST share the same rendering logic\n\n**Testing (TDD required):**\n- Add tests that use the render command to generate HTML output\n- Test that HTML output matches expected structure\n- These tests can exercise the HTML rendering more easily than curl-based serve tests\n- Tests should verify all field types render correctly\n\n**Example usage:**\n```bash\n# Default: outputs sample.form.html\nmarkform render sample.form.md\n\n# Custom output path\nmarkform render sample.form.md --output /path/to/output.html\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T11:43:26.604342-08:00","updated_at":"2025-12-23T11:51:06.647547-08:00","closed_at":"2025-12-23T11:51:06.647547-08:00"}
{"id":"markform-89","title":"Implement tiered priority system for inspect issues","description":"Replace sequential issue numbering (P1, P2, P3...) with tiered priority levels.\n\n## Current Problem\nIssues are numbered sequentially (P1-P217), which doesn't communicate actual importance.\n\n## Proposed Design\n\n### Schema Addition\nAdd `priority` field to ValidationIssue with values: \"high\", \"medium\", \"low\"\n\n### Issue Scoring\n- Required field missing = 3 points\n- Validation error = 2 points  \n- Optional field missing = 1 point\n\n### Priority Calculation\nPriority is derived from sum of issue scores:\n- P1: total_score \u003e= 5\n- P2: total_score \u003e= 4\n- P3: total_score \u003e= 3\n- P4: total_score \u003e= 2\n- P5: total_score \u003e= 1\n\n### Console Formatting\nConsistent coloring across all commands:\n- P1: bold red\n- P2: yellow\n- P3: cyan\n- P4: blue\n- P5: dim/gray\n\n## Tasks\n1. Update ValidationIssue interface with priority field\n2. Implement scoring logic in inspect command\n3. Update console formatters for consistent P1-P5 coloring\n4. Update architecture doc to reflect this design","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-23T11:56:18.215829-08:00","updated_at":"2025-12-23T12:13:18.919802-08:00","closed_at":"2025-12-23T12:13:18.919802-08:00"}
{"id":"markform-8ap","title":"1.6 Patch Application (engine/apply.ts)","description":"Implement applyPatches(form: ParsedForm, patches: Patch[]): ApplyResult\n- Structural validation (field/option existence, type checking)\n- Patch semantics (set_*, clear_field, set_checkboxes merge)\n- Transaction semantics (all-or-nothing)\n- Unit tests for all operations and error cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:43.841133-08:00","updated_at":"2025-12-23T15:03:22.038946302Z","closed_at":"2025-12-23T15:02:24.9517035Z","dependencies":[{"issue_id":"markform-8ap","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.597312-08:00","created_by":"daemon"},{"issue_id":"markform-8ap","depends_on_id":"markform-c2w","type":"blocks","created_at":"2025-12-23T00:34:31.093878-08:00","created_by":"daemon"},{"issue_id":"markform-8ap","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.951043-08:00","created_by":"daemon"},{"issue_id":"markform-8ap","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.83889-08:00","created_by":"daemon"}]}
{"id":"markform-90","title":"CLI validate: add new command for summary and issues only","description":"Add new validate command that shows only summary and issues.\n\n**Purpose:**\nQuick validation check without full form content display.\n\n**Output:**\n- Form state (complete/incomplete/empty/invalid)\n- Structure summary (group/field/option counts)\n- Progress summary (required/submitted/complete/etc counts)\n- Issues list with priority, severity, and messages\n\n**Implementation:**\n- Reuse inspect() from engine\n- Reuse formatState, formatPriority, formatSeverity from inspect.ts\n- Extract shared formatting helpers to lib/shared.ts or lib/format.ts\n- Skip the form content section (that's what inspect does now)\n- This is essentially 'inspect without form content'","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:13:51.273107-08:00","updated_at":"2025-12-23T12:19:05.318935-08:00","closed_at":"2025-12-23T12:19:05.318935-08:00","dependencies":[{"issue_id":"markform-90","depends_on_id":"markform-92","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-91","title":"CLI export: default to markdown output only","description":"Change export command to default to markdown output only.\n\n**Current behavior:**\n- Outputs JSON with schema + values + optional markdown\n- Console format shows formatted text export\n\n**Desired behavior:**\n- Default output is canonical markdown only (serialize output)\n- Remove text format display (covered by inspect now)\n- Keep --format=json option for machine-readable schema/values\n- With --compact, output compact JSON\n\n**Implementation:**\n- Change default output to just serialize(form) markdown\n- JSON format still returns { schema, values, markdown }\n- Remove formatConsoleExport text formatting (or simplify greatly)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:13:50.426794-08:00","updated_at":"2025-12-23T12:22:22.996464-08:00","closed_at":"2025-12-23T12:22:22.996464-08:00","dependencies":[{"issue_id":"markform-91","depends_on_id":"markform-92","type":"blocks","created_at":"0001-01-01T00:00:00Z"}]}
{"id":"markform-92","title":"CLI inspect: add full form structure display","description":"Enhance inspect command to show full form structure in addition to summary and issues.\n\n**Current behavior:**\n- Shows form_state, structure counts, progress counts, and issues\n\n**Desired behavior:**\n- Add full form content display (groups → fields → values)\n- Reuse formatFieldValue and group/field display logic from export command\n- Order: summary (structure/progress) → form content → issues\n- This makes inspect the 'verbose overview' command\n\n**Implementation:**\n- Import formatFieldValue helper (or extract to shared module)\n- Add form content section showing groups, fields, and current values\n- Keep existing summary and issues sections","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:14:54.443779-08:00","updated_at":"2025-12-23T12:17:51.512148-08:00","closed_at":"2025-12-23T12:17:51.512148-08:00"}
{"id":"markform-93","title":"Minimize error-prone optionals in architecture - require explicit values","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:19:29.294847-08:00","updated_at":"2025-12-23T12:33:39.895192-08:00","closed_at":"2025-12-23T12:33:39.895192-08:00"}
{"id":"markform-94","title":"Standardize field naming: snake_case for JSON/YAML, camelCase for TypeScript","description":"We are not completely consistent on YAML filename casing. Need to establish and enforce:\n\n**Convention:**\n- All field keys in JSON and YAML: snake_case (e.g., field_count, parent_field_id)\n- All fields in TypeScript: camelCase (e.g., fieldCount, parentFieldId)\n\n**Implementation:**\n- Add conversion layer when exporting to JSON/YAML (camelCase → snake_case)\n- Add conversion layer when deserializing back to TypeScript (snake_case → camelCase)\n- This should be robust since it's only for known fields\n\n**Scope:**\n- Update all architecture docs\n- Update golden tests\n- Update code\n- Ensure everything passes\n\n**Notes:**\n- No backward compatibility needed\n- Can do systematic update all at once","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:22:39.989521-08:00","updated_at":"2025-12-23T13:31:38.402183-08:00","closed_at":"2025-12-23T13:31:38.402183-08:00"}
{"id":"markform-95","title":"Add pnpm precommit target for unified quality gates","description":"Add a unified `pnpm precommit` script that runs all quality gates similar to CI:\n\n**Should include:**\n- Prettier check (or fix)\n- ESLint with cache\n- TypeScript typecheck\n- Test suite\n\n**Documentation:**\n- Document in docs/development.md as the standard process before committing\n- Make it clear this is what developers should run locally\n\n**Integration:**\n- Use this target from lefthook pre-commit/pre-push hooks (see markform-069)\n- Ensures consistency between local hooks and CI\n\n**Reference:**\n- Related: markform-069 (lefthook setup)\n- See: docs/project/research/current/research-modern-typescript-monorepo-package.md (Section 9)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:24:26.880615-08:00","updated_at":"2025-12-23T13:05:37.028853-08:00","closed_at":"2025-12-23T13:05:37.028853-08:00"}
{"id":"markform-96","title":"Move issue category tag from end to after priority in CLI output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:34:24.362956-08:00","updated_at":"2025-12-23T12:36:32.130856-08:00","closed_at":"2025-12-23T12:36:32.130856-08:00"}
{"id":"markform-97","title":"Change default serve port to flag with 3344 default","description":"Add a --port flag to the serve command to configure the port, defaulting to 3344 (a non-standard port to avoid conflicts).\n\nCurrent behavior: hardcoded port\nNew behavior: markform serve --port=3344 (default if not specified)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:45:22.791781-08:00","updated_at":"2025-12-23T12:46:55.446264-08:00","closed_at":"2025-12-23T12:46:55.446264-08:00"}
{"id":"markform-98","title":"Create global settings.ts for consolidated constants","description":"Create a single src/settings.ts file to consolidate global constants that are non-changing but currently scattered across files.\n\n**Initial candidates:**\n- DEFAULT_PORT (serve command, currently 3344)\n- DEFAULT_MAX_TURNS (harness, currently 50)\n- DEFAULT_MAX_PATCHES_PER_TURN (harness, currently 20)\n- DEFAULT_MAX_ISSUES (harness, currently 10)\n- DEFAULT_MODEL (fill command, e.g., anthropic:claude-sonnet-4-5)\n- Any other hardcoded values that should be configurable or centralized\n\n**Benefits:**\n- Single place to find/modify global defaults\n- Easier to document and maintain\n- Clear separation from runtime configuration\n- Consistent defaults across CLI and programmatic usage\n\n**Location:** src/settings.ts (or src/lib/settings.ts)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:47:42.463591-08:00","updated_at":"2025-12-23T13:05:37.028805-08:00","closed_at":"2025-12-23T13:05:37.028805-08:00"}
{"id":"markform-99","title":"Remove hard-coded 'medium' priority default from serialize.ts","description":"The serialize.ts has hard-coded logic like:\n\n```ts\nif (field.priority !== \"medium\") {\n```\n\nThis embeds domain knowledge (default priority value) into generic serialization code.\n\n**Problem:**\n- Serialization shouldn't know about default values\n- Makes it harder to change defaults later\n- Violates separation of concerns\n\n**Options:**\n1. Move default to a constant in settings.ts and reference it\n2. Have the schema define its own defaults, serialize only checks if value differs from schema default\n3. Always serialize priority (simplest but more verbose output)\n\n**Related:** markform-98 (settings.ts consolidation)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T12:49:59.49361-08:00","updated_at":"2025-12-23T13:05:37.028848-08:00","closed_at":"2025-12-23T13:05:37.028848-08:00"}
{"id":"markform-9sy","title":"3.3 Mock Agent (harness/mockAgent.ts)","description":"Implement mock agent:\n- Load completed mock file\n- Extract values from mock\n- On each step, pick recommended fields and generate patches\n- Deterministic execution for testing","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:47.253408-08:00","updated_at":"2025-12-23T16:17:36.827786282Z","closed_at":"2025-12-23T15:53:56.581064535Z","dependencies":[{"issue_id":"markform-9sy","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:54.830125-08:00","created_by":"daemon"},{"issue_id":"markform-9sy","depends_on_id":"markform-o5m","type":"blocks","created_at":"2025-12-22T23:20:56.042419-08:00","created_by":"daemon"}]}
{"id":"markform-aae","title":"1.5 Validation (engine/validate.ts)","description":"Implement validate(form: ParsedForm, opts?): ValidationResult\n- Built-in validators (required, patterns, ranges, counts, checkboxes)\n- Code validator loading via jiti\n- Validator execution and error collection\n- Unit tests for all validation rules","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:43.082645-08:00","updated_at":"2025-12-23T15:03:22.041107215Z","closed_at":"2025-12-23T15:02:24.951679567Z","dependencies":[{"issue_id":"markform-aae","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.804845-08:00","created_by":"daemon"},{"issue_id":"markform-aae","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.684933-08:00","created_by":"daemon"},{"issue_id":"markform-aae","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.428231-08:00","created_by":"daemon"},{"issue_id":"markform-aae","depends_on_id":"markform-p6z","type":"blocks","created_at":"2025-12-23T00:34:33.320792-08:00","created_by":"daemon"},{"issue_id":"markform-aae","depends_on_id":"markform-vd0","type":"blocks","created_at":"2025-12-23T00:34:33.483538-08:00","created_by":"daemon"}]}
{"id":"markform-bg7","title":"ARCH-013: Resolve form_state vs minItems/minSelections inconsistency","description":"## Problem\n`form_state` derived from counts can diverge from 'required issues' if `minItems`/`minSelections` is set without `required=true`.\n\n## Evidence from Fixtures\nIn `simple.form.md`:\n- `tags` has `minItems=1` but no `required=true`\n- `categories` has `minSelections=1` but no `required=true`\n\n## Why It Matters\nThis leads to inconsistency:\n- `inspect` could report a 'required' issue (`min_items_not_met`)\n- But `form_state` computed from `requiredFields` count could still show `complete`\n\n## Decision Required\nChoose ONE and apply consistently:\n1. **Treat `minItems\u003e0` / `minSelections\u003e0` as implicitly required** (affects counts)\n2. **Disallow min constraints unless `required=true`** (simplifies everything)\n3. **Compute `form_state` from issue severities** instead of counts\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (progress computation + required semantics)\n\n## Depends On\n- ARCH-008 (explicit checkbox validation)\n- ARCH-009 (single-select semantics)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T00:32:09.340078-08:00","updated_at":"2025-12-23T09:25:01.910047718Z","closed_at":"2025-12-23T09:25:01.910047718Z","dependencies":[{"issue_id":"markform-bg7","depends_on_id":"markform-vd0","type":"blocks","created_at":"2025-12-23T00:34:33.176379-08:00","created_by":"daemon"},{"issue_id":"markform-bg7","depends_on_id":"markform-p6z","type":"blocks","created_at":"2025-12-23T00:34:33.034497-08:00","created_by":"daemon"}]}
{"id":"markform-bld","title":"1.4 Summaries (engine/summaries.ts)","description":"Implement summary computation:\n- computeStructureSummary(schema): StructureSummary\n- computeProgressSummary(schema, values, issues): ProgressSummary\n- Submission/completion state computation\n- Unit tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:42.275414-08:00","updated_at":"2025-12-23T15:03:22.043192711Z","closed_at":"2025-12-23T15:02:24.95167045Z","dependencies":[{"issue_id":"markform-bld","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.268849-08:00","created_by":"daemon"},{"issue_id":"markform-bld","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.650331-08:00","created_by":"daemon"},{"issue_id":"markform-bld","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.542497-08:00","created_by":"daemon"}]}
{"id":"markform-bmy","title":"1.1 Types and Schemas (engine/types.ts)","description":"Define all TypeScript types and Zod schemas:\n- Id, OptionId, QualifiedOptionRef\n- Checkbox types and values\n- Field union type (all 6 field types)\n- FormSchema, FieldGroup, FieldBase\n- All field interfaces\n- DocumentationBlock\n- ParsedForm, IdIndexEntry\n- Patch union type\n- ValidationIssue types\n- InspectIssue, InspectResult, ApplyResult\n- Summary types\n- Session transcript types\n- MarkformFrontmatter","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:39.873559-08:00","updated_at":"2025-12-23T15:03:22.045660608Z","closed_at":"2025-12-23T15:02:24.951576921Z","dependencies":[{"issue_id":"markform-bmy","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.2301-08:00","created_by":"daemon"},{"issue_id":"markform-bmy","depends_on_id":"markform-gv1","type":"blocks","created_at":"2025-12-23T00:34:29.556885-08:00","created_by":"daemon"}]}
{"id":"markform-bve","title":"1.7 Inspect (engine/inspect.ts)","description":"Implement inspect(form: ParsedForm): InspectResult\n- Issue prioritization logic\n- ValidationIssue to InspectIssue mapping\n- Completion check (isComplete)\n- Unit tests for issue ordering","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:44.726863-08:00","updated_at":"2025-12-23T14:13:43.562511724Z","closed_at":"2025-12-23T14:13:43.562511724Z","dependencies":[{"issue_id":"markform-bve","depends_on_id":"markform-1qs","type":"blocks","created_at":"2025-12-23T00:34:32.219267-08:00","created_by":"daemon"},{"issue_id":"markform-bve","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:58.100143-08:00","created_by":"daemon"},{"issue_id":"markform-bve","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.993428-08:00","created_by":"daemon"},{"issue_id":"markform-bve","depends_on_id":"markform-aae","type":"blocks","created_at":"2025-12-22T23:20:01.764027-08:00","created_by":"daemon"},{"issue_id":"markform-bve","depends_on_id":"markform-4va","type":"blocks","created_at":"2025-12-23T00:34:32.056702-08:00","created_by":"daemon"}]}
{"id":"markform-c2w","title":"ARCH-006: Fix clear_field patch semantics for select/checkbox fields","description":"## Problem\nSpec says `clear_field` 'serializes as empty tag (no value fence)' but for select/checkbox fields, the value is in the option markers list, not a `value` fence.\n\n## Why It Matters\n- Scalar/list fields: value is in a fenced block\n- Select/checkbox fields: value is in option markers like `[x]`, `[ ]`, `[y]`, `[n]`\n- Current spec doesn't distinguish these cases\n- applyPatches implementation would be ambiguous\n\n## Recommended Fix\nDefine `clear_field` semantics per field kind:\n- **Scalar/list fields:** clear = remove `value` fence entirely\n- **Select/checkbox fields:** clear = reset all markers to their default state:\n  - single-select: all `( )`\n  - multi-select: all `[ ]`  \n  - simple checkboxes: all `[ ]`\n  - multi checkboxes: all `[-]`\n  - explicit checkboxes: all `[_]` (unfilled)\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (Patch Operations section)\n\n## Blocks\n- markform-8ap (1.6 Patch Application)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:12.069746-08:00","updated_at":"2025-12-23T09:09:47.167007921Z","closed_at":"2025-12-23T09:09:47.167007921Z"}
{"id":"markform-c7v","title":"2.4 Serve Command (cli/commands/serve.ts)","description":"Implement serve command:\n- HTTP server setup\n- HTML rendering of form structure (groups, fields, checkboxes, docs)\n- CSS styling for readability\n- Save button with versioned filename logic","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:22.489667-08:00","updated_at":"2025-12-23T15:17:40.822431629Z","closed_at":"2025-12-23T15:17:31.006138694Z","dependencies":[{"issue_id":"markform-c7v","depends_on_id":"markform-g3k","type":"blocks","created_at":"2025-12-22T23:20:31.417234-08:00","created_by":"daemon"},{"issue_id":"markform-c7v","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:20:30.20486-08:00","created_by":"daemon"}]}
{"id":"markform-clq","title":"3.1 Apply Command (cli/commands/apply.ts)","description":"Implement apply command:\n- Parse form file\n- Parse patches from --patch JSON argument\n- Apply patches\n- Write canonical output\n- Report issues","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:45.603488-08:00","updated_at":"2025-12-23T16:17:36.829854917Z","closed_at":"2025-12-23T15:47:03.398878129Z","dependencies":[{"issue_id":"markform-clq","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:54.538973-08:00","created_by":"daemon"},{"issue_id":"markform-clq","depends_on_id":"markform-g3k","type":"blocks","created_at":"2025-12-22T23:20:55.86385-08:00","created_by":"daemon"}]}
{"id":"markform-cre","title":"PLAN-005: Add task for doc body raw slice preservation","description":"## Problem\nArchitecture requires doc bodies be preserved verbatim for deterministic round-trip, but plan doesn't explicitly cover capturing raw text ranges.\n\n## Why It Matters\n- Doc blocks contain user-written markdown that must not be altered\n- Need to capture the exact source text, not a reconstructed version\n- Markdoc node location metadata may or may not be available\n\n## Recommended Fix\nAdd explicit tasks:\n1. Document how to get source ranges from Markdoc node location metadata\n2. Add fallback strategy if location isn't available for some nodes\n3. Add tests verifying doc body round-trip preservation\n4. Test with various markdown content (lists, code blocks, etc.)\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md (add to Phase 1 parsing tasks)\n\n## Blocks\n- markform-7mt (1.2 Markdoc Parsing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:03.046834-08:00","updated_at":"2025-12-23T09:31:58.338687563Z","closed_at":"2025-12-23T09:31:58.338687563Z"}
{"id":"markform-cvf","title":"Setup CI workflow","description":"Setup GitHub Actions CI workflow per research doc:\n\n.github/workflows/ci.yml:\n- Triggers: pull_request, push to main\n- Jobs: test\n- Steps:\n  1. actions/checkout@v5\n  2. pnpm/action-setup@v4 (version: 10)\n  3. actions/setup-node@v6 (node-version: 24, cache: pnpm)\n  4. pnpm install --frozen-lockfile\n  5. pnpm lint\n  6. pnpm typecheck\n  7. pnpm build\n  8. pnpm publint\n  9. pnpm test\n\n.github/workflows/release.yml:\n- Triggers: push to main\n- Permissions: contents write, pull-requests write\n- Steps:\n  1. actions/checkout@v5 (fetch-depth: 0)\n  2. pnpm/action-setup@v4\n  3. actions/setup-node@v6 (registry-url: npm)\n  4. pnpm install --frozen-lockfile\n  5. changesets/action@v1 (publish: pnpm release)\n\nRepository settings note:\n- Actions → Workflow permissions → Read and write\n\nRef: docs/project/research/current/research-modern-typescript-monorepo-package.md (Section 8)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:06.382955-08:00","updated_at":"2025-12-23T15:03:22.047621627Z","closed_at":"2025-12-23T15:02:59.222156365Z","dependencies":[{"issue_id":"markform-cvf","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:13.416831-08:00","created_by":"daemon"},{"issue_id":"markform-cvf","depends_on_id":"markform-zt3","type":"blocks","created_at":"2025-12-22T23:19:14.594297-08:00","created_by":"daemon"}]}
{"id":"markform-cx7","title":"4.1 AI SDK Tool Definitions (integrations/ai-sdk.ts)","description":"Implement createMarkformTools(options) factory:\n- markform_inspect tool\n- markform_apply tool\n- markform_export tool\n- markform_get_markdown tool\n- Zod input schemas for all tools\n- Tool execute functions wrapping engine","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:21:06.003801-08:00","updated_at":"2025-12-23T16:31:19.764786777Z","closed_at":"2025-12-23T16:29:41.178351183Z","dependencies":[{"issue_id":"markform-cx7","depends_on_id":"markform-x39","type":"blocks","created_at":"2025-12-22T23:21:13.585204-08:00","created_by":"daemon"}]}
{"id":"markform-d5y","title":"ARCH-011: Separate input vs output frontmatter schema","description":"## Problem\nFrontmatter schema shown as required (`formSummary`, `formProgress`, `formState`) but example input forms only provide `markform_version`.\n\n## Why It Matters\n- Input forms (templates) should have minimal frontmatter\n- Output forms (after processing) include derived metadata\n- Current spec conflates these two schemas\n\n## Recommended Fix\nSeparate schemas:\n- **Input frontmatter:** `markform_version` (required), optional user metadata\n- **Output frontmatter:** Adds `formSummary`, `formProgress`, `formState` (derived on serialize)\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (Frontmatter section)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:32:07.75524-08:00","updated_at":"2025-12-23T09:24:31.833743488Z","closed_at":"2025-12-23T09:24:31.833743488Z"}
{"id":"markform-dl1","title":"2.2 Inspect Command (cli/commands/inspect.ts)","description":"Implement inspect command:\n- Parse form file\n- Run validation\n- Output YAML report with structure/progress summary, form state, issues\n- Colored output for terminal","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:21.091384-08:00","updated_at":"2025-12-23T15:17:40.825349445Z","closed_at":"2025-12-23T15:17:31.00611183Z","dependencies":[{"issue_id":"markform-dl1","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:20:29.868149-08:00","created_by":"daemon"},{"issue_id":"markform-dl1","depends_on_id":"markform-g3k","type":"blocks","created_at":"2025-12-22T23:20:31.018952-08:00","created_by":"daemon"}]}
{"id":"markform-e89","title":"ARCH-002: Clarify ID uniqueness rules (global vs field-scoped)","description":"## Problem\nSemantic validation says 'Globally-unique IDs across all elements', but options are explicitly field-scoped.\n\n## Why It Matters\nThe current wording implies options must have globally unique IDs, which contradicts the field-scoped design where `field1.opt_a` and `field2.opt_a` are both valid.\n\n## Recommended Fix\nClarify uniqueness rules explicitly:\n- Form/group/field IDs are globally unique within the form\n- Option IDs are unique only within their parent field\n- Doc blocks are unique by `(ref, kind)` tuple\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (semantic validation section)\n\n## Related\n- ARCH-001 (option indexing fix)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:08.963341-08:00","updated_at":"2025-12-23T09:00:32.547086124Z","closed_at":"2025-12-23T09:00:32.547086124Z","dependencies":[{"issue_id":"markform-e89","depends_on_id":"markform-gv1","type":"blocks","created_at":"2025-12-23T00:34:47.580456-08:00","created_by":"daemon"}]}
{"id":"markform-ejt","title":"Phase 0: Project Scaffolding","description":"Set up pnpm monorepo with all tooling configured.\n\nDeliverables:\n- Initialize pnpm workspace structure\n- Create root package.json with workspace scripts\n- Create pnpm-workspace.yaml\n- Create .npmrc with workspace settings\n- Create tsconfig.base.json with shared TypeScript config\n- Create packages/markform/ directory structure\n- Create package package.json with exports, dependencies, scripts\n- Create tsdown.config.ts for build\n- Create tsconfig.json extending base\n- Create eslint.config.js (flat config)\n- Set up .changeset/ for versioning\n- Create .github/workflows/ci.yml\n- Create placeholder src/index.ts\n- Create initial test file\n- Verify pnpm build, test, lint all pass\n\nCheckpoints:\n- pnpm build passes\n- pnpm test passes\n- pnpm lint passes\n- pnpm typecheck passes","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:36.219599-08:00","updated_at":"2025-12-23T16:41:39.884521138Z","closed_at":"2025-12-23T16:36:41.355564292Z","dependencies":[{"issue_id":"markform-ejt","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:45.863147-08:00","created_by":"daemon"}]}
{"id":"markform-fdu","title":"FORM-COMPANY-001: Fix comment syntax in company form","description":"## Problem\n`earnings-analysis.form.md` uses `{# PART ... #}` separators which aren't Markdoc comment syntax per Markdoc docs. Markdoc uses HTML comments (`\u003c!-- ... --\u003e`).\n\n## Why It Matters\n- These will be parsed as plain text nodes, not comments\n- Serializer behavior is unspecified for these nodes\n- Could cause silent data loss on round-trip\n\n## Recommended Fix\nAfter ARCH-007 decision:\n1. **If using HTML comments:** Convert `{# PART 1 ... #}` to `\u003c!-- PART 1 ... --\u003e`\n2. **If removing comments:** Delete the separator lines entirely\n3. **If Markform-only convention:** Keep as-is (requires ARCH-007 to define behavior)\n\n## Files to Update\n- docs/project/test-fixtures/forms/earnings-analysis.form.md\n\n## Depends On\n- ARCH-007 (need decision on comment syntax first)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:33:51.85613-08:00","updated_at":"2025-12-23T09:39:04.644921503Z","closed_at":"2025-12-23T09:39:04.644921503Z","dependencies":[{"issue_id":"markform-fdu","depends_on_id":"markform-gyn","type":"blocks","created_at":"2025-12-23T00:34:28.879595-08:00","created_by":"daemon"}]}
{"id":"markform-g3k","title":"2.1 CLI Infrastructure (cli/)","description":"Create CLI infrastructure per TypeScript CLI Rules:\n- bin.ts entry point with commander setup\n- lib/colors.ts (picocolors wrapper)\n- lib/shared.ts (context helpers, debug, dry-run)\n- lib/formatting.ts (output formatting)\n- Global options: --verbose, --quiet, --dry-run\n- Colored help text","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:20.336047-08:00","updated_at":"2025-12-23T15:17:40.827399882Z","closed_at":"2025-12-23T15:17:31.006035679Z","dependencies":[{"issue_id":"markform-g3k","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:20:29.694434-08:00","created_by":"daemon"}]}
{"id":"markform-gv1","title":"ARCH-001: Fix idIndex type for field-scoped option IDs","description":"## Problem\nOption IDs are field-scoped but `ParsedForm.idIndex: Map\u003cId, IdIndexEntry\u003e` claims to index `kind:'option'` too. Option IDs can repeat across fields, so a global `Map\u003cId,...\u003e` can't safely index options.\n\n## Why It Matters\n- `QualifiedOptionRef = \\`${Id}.${OptionId}\\`` is defined for external references\n- But `idIndex` uses plain `Id` as key, which can't represent qualified refs\n- This will cause collisions when multiple fields have options with same local ID\n\n## Recommended Fix\n**Option A (recommended):** Separate indices\n- `idIndex: Map\u003cId, IdIndexEntry\u003e` for form/group/field only\n- `optionIndex: Map\u003cQualifiedOptionRef, OptionIndexEntry\u003e` for options\n\n**Option B:** Single string-keyed index\n- `idIndex: Map\u003cstring, IdIndexEntry\u003e` accepting both `Id` and `QualifiedOptionRef`\n\n## Also Fix\n- Semantic validation bullet 'Globally-unique IDs across all elements' should exclude options\n- Options are only unique within their parent field\n- Update ParsedForm interface in architecture doc\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md\n\n## Blocks\n- markform-bmy (1.1 Types and Schemas)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-23T00:30:23.013095-08:00","updated_at":"2025-12-23T09:00:11.677786081Z","closed_at":"2025-12-23T09:00:11.677786081Z"}
{"id":"markform-gyn","title":"ARCH-007: Fix Markdoc comment syntax in spec and fixtures","description":"## Problem\nArchitecture assumes `{# ... #}` is Markdoc comment syntax, but Markdoc uses HTML comments (`\u003c!-- ... --\u003e`). The `process=false` detection regex also incorrectly includes `{#`.\n\nPer Markdoc docs: comment support uses HTML comments and requires `allowComments: true` on `Markdoc.Tokenizer`.\n\n## Why It Matters\n- `earnings-analysis.form.md` uses `{# PART 1 ... #}` separators\n- If Markdoc doesn't treat those as comments, they appear as plain text nodes\n- Serializer is not specified to preserve them → silent data loss risk on round-trip\n\n## Decision Required\nChoose ONE approach and codify it:\n\n**Option A: Align with Markdoc**\n- Switch all 'comment blocks' in examples/forms to `\u003c!-- ... --\u003e`\n- Optionally enable `allowComments: true` in tokenizer\n- HTML comments are parseable as HTML nodes even without the flag\n\n**Option B: Define Markform-only comments**\n- Keep `{# ... #}` but define it explicitly as Markform convention (not Markdoc)\n- Specify whether preserved or discarded by canonical serialization\n- Update process=false detection to NOT include `{#`\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md\n- docs/project/test-fixtures/forms/earnings-analysis.form.md\n- Any other fixtures using `{# #}` syntax\n\n## Blocks\n- ARCH-012 (non-Markform nodes policy)\n- PLAN-003 (process=false emission)\n- FORM-COMPANY-001 (company form comments)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-23T00:30:24.107563-08:00","updated_at":"2025-12-23T08:58:38.839683167Z","closed_at":"2025-12-23T08:58:38.839683167Z"}
{"id":"markform-h0z","title":"1.9 Session Transcript Handling (engine/session.ts)","description":"Implement session handling:\n- parseSession(yaml: string): SessionTranscript\n- serializeSession(session: SessionTranscript): string\n- Session schema validation via Zod\n- YAML serialization with snake_case\n- Comprehensive round-trip validation tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:46.120428-08:00","updated_at":"2025-12-23T15:03:22.049794556Z","closed_at":"2025-12-23T15:02:24.95171358Z","dependencies":[{"issue_id":"markform-h0z","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:58.430656-08:00","created_by":"daemon"},{"issue_id":"markform-h0z","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:20:00.144739-08:00","created_by":"daemon"}]}
{"id":"markform-ja8","title":"Initialize pnpm workspace structure","description":"Initialize pnpm workspace following research-modern-typescript-monorepo-package.md:\n\nRoot package.json:\n- name: markform-workspace\n- private: true\n- packageManager: pnpm@10.26.1\n- engines: { node: '\u003e=24' }\n- Scripts: build, test, lint, typecheck, publint, changeset, version-packages, release\n\npnpm-workspace.yaml:\n- packages: ['packages/*']\n\n.npmrc:\n- save-workspace-protocol=true\n- prefer-workspace-packages=true\n\ntsconfig.base.json (per research doc):\n- target: ES2024\n- lib: ['ES2024']\n- module: ESNext\n- moduleResolution: Bundler\n- strict: true\n- noUncheckedIndexedAccess: true\n- verbatimModuleSyntax: true\n- skipLibCheck: true\n- forceConsistentCasingInFileNames: true\n\nRef: docs/project/research/current/research-modern-typescript-monorepo-package.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:04.224762-08:00","updated_at":"2025-12-23T15:03:22.051854643Z","closed_at":"2025-12-23T15:02:59.22204577Z","dependencies":[{"issue_id":"markform-ja8","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:12.991725-08:00","created_by":"daemon"}]}
{"id":"markform-jvy","title":"PLAN-003: Align plan with architecture on process=false emission","description":"## Problem\nPlan instructs 'Ensure `process=false` on all value fences' but architecture says emit `process=false` only when the value contains Markdoc syntax (`{%` sequences).\n\n## Why It Matters\n- Creates spec conflict between plan and architecture\n- Golden fixtures could fight the actual spec\n- Implementers won't know which rule to follow\n\n## Recommended Fix\n1. Update plan to match architecture: emit `process=false` only when value contains Markdoc syntax\n2. Add test cases for both scenarios (with and without Markdoc syntax in values)\n3. Ensure golden fixtures reflect the conditional emission rule\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md\n\n## Depends On\n- ARCH-007 (comment syntax decision affects what triggers process=false)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:33:01.243229-08:00","updated_at":"2025-12-23T09:31:38.290841983Z","closed_at":"2025-12-23T09:31:38.290841983Z","dependencies":[{"issue_id":"markform-jvy","depends_on_id":"markform-gyn","type":"blocks","created_at":"2025-12-23T00:34:28.736886-08:00","created_by":"daemon"}]}
{"id":"markform-k3z","title":"3.4 Run Command (cli/commands/run.ts)","description":"Implement run command:\n- --mock flag for mock mode\n- --completed-mock \u003cfile\u003e for mock values source\n- --record \u003cfile\u003e to output session transcript\n- Execute harness loop to completion\n- Output session YAML","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:47.969934-08:00","updated_at":"2025-12-23T16:17:36.83216684Z","closed_at":"2025-12-23T15:58:19.164149653Z","dependencies":[{"issue_id":"markform-k3z","depends_on_id":"markform-o5m","type":"blocks","created_at":"2025-12-22T23:20:56.221164-08:00","created_by":"daemon"},{"issue_id":"markform-k3z","depends_on_id":"markform-9sy","type":"blocks","created_at":"2025-12-22T23:20:56.376048-08:00","created_by":"daemon"},{"issue_id":"markform-k3z","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:54.987236-08:00","created_by":"daemon"}]}
{"id":"markform-kak","title":"2.3 Export Command (cli/commands/export.ts)","description":"Implement export command:\n- Parse form file\n- Output JSON: { schema, values }","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:21.75947-08:00","updated_at":"2025-12-23T15:17:40.829596698Z","closed_at":"2025-12-23T15:17:31.00613048Z","dependencies":[{"issue_id":"markform-kak","depends_on_id":"markform-g3k","type":"blocks","created_at":"2025-12-22T23:20:31.260119-08:00","created_by":"daemon"},{"issue_id":"markform-kak","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:20:30.033565-08:00","created_by":"daemon"}]}
{"id":"markform-kav","title":"PLAN-006: Keep inspect YAML output machine-readable","description":"## Problem\nPlan mentions colors and formatting, but inspect output is YAML which should remain machine-readable (no ANSI escape codes).\n\n## Why It Matters\n- YAML output needs to be pipeable to other tools\n- ANSI codes would break `yq`, `jq` (after conversion), etc.\n- Users may redirect output to files\n\n## Recommended Fix\n1. Use colors only in non-YAML human-readable logs/messages\n2. Keep YAML output clean and parseable\n3. Consider `--no-color` flag for all output if needed\n4. Test that YAML output parses correctly\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md (clarify in CLI tasks)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T00:33:03.798121-08:00","updated_at":"2025-12-23T09:31:58.345895784Z","closed_at":"2025-12-23T09:31:58.345895784Z"}
{"id":"markform-mf01","title":"Introduce MF/0.1 spec version notation","description":"## Summary\nIntroduce explicit spec version notation (`MF/0.1`) distinct from npm package version to clearly track format/schema versions.\n\n## Rationale\n- Package versions (v0.1.1, v0.1.2) track library releases\n- Spec versions track the format that `.form.md` files conform to\n- Clear separation prevents confusion about compatibility\n- Follows precedent from HTTP/1.1, YAML 1.2, etc.\n\n## Changes Required\n\n### 1. settings.ts — Add Spec Version Constant\nAdd at top of `packages/markform/src/settings.ts`:\n```typescript\n// Spec Version\nexport const MF_SPEC_VERSION = \"MF/0.1\";\nexport const MF_SPEC_VERSION_NUMBER = \"0.1\";\n```\n\n### 2. Architecture Doc — Update Spec References\nUpdate `docs/project/architecture/current/arch-markform-design.md.md`:\n- Line 3: `Version: v0.1` → `Version: MF/0.1`\n- `## v0.1 Scope` → `## MF/0.1 Scope`\n- `Deferred to v0.2` → `Deferred to MF/0.2`\n- All `(v0.1)` scope notes → `(MF/0.1)`\n- `### v0.2 Targets` → `### MF/0.2 Targets`\n\n### 3. Frontmatter Schema — Consider Field Rename\nConsider updating frontmatter from:\n```yaml\nmarkform:\n  markform_version: \"0.1.0\"\n```\nTo:\n```yaml\nmarkform:\n  spec: \"MF/0.1\"\n```\n\n### 4. Code Updates (if frontmatter changes)\n- `packages/markform/src/engine/parse.ts` — field name\n- `packages/markform/src/engine/serialize.ts` — writes frontmatter\n- Example `.form.md` files in `packages/markform/examples/`\n- Tests validating frontmatter\n\n## Priority\nP2 — important for clarity before wider adoption.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-26T10:00:00-08:00","updated_at":"2025-12-27T01:04:49.13780562Z","closed_at":"2025-12-27T01:04:49.13780562Z"}
{"id":"markform-mls","title":"Fix Architecture \u0026 Plan Doc Issues (2025-12-23 Review)","description":"Address all spec/fixture mismatches and ambiguities identified in the comprehensive documentation review before implementation begins.\n\n## Scope\n- 10 architecture issues (ARCH-001 through ARCH-013)\n- 7 implementation plan issues (PLAN-001 through PLAN-007)  \n- 6 sample form issues (FORM-SIMPLE-001, FORM-COMPANY-001 through 005)\n\n## Critical Items (must fix before implementation)\n1. Fix Markdoc comment syntax + decide preservation policy (ARCH-007)\n2. Fix option indexing so option refs are resolvable (ARCH-001)\n3. Fix doc placement rules to match fixtures (ARCH-005)\n4. Fix clear_field semantics for select/checkbox (ARCH-006)\n5. Align plan with architecture on process=false emission (PLAN-003)\n6. Clarify requiredness vs minItems/minSelections (ARCH-013)\n\n## Review Source\nAnalysis performed 2025-12-23 comparing:\n- arch-markform-design.md.md\n- plan-2025-12-22-markform-v01-implementation.md\n- simple.form.md, simple-mock-filled.form.md\n- earnings-analysis.form.md\n- Markdoc official documentation","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T00:29:50.583803-08:00","updated_at":"2025-12-23T09:39:19.408560643Z","closed_at":"2025-12-23T09:39:19.408560643Z"}
{"id":"markform-mrh","title":"FORM-COMPANY-005: Fix sources_accessed item_format pattern","description":"## Problem\n`sources_accessed` `item_format` pattern doesn't enforce all 5 columns described in instructions. The docs say each item should have: Source Type | Name | URL | Access Date | Key Data Points.\n\n## Why It Matters\n- Validation may accept incomplete entries\n- Instructions promise more structure than validation enforces\n- Could lead to inconsistent data\n\n## Recommended Fix\nChoose ONE approach:\n1. **Stricter regex:** Use pipe-count regex requiring exactly 5 segments\n2. **Document limitation:** Update docs to say 'at least 3 segments required'\n3. **Simpler validation:** Remove item_format, rely on doc instructions only\n\n## Files to Update\n- docs/project/test-fixtures/forms/earnings-analysis.form.md","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T00:33:54.914182-08:00","updated_at":"2025-12-23T17:32:58.457636295Z","closed_at":"2025-12-23T17:29:21.918526984Z"}
{"id":"markform-mus","title":"Create markform package structure","description":"Create packages/markform/ with full structure per research doc:\n\npackage.json:\n- name: markform\n- version: 0.1.0\n- type: module\n- sideEffects: false\n- main: ./dist/index.cjs\n- module: ./dist/index.js\n- types: ./dist/index.d.ts\n- exports with proper ESM/CJS dual support (types first!)\n- bin: { markform: ./dist/bin.js }\n- files: ['dist']\n- engines: { node: '\u003e=24' }\n- Scripts: build, dev, typecheck, test, publint, prepack\n\ntsdown.config.ts:\n- entry: { index, bin }\n- format: ['esm', 'cjs']\n- platform: node\n- target: node24\n- sourcemap: true\n- dts: true\n- clean: true\n- banner for shebang on bin.*\n\ntsconfig.json:\n- extends: ../../tsconfig.base.json\n- compilerOptions: { types: ['node'], noEmit: true }\n- include: ['src']\n\nDirectory structure:\n- src/engine/\n- src/cli/\n- src/harness/\n- src/integrations/\n- src/web/\n- src/index.ts\n- tests/unit/\n- tests/golden/\n\nRef: docs/project/research/current/research-modern-typescript-monorepo-package.md (Appendix A, D)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:04.960122-08:00","updated_at":"2025-12-23T15:03:22.053817389Z","closed_at":"2025-12-23T15:02:59.222121651Z","dependencies":[{"issue_id":"markform-mus","depends_on_id":"markform-ja8","type":"blocks","created_at":"2025-12-22T23:19:14.286237-08:00","created_by":"daemon"},{"issue_id":"markform-mus","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:13.129649-08:00","created_by":"daemon"}]}
{"id":"markform-n3l","title":"Phase 2: Web UI (serve) and Basic CLI","description":"Enable browsing forms via web UI and basic CLI inspection.\n\nSub-tasks:\n2.1 CLI Infrastructure (cli/)\n2.2 Inspect Command (cli/commands/inspect.ts)\n2.3 Export Command (cli/commands/export.ts)\n2.4 Serve Command (cli/commands/serve.ts)\n\nCheckpoints (automated):\n- markform inspect outputs valid YAML\n- markform export outputs valid JSON\n- CLI integration tests pass\n\nCheckpoints (manual):\n- User verifies serve renders form correctly in browser\n- User verifies Save button works with versioned filenames","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:37.565782-08:00","updated_at":"2025-12-23T16:41:39.8868475Z","closed_at":"2025-12-23T16:36:32.948979689Z","dependencies":[{"issue_id":"markform-n3l","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:46.147474-08:00","created_by":"daemon"},{"issue_id":"markform-n3l","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:18:47.337796-08:00","created_by":"daemon"}]}
{"id":"markform-ncq","title":"FORM-COMPANY-003: Align word count docs with validation constraints","description":"## Problem\nSeveral fields in company form say '25-75 words' in docs but use `minLength`/`maxLength` (character-based validation).\n\nExample: `how_makes_money` says '25-75 words' but uses `minLength=100 maxLength=300`.\n\n## Why It Matters\n- Confusing for form fillers: which constraint applies?\n- Character count != word count\n- Could cause valid responses to fail validation or vice versa\n\n## Recommended Fix\nChoose ONE approach:\n1. **Add word validators:** Implement `min_words`/`max_words` validators for word-based constraints\n2. **Update doc text:** Change '25-75 words' to '100-300 characters' to match actual validation\n\n## Files to Update\n- docs/project/test-fixtures/forms/earnings-analysis.form.md","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T00:33:53.370545-08:00","updated_at":"2025-12-23T17:32:58.45948878Z","closed_at":"2025-12-23T17:30:26.804182302Z"}
{"id":"markform-o5m","title":"3.2 Harness Implementation (harness/)","description":"Implement FormHarness class:\n- State machine: INIT -\u003e STEP -\u003e WAIT -\u003e APPLY -\u003e COMPLETE\n- step() returns StepResult with summaries and issues\n- apply(patches) applies and revalidates\n- max_turns safety limit","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:46.388058-08:00","updated_at":"2025-12-23T16:17:36.834122704Z","closed_at":"2025-12-23T15:53:56.533663287Z","dependencies":[{"issue_id":"markform-o5m","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:54.685762-08:00","created_by":"daemon"}]}
{"id":"markform-o75","title":"4.3 Documentation","description":"Document AI SDK integration:\n- Document in README\n- Document tool schemas\n- Document harness configuration options","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T23:21:07.510942-08:00","updated_at":"2025-12-23T16:31:19.766764313Z","closed_at":"2025-12-23T16:29:57.910002046Z","dependencies":[{"issue_id":"markform-o75","depends_on_id":"markform-x39","type":"blocks","created_at":"2025-12-22T23:21:13.895894-08:00","created_by":"daemon"},{"issue_id":"markform-o75","depends_on_id":"markform-1xj","type":"blocks","created_at":"2025-12-22T23:21:14.776524-08:00","created_by":"daemon"}]}
{"id":"markform-o8l","title":"Create placeholder src and tests","description":"Create placeholder source and tests to verify tooling:\n\nsrc/index.ts:\n- Export package version from package.json\n- Export placeholder types\n\ntests/unit/index.test.ts:\n- Basic test using vitest\n- Import and verify version export works\n\nVerify all commands pass:\n- pnpm install (from root)\n- pnpm build\n- pnpm typecheck\n- pnpm lint\n- pnpm publint\n- pnpm test\n\nAdd vitest to package devDependencies:\n- vitest ^3.0.0\n\nPackage scripts:\n- test: vitest run\n- test:watch: vitest","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:07.022832-08:00","updated_at":"2025-12-23T15:03:22.055914164Z","closed_at":"2025-12-23T15:02:59.222173451Z","dependencies":[{"issue_id":"markform-o8l","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:13.565662-08:00","created_by":"daemon"},{"issue_id":"markform-o8l","depends_on_id":"markform-cvf","type":"blocks","created_at":"2025-12-22T23:19:14.742844-08:00","created_by":"daemon"}]}
{"id":"markform-p6z","title":"ARCH-008: Align explicit checkbox validation with required semantics","description":"## Problem\nBuilt-in deterministic validation table says explicit checkboxes 'requires no unfilled values' without mentioning `required=true`, but Required Field Semantics section ties that rule to `required=true`.\n\n## Why It Matters\nThese two sections contradict each other:\n- Validation table implies: explicit mode ALWAYS requires all answered\n- Required semantics implies: explicit mode only requires all answered when `required=true`\n\n## Recommended Fix\nMake both sections consistent. Recommended approach:\n- **Validation:** Only checks that markers are valid (`unfilled|yes|no`)\n- **Completeness:** If `required=true`, then all must be answered (no `[_]` markers)\n\nThis aligns with progress state meaning (`empty` vs `incomplete` vs `invalid`).\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (Built-in Validation table + Required Field Semantics)\n\n## Blocks\n- markform-aae (1.5 Validation)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T00:32:04.61446-08:00","updated_at":"2025-12-23T09:24:11.775309349Z","closed_at":"2025-12-23T09:24:11.775309349Z"}
{"id":"markform-s2w","title":"PLAN-007: Use optional peer deps for AI integration packaging","description":"## Problem\n`markform/ai` subpath should not force-install AI SDK dependencies. The monorepo research brief explicitly calls out optional peer deps as a best practice for adapters.\n\n## Why It Matters\n- Users who don't use AI features shouldn't install AI SDK\n- Reduces bundle size for non-AI use cases\n- Follows modern package patterns from research brief\n\n## Recommended Fix\n1. Use optional peer dependencies for AI SDK adapters\n2. Use subpath exports pattern: `markform/ai-sdk`\n3. Document which peer deps are required for each subpath\n4. Add install instructions for each integration\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md (Phase 4 packaging)\n\n## Blocks\n- markform-x39 (Phase 4: Vercel AI SDK Integration)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:04.550905-08:00","updated_at":"2025-12-23T09:32:08.373298451Z","closed_at":"2025-12-23T09:32:08.373298451Z"}
{"id":"markform-sub","title":"FORM-COMPANY-004: Tighten fiscal_year_end date regex","description":"## Problem\n`fiscal_year_end` regex pattern allows invalid day values (e.g., month 13, day 32, day 00).\n\n## Why It Matters\n- Invalid dates could pass validation\n- Not a blocker but reduces data quality\n- Could confuse downstream processing\n\n## Recommended Fix\nChoose ONE approach:\n1. **Tighten regex:** Use pattern that validates real month/day ranges\n2. **Accept limitation:** Document as 'format validation only, not date validation'\n3. **Use date validator:** Add custom `valid_date` validator instead of regex\n\n## Severity\nLow priority - the current regex catches most malformed input; edge cases are unlikely in practice.\n\n## Files to Update\n- docs/project/test-fixtures/forms/earnings-analysis.form.md","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-23T00:33:54.145734-08:00","updated_at":"2025-12-23T17:32:58.461276925Z","closed_at":"2025-12-23T17:31:28.539925133Z"}
{"id":"markform-ufu","title":"ARCH-012: Define policy for non-Markform nodes in forms","description":"## Problem\nSpec doesn't say what happens to non-Markform nodes (comments, headings, plain text between tags). The company form uses separators that may not be preserved.\n\n## Why It Matters\n- `earnings-analysis.form.md` uses `{# PART ... #}` separators\n- Parser likely ignores them, but serializer behavior is unspecified\n- Could cause silent data loss on round-trip\n\n## Decision Required\nExplicitly state ONE of:\n1. Non-markform nodes are forbidden (parse error)\n2. Non-markform nodes are allowed but discarded on canonical serialize\n3. Non-markform nodes are allowed and preserved verbatim (requires raw slicing)\n\n## Recommendation for v0.1\n- Allow HTML comments only (`\u003c!-- ... --\u003e`)\n- Ignore/error on other arbitrary content\n- Don't promise preservation beyond doc blocks\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md\n\n## Depends On\n- ARCH-007 (need to decide comment syntax first)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:32:08.590359-08:00","updated_at":"2025-12-23T09:24:41.861298341Z","closed_at":"2025-12-23T09:24:41.861298341Z","dependencies":[{"issue_id":"markform-ufu","depends_on_id":"markform-gyn","type":"blocks","created_at":"2025-12-23T00:34:28.595657-08:00","created_by":"daemon"}]}
{"id":"markform-vd0","title":"ARCH-009: Clarify single-select validity vs requiredness semantics","description":"## Problem\nSpec wording inconsistency: one section implies 'exactly one [x] always', but the data model allows `selected: null` and required semantics allow optional single-select to be empty.\n\n## Why It Matters\nImplementers need clear rules for:\n- What constitutes a VALID single-select value?\n- What constitutes a COMPLETE single-select value?\n\n## Recommended Fix\nMake explicit:\n- **Validity invariant (always):** At most one selected marker (`(x)`)\n- **Required invariant (only when `required=true`):** Exactly one selected\n\nAn optional single-select with no selection is valid but incomplete (if you track progress).\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-design.md.md (single-select sections)\n\n## Blocks\n- markform-aae (1.5 Validation)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:32:05.503865-08:00","updated_at":"2025-12-23T09:24:21.797615304Z","closed_at":"2025-12-23T09:24:21.797615304Z"}
{"id":"markform-x39","title":"Phase 4: Vercel AI SDK Integration","description":"Research and validate AI SDK tool integration for live agent mode.\n\nSub-tasks:\n4.1 AI SDK Tool Definitions (integrations/ai-sdk.ts)\n4.2 Live Agent Test Script\n4.3 Documentation\n\nCheckpoints (automated):\n- AI SDK tools have correct Zod schemas\n- Tool execute functions return correct types\n- Integration tests pass\n\nCheckpoints (manual):\n- User runs live AI agent test\n- User reviews agent conversation logs\n- User verifies final forms are correctly filled","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:38.965938-08:00","updated_at":"2025-12-23T16:41:39.88897095Z","closed_at":"2025-12-23T16:36:23.739723921Z","dependencies":[{"issue_id":"markform-x39","depends_on_id":"markform-s2w","type":"blocks","created_at":"2025-12-23T00:34:46.865145-08:00","created_by":"daemon"},{"issue_id":"markform-x39","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:46.432752-08:00","created_by":"daemon"},{"issue_id":"markform-x39","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:18:47.616459-08:00","created_by":"daemon"}]}
{"id":"markform-y98","title":"FORM-COMPANY-002: Document required_if_equals validator","description":"## Problem\nCompany form uses validator `required_if_equals` but architecture only documents `required_if`. This validator is used but not specified.\n\n## Why It Matters\n- Implementers won't know how to implement this validator\n- Creates gap between fixture and specification\n- Could lead to different interpretations\n\n## Recommended Fix\nChoose ONE approach:\n1. **Add to architecture:** Document `required_if_equals` in 'Example Custom Validators' list with signature and semantics\n2. **Refactor fixture:** Change to `required_if` with `equals` parameter (e.g., `validate=\"required_if(field=type, equals='other')\"`)\n\n## Files to Update\nEither:\n- docs/project/architecture/current/arch-markform-design.md.md (if adding validator)\n- docs/project/test-fixtures/forms/earnings-analysis.form.md (if refactoring)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:52.62634-08:00","updated_at":"2025-12-23T09:39:04.651584933Z","closed_at":"2025-12-23T09:39:04.651584933Z"}
{"id":"markform-yyh","title":"3.5 Golden Session Tests (tests/golden/)","description":"Implement golden session testing:\n- Session transcript schema validation\n- runGoldenTest(sessionPath) implementation\n- Replay turns, verify issues, verify snapshots\n- Create simple.session.yaml\n- Create earnings-analysis.session.yaml\n- Integration test runner","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:48.777963-08:00","updated_at":"2025-12-23T16:17:36.836096593Z","closed_at":"2025-12-23T16:16:51.86942163Z","dependencies":[{"issue_id":"markform-yyh","depends_on_id":"markform-k3z","type":"blocks","created_at":"2025-12-22T23:20:56.53563-08:00","created_by":"daemon"},{"issue_id":"markform-yyh","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:55.144278-08:00","created_by":"daemon"}]}
{"id":"markform-yz3","title":"Phase 3: End-to-End CLI and Session Tests","description":"Complete CLI functionality and golden session testing.\n\nSub-tasks:\n3.1 Apply Command (cli/commands/apply.ts)\n3.2 Harness Implementation (harness/)\n3.3 Mock Agent (harness/mockAgent.ts)\n3.4 Run Command (cli/commands/run.ts)\n3.5 Golden Session Tests (tests/golden/)\n\nCheckpoints (automated):\n- markform apply with valid patches succeeds\n- markform apply with invalid patches rejects batch\n- markform run --mock completes\n- Golden tests pass for both forms\n\nCheckpoints (manual):\n- User reviews session transcript YAML for readability","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:38.251309-08:00","updated_at":"2025-12-23T16:41:39.891022252Z","closed_at":"2025-12-23T16:36:28.831153181Z","dependencies":[{"issue_id":"markform-yz3","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:46.288805-08:00","created_by":"daemon"},{"issue_id":"markform-yz3","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:18:47.478948-08:00","created_by":"daemon"}]}
{"id":"markform-zt3","title":"Setup linting and changeset","description":"Setup ESLint (strict type-aware) and Changesets per research doc:\n\nESLint (eslint.config.js - flat config):\n- Type-aware using recommendedTypeChecked + stylisticTypeChecked\n- projectService: true for precise cross-project types\n- Rules:\n  - curly: ['error', 'all']\n  - brace-style: ['error', '1tbs']\n  - @typescript-eslint/no-unused-vars with underscore patterns\n  - @typescript-eslint/no-floating-promises: error\n  - @typescript-eslint/no-misused-promises: error\n  - @typescript-eslint/await-thenable: error\n  - @typescript-eslint/consistent-type-imports: error\n  - @typescript-eslint/no-import-type-side-effects: error\n  - no-restricted-syntax for TSImportType\n- Relaxed rules for test files and scripts\n- Ignores: dist, node_modules, .pnpm-store\n\nChangesets (.changeset/):\n- config.json with @changesets/changelog-github\n- access: public\n- baseBranch: main\n- README.md\n\nRoot devDependencies:\n- @changesets/cli ^2.28.0\n- @changesets/changelog-github ^0.5.0\n- @eslint/js ^9.0.0\n- eslint ^9.0.0\n- typescript ^5.0.0\n- typescript-eslint ^8.0.0\n\nRef: docs/project/research/current/research-modern-typescript-monorepo-package.md (Appendix B, C)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:05.715134-08:00","updated_at":"2025-12-23T15:03:22.058053514Z","closed_at":"2025-12-23T15:02:59.222138392Z","dependencies":[{"issue_id":"markform-zt3","depends_on_id":"markform-mus","type":"blocks","created_at":"2025-12-22T23:19:14.437331-08:00","created_by":"daemon"},{"issue_id":"markform-zt3","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:13.273548-08:00","created_by":"daemon"}]}
