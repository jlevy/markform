{"id":"markform-055","title":"FORM-SIMPLE-001: Clarify requiredness for minItems/minSelections fields","description":"## Problem\nIn `simple.form.md`:\n- `tags` has `minItems=1` but no `required=true`\n- `categories` has `minSelections=1` but no `required=true`\n\nThis is ambiguous given the spec wording around required vs min constraints.\n\n## Why It Matters\n- Behavior differs depending on whether min constraints imply requiredness\n- Progress/form_state computation could be inconsistent with validation\n- Creates confusion for implementers and users\n\n## Recommended Fix\nAfter ARCH-013 decision, either:\n1. Add `required=true` to both fields (clearest, recommended)\n2. Remove min constraints and rely solely on `required=true`\n3. Keep as-is if spec clarifies min constraints DON'T imply requiredness\n\n## Files to Update\n- docs/project/test-fixtures/forms/simple.form.md\n- docs/project/test-fixtures/forms/simple.mock.filled.form.md (if needed)\n\n## Depends On\n- ARCH-013 (need decision on min constraints vs requiredness first)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:51.083335-08:00","updated_at":"2025-12-23T09:39:14.684176202Z","closed_at":"2025-12-23T09:39:14.684176202Z","close_reason":"Closed","dependencies":[{"issue_id":"markform-055","depends_on_id":"markform-bg7","type":"blocks","created_at":"2025-12-23T00:34:34.240775-08:00","created_by":"daemon"}]}
{"id":"markform-069","title":"Add lefthook for pre-commit and pre-push hooks","description":"Set up lefthook for local git hooks as part of initial project scaffolding.\n\n**Pre-commit hooks (fast, 2-5s target):**\n- Prettier formatting with auto-fix\n- ESLint with cache and auto-fix\n- TypeScript incremental typecheck\n\n**Pre-push hooks (cached):**\n- Full test suite with commit-hash caching\n- Skip if tests already passed for current commit\n\nSee: docs/project/research/current/research-modern-typescript-monorepo-package.md (Section 9, Appendix E)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-23T00:35:44.028335-08:00","updated_at":"2025-12-23T00:35:53.427867-08:00","dependencies":[{"issue_id":"markform-069","depends_on_id":"markform-zt3","type":"blocks","created_at":"2025-12-23T00:36:33.034483-08:00","created_by":"daemon"}]}
{"id":"markform-08t","title":"Markform v0.1 Full Implementation","description":"Complete implementation of Markform v0.1 as defined in plan-2025-12-22-markform-v01-implementation.md\n\nPhases:\n- Phase 0: Project scaffolding and monorepo setup\n- Phase 1: Core engine (parsing, serialization, validation, patches)\n- Phase 2: Web UI (serve) and basic CLI commands\n- Phase 3: End-to-end CLI, harness loop, and golden session tests\n- Phase 4: Vercel AI SDK integration research and testing\n\nRef: docs/project/specs/active/plan-2025-12-22-markform-v01-implementation.md","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:11.561717-08:00","updated_at":"2025-12-22T23:18:11.561717-08:00"}
{"id":"markform-0oa","title":"PLAN-004: Add task for Markdoc tag config/schema definitions","description":"## Problem\nPlan doesn't explicitly include defining a Markdoc config/schema for custom tags, but architecture requires `Markdoc.validate(ast, config)` as an early syntax/schema gate.\n\n## Why It Matters\n- `Markdoc.validate()` is only meaningful with a proper config object\n- Need tag definitions for `form`, `field-group`, all field tags, `doc`\n- Need attribute schemas for each tag\n- Without this, Markdoc.validate just does basic syntax checking\n\n## Recommended Fix\nAdd a concrete task:\n1. Implement `markformMarkdocConfig` with tag definitions and attribute schemas\n2. Define required vs optional attributes per tag\n3. Add unit tests that invalid attributes are caught by Markdoc.validate\n4. Test that unknown tags are rejected\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md (add task to Phase 1)\n\n## Blocks\n- markform-7mt (1.2 Markdoc Parsing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:02.206142-08:00","updated_at":"2025-12-23T09:31:48.312206333Z","closed_at":"2025-12-23T09:31:48.312206333Z","close_reason":"Closed"}
{"id":"markform-1hn","title":"1.3 Canonical Serialization (engine/serialize.ts)","description":"Implement serialize(form: ParsedForm, opts?): string\n- Frontmatter generation with computed summaries\n- Tag serialization with alphabetical attributes\n- Value fence generation\n- Option list serialization with markers\n- Doc block placement\n- Round-trip tests: parse -\u003e serialize -\u003e parse -\u003e compare","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:41.512809-08:00","updated_at":"2025-12-23T15:03:22.034125062Z","closed_at":"2025-12-23T15:02:24.951660706Z","dependencies":[{"issue_id":"markform-1hn","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.51323-08:00","created_by":"daemon"},{"issue_id":"markform-1hn","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.392378-08:00","created_by":"daemon"},{"issue_id":"markform-1hn","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.105721-08:00","created_by":"daemon"},{"issue_id":"markform-1hn","depends_on_id":"markform-25g","type":"blocks","created_at":"2025-12-23T00:34:35.056018-08:00","created_by":"daemon"}]}
{"id":"markform-1qs","title":"ARCH-004: InspectIssue needs scope field for group-level validators","description":"## Problem\nInspectIssue uses `fieldId` but group-level validators exist. The current structure can't properly represent issues from group or form-level validators.\n\n## Why It Matters\n- Group-level validators validate across multiple fields\n- Form-level validators validate the entire form\n- Current `fieldId` property can't represent these scopes\n\n## Recommended Fix\n- Rename `fieldId` to `ref` or `targetId`\n- Add `scope: 'form' | 'group' | 'field' | 'option'` field\n- Allow `QualifiedOptionRef` for option-level issues\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (InspectIssue interface)\n\n## Blocks\n- markform-bve (1.7 Inspect implementation)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:10.397034-08:00","updated_at":"2025-12-23T09:07:13.788184675Z","closed_at":"2025-12-23T09:07:13.788184675Z","close_reason":"Fixed: Added scope field and renamed fieldId to ref in InspectIssue"}
{"id":"markform-1xj","title":"4.2 Live Agent Test Script","description":"Create scripts/test-live-agent.ts:\n- Load simple form template for quick iteration\n- Configure AI SDK with tools\n- Run agent loop to fill form\n- Log session transcript\n- Validate final form completeness\n- Test with complex form","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:21:06.760651-08:00","updated_at":"2025-12-22T23:21:06.760651-08:00","dependencies":[{"issue_id":"markform-1xj","depends_on_id":"markform-x39","type":"blocks","created_at":"2025-12-22T23:21:13.738064-08:00","created_by":"daemon"},{"issue_id":"markform-1xj","depends_on_id":"markform-cx7","type":"blocks","created_at":"2025-12-22T23:21:14.630102-08:00","created_by":"daemon"}]}
{"id":"markform-1zs","title":"ARCH-005: Fix doc block placement rules to match fixtures","description":"## Problem\nSpec says doc blocks 'must be siblings of the referenced element', but fixtures show docs nested inside `{% form %}` and `{% field-group %}` bodies.\n\n## Evidence\n- In `simple.form.md`: `{% doc ref=\"simple_test\" %}` is inside the `{% form %}` body\n- In `company-quarterly-analysis.form.md`: group docs (e.g., `ref=\"offerings_primary\"`) are inside the `{% field-group %}` body\n\nThis is a direct spec↔fixtures mismatch.\n\n## Recommended Fix\nReplace 'must be siblings' rule with:\n1. Doc blocks MAY appear inside `form` and `field-group` as direct children\n2. Doc blocks MUST NOT appear inside a field tag body (this is the actual parsing constraint)\n3. For field-level docs: place immediately after the field block (sibling within the group)\n\nThis keeps field value extraction simple (the important part) without forcing awkward 'docs outside container' layout.\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (Documentation Blocks section)\n\n## Blocks\n- markform-7mt (1.2 Markdoc Parsing)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:11.120353-08:00","updated_at":"2025-12-23T09:08:36.999507593Z","closed_at":"2025-12-23T09:08:36.999507593Z","close_reason":"Fixed: Updated doc block placement rules to allow docs inside form/field-group as direct children"}
{"id":"markform-25g","title":"ARCH-010: Resolve canonical formatting vs fixture blank line conflict","description":"## Problem\nCanonical formatting rule says 'no blank lines between fields' but fixtures (`simple.form.md`, `simple.mock.filled.form.md`) use blank lines between tags.\n\n## Why It Matters\n- Plan relies on golden fixtures and deterministic formatting\n- If canonical output removes all blank lines, fixtures won't match unless regenerated\n- This could cause spurious test failures\n\n## Recommended Fix\nChoose ONE approach:\n- **Option A (recommended):** Loosen canonical formatting to allow ONE blank line between adjacent blocks (improves readability)\n- **Option B:** Keep strict compaction, regenerate all fixtures to match, document as 'canonical expected output'\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (Canonical Serialization section)\n- Possibly: test fixture files if keeping strict formatting\n\n## Blocks\n- markform-1hn (1.3 Canonical Serialization)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:32:06.948886-08:00","updated_at":"2025-12-23T09:24:31.826848587Z","closed_at":"2025-12-23T09:24:31.826848587Z","close_reason":"Closed"}
{"id":"markform-2j6","title":"Phase 1: Core Engine with Unit Tests","description":"Implement all core engine functionality using TDD with simple test form.\n\nSub-tasks:\n1.1 Types and Schemas (engine/types.ts)\n1.2 Markdoc Parsing (engine/parse.ts)\n1.3 Canonical Serialization (engine/serialize.ts)\n1.4 Summaries (engine/summaries.ts)\n1.5 Validation (engine/validate.ts)\n1.6 Patch Application (engine/apply.ts)\n1.7 Inspect (engine/inspect.ts)\n1.8 Validate with Simple Form\n1.9 Session Transcript Handling (engine/session.ts)\n\nCheckpoints:\n- All unit tests pass\n- Parse simple.form.md → structure summary matches\n- Round-trip test passes\n- Validation tests pass\n- Patch tests pass","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:36.913155-08:00","updated_at":"2025-12-22T23:18:36.913155-08:00","dependencies":[{"issue_id":"markform-2j6","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:46.002331-08:00","created_by":"daemon"},{"issue_id":"markform-2j6","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:18:47.199817-08:00","created_by":"daemon"},{"issue_id":"markform-2j6","depends_on_id":"markform-2v3","type":"blocks","created_at":"2025-12-22T23:23:06.035801-08:00","created_by":"daemon"},{"issue_id":"markform-2j6","depends_on_id":"markform-069","type":"blocks","created_at":"2025-12-23T00:36:33.174159-08:00","created_by":"daemon"}]}
{"id":"markform-2v3","title":"Verify GitHub Actions CI passes","description":"Push Phase 0 work and verify CI passes on GitHub Actions:\n\n1. Commit and push all Phase 0 scaffolding to a branch\n2. Create PR to trigger CI workflow\n3. Use gh CLI to monitor CI run:\n   - gh run list --limit 5\n   - gh run watch \u003crun-id\u003e\n   - gh run view \u003crun-id\u003e --log-failed (if fails)\n\n4. Verify all CI steps pass:\n   - pnpm install\n   - pnpm lint\n   - pnpm typecheck\n   - pnpm build\n   - pnpm publint\n   - pnpm test\n\n5. Fix any CI failures and re-verify\n\n6. Merge PR to main when CI is green\n\nThis ensures the scaffolding works in a clean environment,\nnot just locally where caches and installed tools may mask issues.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:22:50.435199-08:00","updated_at":"2025-12-22T23:22:50.435199-08:00","dependencies":[{"issue_id":"markform-2v3","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:22:59.355844-08:00","created_by":"daemon"},{"issue_id":"markform-2v3","depends_on_id":"markform-o8l","type":"blocks","created_at":"2025-12-22T23:22:59.512576-08:00","created_by":"daemon"}]}
{"id":"markform-4va","title":"ARCH-003: Fix contradictory InspectIssue priority sorting","description":"## Problem\nSpec says 'sorted by priority (descending)' but also says 'priority: 1 = highest'. These are contradictory.\n\nIf 1 = highest and we sort descending, highest priority items appear last.\n\n## Recommended Fix\nPick ONE convention and make both sections match:\n- **Option A (recommended):** 'sorted by priority (ascending)' with '1 = highest' \n- **Option B:** 'sorted by priority (descending)' with 'higher number = higher priority'\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (InspectResult section)\n\n## Blocks\n- markform-bve (1.7 Inspect implementation)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:09.697787-08:00","updated_at":"2025-12-23T09:01:39.74333426Z","closed_at":"2025-12-23T09:01:39.74333426Z","close_reason":"Fixed: Changed from 'descending' to 'ascending' to align with '1 = highest priority'"}
{"id":"markform-50a","title":"1.8 Validate with Simple Form","description":"Integration tests with simple.form.md:\n- Verify parse/serialize round-trip\n- Verify all field types parse correctly\n- Verify all checkbox modes work\n- Verify validation catches expected issues","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:45.416377-08:00","updated_at":"2025-12-23T14:17:16.123167101Z","closed_at":"2025-12-23T14:17:16.123167101Z","close_reason":"Closed","dependencies":[{"issue_id":"markform-50a","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:58.271985-08:00","created_by":"daemon"},{"issue_id":"markform-50a","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.933867-08:00","created_by":"daemon"},{"issue_id":"markform-50a","depends_on_id":"markform-1hn","type":"blocks","created_at":"2025-12-22T23:20:02.096667-08:00","created_by":"daemon"},{"issue_id":"markform-50a","depends_on_id":"markform-aae","type":"blocks","created_at":"2025-12-22T23:20:02.246023-08:00","created_by":"daemon"}]}
{"id":"markform-7mt","title":"1.2 Markdoc Parsing (engine/parse.ts)","description":"Implement parseForm(markdown: string): ParsedForm\n- Frontmatter extraction and parsing\n- AST traversal for form/group/field tags\n- Option extraction from list items\n- Value extraction from fence nodes\n- Documentation block extraction\n- Semantic validation (ID uniqueness, refs, etc.)\n- Build orderIndex and idIndex\n- Unit tests for all field types and edge cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:40.796759-08:00","updated_at":"2025-12-23T15:03:22.036684019Z","closed_at":"2025-12-23T15:02:24.951647399Z","dependencies":[{"issue_id":"markform-7mt","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.372862-08:00","created_by":"daemon"},{"issue_id":"markform-7mt","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.219353-08:00","created_by":"daemon"},{"issue_id":"markform-7mt","depends_on_id":"markform-1zs","type":"blocks","created_at":"2025-12-23T00:34:30.312444-08:00","created_by":"daemon"},{"issue_id":"markform-7mt","depends_on_id":"markform-0oa","type":"blocks","created_at":"2025-12-23T00:34:45.995326-08:00","created_by":"daemon"},{"issue_id":"markform-7mt","depends_on_id":"markform-cre","type":"blocks","created_at":"2025-12-23T00:34:46.167081-08:00","created_by":"daemon"}]}
{"id":"markform-7sy","title":"PLAN-001: Update plan to reference existing complex fixture","description":"## Problem\nPlan says 'complex quarterly form to be provided' but `company-quarterly-analysis.form.md` already exists in the test fixtures.\n\n## Why It Matters\n- The fixture is ready to use for testing\n- Plan should reference it in acceptance criteria\n- Avoids duplicate work creating a new complex fixture\n\n## Recommended Fix\n1. Update plan to explicitly use `company-quarterly-analysis.form.md` as the complex fixture\n2. List it in acceptance criteria for relevant phases\n3. Add it to testing plan for end-to-end validation\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T00:32:59.376539-08:00","updated_at":"2025-12-23T09:31:28.252936737Z","closed_at":"2025-12-23T09:31:28.252936737Z","close_reason":"Closed"}
{"id":"markform-7to","title":"PLAN-002: Remove nested group references from v0.1 plan","description":"## Problem\nPlan refers to nested groups in complex example, but v0.1 architecture defers nested groups to v0.2.\n\n## Why It Matters\n- Creates confusion about v0.1 scope\n- Could lead to implementing features meant for v0.2\n- Complex fixture should stay within v0.1 constraints\n\n## Recommended Fix\n1. Review plan tasks and examples\n2. Remove or defer any nested-group references\n3. Ensure complex fixture stays within v0.1 scope (flat groups only)\n4. Add explicit 'v0.2 scope' section for nested groups if mentioned\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:00.339123-08:00","updated_at":"2025-12-23T09:31:28.260140912Z","closed_at":"2025-12-23T09:31:28.260140912Z","close_reason":"Closed"}
{"id":"markform-8ap","title":"1.6 Patch Application (engine/apply.ts)","description":"Implement applyPatches(form: ParsedForm, patches: Patch[]): ApplyResult\n- Structural validation (field/option existence, type checking)\n- Patch semantics (set_*, clear_field, set_checkboxes merge)\n- Transaction semantics (all-or-nothing)\n- Unit tests for all operations and error cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:43.841133-08:00","updated_at":"2025-12-23T15:03:22.038946302Z","closed_at":"2025-12-23T15:02:24.9517035Z","dependencies":[{"issue_id":"markform-8ap","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.951043-08:00","created_by":"daemon"},{"issue_id":"markform-8ap","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.83889-08:00","created_by":"daemon"},{"issue_id":"markform-8ap","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.597312-08:00","created_by":"daemon"},{"issue_id":"markform-8ap","depends_on_id":"markform-c2w","type":"blocks","created_at":"2025-12-23T00:34:31.093878-08:00","created_by":"daemon"}]}
{"id":"markform-9sy","title":"3.3 Mock Agent (harness/mockAgent.ts)","description":"Implement mock agent:\n- Load completed mock file\n- Extract values from mock\n- On each step, pick recommended fields and generate patches\n- Deterministic execution for testing","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:47.253408-08:00","updated_at":"2025-12-22T23:20:47.253408-08:00","dependencies":[{"issue_id":"markform-9sy","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:54.830125-08:00","created_by":"daemon"},{"issue_id":"markform-9sy","depends_on_id":"markform-o5m","type":"blocks","created_at":"2025-12-22T23:20:56.042419-08:00","created_by":"daemon"}]}
{"id":"markform-aae","title":"1.5 Validation (engine/validate.ts)","description":"Implement validate(form: ParsedForm, opts?): ValidationResult\n- Built-in validators (required, patterns, ranges, counts, checkboxes)\n- Code validator loading via jiti\n- Validator execution and error collection\n- Unit tests for all validation rules","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:43.082645-08:00","updated_at":"2025-12-23T15:03:22.041107215Z","closed_at":"2025-12-23T15:02:24.951679567Z","dependencies":[{"issue_id":"markform-aae","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.804845-08:00","created_by":"daemon"},{"issue_id":"markform-aae","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.684933-08:00","created_by":"daemon"},{"issue_id":"markform-aae","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.428231-08:00","created_by":"daemon"},{"issue_id":"markform-aae","depends_on_id":"markform-p6z","type":"blocks","created_at":"2025-12-23T00:34:33.320792-08:00","created_by":"daemon"},{"issue_id":"markform-aae","depends_on_id":"markform-vd0","type":"blocks","created_at":"2025-12-23T00:34:33.483538-08:00","created_by":"daemon"}]}
{"id":"markform-bg7","title":"ARCH-013: Resolve form_state vs minItems/minSelections inconsistency","description":"## Problem\n`form_state` derived from counts can diverge from 'required issues' if `minItems`/`minSelections` is set without `required=true`.\n\n## Evidence from Fixtures\nIn `simple.form.md`:\n- `tags` has `minItems=1` but no `required=true`\n- `categories` has `minSelections=1` but no `required=true`\n\n## Why It Matters\nThis leads to inconsistency:\n- `inspect` could report a 'required' issue (`min_items_not_met`)\n- But `form_state` computed from `requiredFields` count could still show `complete`\n\n## Decision Required\nChoose ONE and apply consistently:\n1. **Treat `minItems\u003e0` / `minSelections\u003e0` as implicitly required** (affects counts)\n2. **Disallow min constraints unless `required=true`** (simplifies everything)\n3. **Compute `form_state` from issue severities** instead of counts\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (progress computation + required semantics)\n\n## Depends On\n- ARCH-008 (explicit checkbox validation)\n- ARCH-009 (single-select semantics)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T00:32:09.340078-08:00","updated_at":"2025-12-23T09:25:01.910047718Z","closed_at":"2025-12-23T09:25:01.910047718Z","close_reason":"Closed","dependencies":[{"issue_id":"markform-bg7","depends_on_id":"markform-p6z","type":"blocks","created_at":"2025-12-23T00:34:33.034497-08:00","created_by":"daemon"},{"issue_id":"markform-bg7","depends_on_id":"markform-vd0","type":"blocks","created_at":"2025-12-23T00:34:33.176379-08:00","created_by":"daemon"}]}
{"id":"markform-bld","title":"1.4 Summaries (engine/summaries.ts)","description":"Implement summary computation:\n- computeStructureSummary(schema): StructureSummary\n- computeProgressSummary(schema, values, issues): ProgressSummary\n- Submission/completion state computation\n- Unit tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:42.275414-08:00","updated_at":"2025-12-23T15:03:22.043192711Z","closed_at":"2025-12-23T15:02:24.95167045Z","dependencies":[{"issue_id":"markform-bld","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.650331-08:00","created_by":"daemon"},{"issue_id":"markform-bld","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.542497-08:00","created_by":"daemon"},{"issue_id":"markform-bld","depends_on_id":"markform-7mt","type":"blocks","created_at":"2025-12-22T23:20:01.268849-08:00","created_by":"daemon"}]}
{"id":"markform-bmy","title":"1.1 Types and Schemas (engine/types.ts)","description":"Define all TypeScript types and Zod schemas:\n- Id, OptionId, QualifiedOptionRef\n- Checkbox types and values\n- Field union type (all 6 field types)\n- FormSchema, FieldGroup, FieldBase\n- All field interfaces\n- DocumentationBlock\n- ParsedForm, IdIndexEntry\n- Patch union type\n- ValidationIssue types\n- InspectIssue, InspectResult, ApplyResult\n- Summary types\n- Session transcript types\n- MarkformFrontmatter","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:39.873559-08:00","updated_at":"2025-12-23T15:03:22.045660608Z","closed_at":"2025-12-23T15:02:24.951576921Z","dependencies":[{"issue_id":"markform-bmy","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:57.2301-08:00","created_by":"daemon"},{"issue_id":"markform-bmy","depends_on_id":"markform-gv1","type":"blocks","created_at":"2025-12-23T00:34:29.556885-08:00","created_by":"daemon"}]}
{"id":"markform-bve","title":"1.7 Inspect (engine/inspect.ts)","description":"Implement inspect(form: ParsedForm): InspectResult\n- Issue prioritization logic\n- ValidationIssue to InspectIssue mapping\n- Completion check (isComplete)\n- Unit tests for issue ordering","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:44.726863-08:00","updated_at":"2025-12-23T14:13:43.562511724Z","closed_at":"2025-12-23T14:13:43.562511724Z","close_reason":"Closed","dependencies":[{"issue_id":"markform-bve","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:58.100143-08:00","created_by":"daemon"},{"issue_id":"markform-bve","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:19:59.993428-08:00","created_by":"daemon"},{"issue_id":"markform-bve","depends_on_id":"markform-aae","type":"blocks","created_at":"2025-12-22T23:20:01.764027-08:00","created_by":"daemon"},{"issue_id":"markform-bve","depends_on_id":"markform-4va","type":"blocks","created_at":"2025-12-23T00:34:32.056702-08:00","created_by":"daemon"},{"issue_id":"markform-bve","depends_on_id":"markform-1qs","type":"blocks","created_at":"2025-12-23T00:34:32.219267-08:00","created_by":"daemon"}]}
{"id":"markform-c2w","title":"ARCH-006: Fix clear_field patch semantics for select/checkbox fields","description":"## Problem\nSpec says `clear_field` 'serializes as empty tag (no value fence)' but for select/checkbox fields, the value is in the option markers list, not a `value` fence.\n\n## Why It Matters\n- Scalar/list fields: value is in a fenced block\n- Select/checkbox fields: value is in option markers like `[x]`, `[ ]`, `[y]`, `[n]`\n- Current spec doesn't distinguish these cases\n- applyPatches implementation would be ambiguous\n\n## Recommended Fix\nDefine `clear_field` semantics per field kind:\n- **Scalar/list fields:** clear = remove `value` fence entirely\n- **Select/checkbox fields:** clear = reset all markers to their default state:\n  - single-select: all `( )`\n  - multi-select: all `[ ]`  \n  - simple checkboxes: all `[ ]`\n  - multi checkboxes: all `[-]`\n  - explicit checkboxes: all `[_]` (unfilled)\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (Patch Operations section)\n\n## Blocks\n- markform-8ap (1.6 Patch Application)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:12.069746-08:00","updated_at":"2025-12-23T09:09:47.167007921Z","closed_at":"2025-12-23T09:09:47.167007921Z","close_reason":"Fixed: Defined clear_field semantics per field kind"}
{"id":"markform-c7v","title":"2.4 Serve Command (cli/commands/serve.ts)","description":"Implement serve command:\n- HTTP server setup\n- HTML rendering of form structure (groups, fields, checkboxes, docs)\n- CSS styling for readability\n- Save button with versioned filename logic","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:22.489667-08:00","updated_at":"2025-12-22T23:20:22.489667-08:00","dependencies":[{"issue_id":"markform-c7v","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:20:30.20486-08:00","created_by":"daemon"},{"issue_id":"markform-c7v","depends_on_id":"markform-g3k","type":"blocks","created_at":"2025-12-22T23:20:31.417234-08:00","created_by":"daemon"}]}
{"id":"markform-clq","title":"3.1 Apply Command (cli/commands/apply.ts)","description":"Implement apply command:\n- Parse form file\n- Parse patches from --patch JSON argument\n- Apply patches\n- Write canonical output\n- Report issues","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:45.603488-08:00","updated_at":"2025-12-22T23:20:45.603488-08:00","dependencies":[{"issue_id":"markform-clq","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:54.538973-08:00","created_by":"daemon"},{"issue_id":"markform-clq","depends_on_id":"markform-g3k","type":"blocks","created_at":"2025-12-22T23:20:55.86385-08:00","created_by":"daemon"}]}
{"id":"markform-cre","title":"PLAN-005: Add task for doc body raw slice preservation","description":"## Problem\nArchitecture requires doc bodies be preserved verbatim for deterministic round-trip, but plan doesn't explicitly cover capturing raw text ranges.\n\n## Why It Matters\n- Doc blocks contain user-written markdown that must not be altered\n- Need to capture the exact source text, not a reconstructed version\n- Markdoc node location metadata may or may not be available\n\n## Recommended Fix\nAdd explicit tasks:\n1. Document how to get source ranges from Markdoc node location metadata\n2. Add fallback strategy if location isn't available for some nodes\n3. Add tests verifying doc body round-trip preservation\n4. Test with various markdown content (lists, code blocks, etc.)\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md (add to Phase 1 parsing tasks)\n\n## Blocks\n- markform-7mt (1.2 Markdoc Parsing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:03.046834-08:00","updated_at":"2025-12-23T09:31:58.338687563Z","closed_at":"2025-12-23T09:31:58.338687563Z","close_reason":"Closed"}
{"id":"markform-cvf","title":"Setup CI workflow","description":"Setup GitHub Actions CI workflow per research doc:\n\n.github/workflows/ci.yml:\n- Triggers: pull_request, push to main\n- Jobs: test\n- Steps:\n  1. actions/checkout@v5\n  2. pnpm/action-setup@v4 (version: 10)\n  3. actions/setup-node@v6 (node-version: 24, cache: pnpm)\n  4. pnpm install --frozen-lockfile\n  5. pnpm lint\n  6. pnpm typecheck\n  7. pnpm build\n  8. pnpm publint\n  9. pnpm test\n\n.github/workflows/release.yml:\n- Triggers: push to main\n- Permissions: contents write, pull-requests write\n- Steps:\n  1. actions/checkout@v5 (fetch-depth: 0)\n  2. pnpm/action-setup@v4\n  3. actions/setup-node@v6 (registry-url: npm)\n  4. pnpm install --frozen-lockfile\n  5. changesets/action@v1 (publish: pnpm release)\n\nRepository settings note:\n- Actions → Workflow permissions → Read and write\n\nRef: docs/project/research/current/research-modern-typescript-monorepo-package.md (Section 8)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:06.382955-08:00","updated_at":"2025-12-23T15:03:22.047621627Z","closed_at":"2025-12-23T15:02:59.222156365Z","dependencies":[{"issue_id":"markform-cvf","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:13.416831-08:00","created_by":"daemon"},{"issue_id":"markform-cvf","depends_on_id":"markform-zt3","type":"blocks","created_at":"2025-12-22T23:19:14.594297-08:00","created_by":"daemon"}]}
{"id":"markform-cx7","title":"4.1 AI SDK Tool Definitions (integrations/ai-sdk.ts)","description":"Implement createMarkformTools(options) factory:\n- markform_inspect tool\n- markform_apply tool\n- markform_export tool\n- markform_get_markdown tool\n- Zod input schemas for all tools\n- Tool execute functions wrapping engine","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:21:06.003801-08:00","updated_at":"2025-12-22T23:21:06.003801-08:00","dependencies":[{"issue_id":"markform-cx7","depends_on_id":"markform-x39","type":"blocks","created_at":"2025-12-22T23:21:13.585204-08:00","created_by":"daemon"}]}
{"id":"markform-d5y","title":"ARCH-011: Separate input vs output frontmatter schema","description":"## Problem\nFrontmatter schema shown as required (`formSummary`, `formProgress`, `formState`) but example input forms only provide `markform_version`.\n\n## Why It Matters\n- Input forms (templates) should have minimal frontmatter\n- Output forms (after processing) include derived metadata\n- Current spec conflates these two schemas\n\n## Recommended Fix\nSeparate schemas:\n- **Input frontmatter:** `markform_version` (required), optional user metadata\n- **Output frontmatter:** Adds `formSummary`, `formProgress`, `formState` (derived on serialize)\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (Frontmatter section)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:32:07.75524-08:00","updated_at":"2025-12-23T09:24:31.833743488Z","closed_at":"2025-12-23T09:24:31.833743488Z","close_reason":"Closed"}
{"id":"markform-dl1","title":"2.2 Inspect Command (cli/commands/inspect.ts)","description":"Implement inspect command:\n- Parse form file\n- Run validation\n- Output YAML report with structure/progress summary, form state, issues\n- Colored output for terminal","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:21.091384-08:00","updated_at":"2025-12-22T23:20:21.091384-08:00","dependencies":[{"issue_id":"markform-dl1","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:20:29.868149-08:00","created_by":"daemon"},{"issue_id":"markform-dl1","depends_on_id":"markform-g3k","type":"blocks","created_at":"2025-12-22T23:20:31.018952-08:00","created_by":"daemon"}]}
{"id":"markform-e89","title":"ARCH-002: Clarify ID uniqueness rules (global vs field-scoped)","description":"## Problem\nSemantic validation says 'Globally-unique IDs across all elements', but options are explicitly field-scoped.\n\n## Why It Matters\nThe current wording implies options must have globally unique IDs, which contradicts the field-scoped design where `field1.opt_a` and `field2.opt_a` are both valid.\n\n## Recommended Fix\nClarify uniqueness rules explicitly:\n- Form/group/field IDs are globally unique within the form\n- Option IDs are unique only within their parent field\n- Doc blocks are unique by `(ref, kind)` tuple\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (semantic validation section)\n\n## Related\n- ARCH-001 (option indexing fix)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:31:08.963341-08:00","updated_at":"2025-12-23T09:00:32.547086124Z","closed_at":"2025-12-23T09:00:32.547086124Z","close_reason":"Already addressed: ID uniqueness rules are clearly documented with Structural IDs (global) vs Option IDs (field-scoped)","dependencies":[{"issue_id":"markform-e89","depends_on_id":"markform-gv1","type":"blocks","created_at":"2025-12-23T00:34:47.580456-08:00","created_by":"daemon"}]}
{"id":"markform-ejt","title":"Phase 0: Project Scaffolding","description":"Set up pnpm monorepo with all tooling configured.\n\nDeliverables:\n- Initialize pnpm workspace structure\n- Create root package.json with workspace scripts\n- Create pnpm-workspace.yaml\n- Create .npmrc with workspace settings\n- Create tsconfig.base.json with shared TypeScript config\n- Create packages/markform/ directory structure\n- Create package package.json with exports, dependencies, scripts\n- Create tsdown.config.ts for build\n- Create tsconfig.json extending base\n- Create eslint.config.js (flat config)\n- Set up .changeset/ for versioning\n- Create .github/workflows/ci.yml\n- Create placeholder src/index.ts\n- Create initial test file\n- Verify pnpm build, test, lint all pass\n\nCheckpoints:\n- pnpm build passes\n- pnpm test passes\n- pnpm lint passes\n- pnpm typecheck passes","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:36.219599-08:00","updated_at":"2025-12-22T23:18:36.219599-08:00","dependencies":[{"issue_id":"markform-ejt","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:45.863147-08:00","created_by":"daemon"}]}
{"id":"markform-fdu","title":"FORM-COMPANY-001: Fix comment syntax in company form","description":"## Problem\n`company-quarterly-analysis.form.md` uses `{# PART ... #}` separators which aren't Markdoc comment syntax per Markdoc docs. Markdoc uses HTML comments (`\u003c!-- ... --\u003e`).\n\n## Why It Matters\n- These will be parsed as plain text nodes, not comments\n- Serializer behavior is unspecified for these nodes\n- Could cause silent data loss on round-trip\n\n## Recommended Fix\nAfter ARCH-007 decision:\n1. **If using HTML comments:** Convert `{# PART 1 ... #}` to `\u003c!-- PART 1 ... --\u003e`\n2. **If removing comments:** Delete the separator lines entirely\n3. **If Markform-only convention:** Keep as-is (requires ARCH-007 to define behavior)\n\n## Files to Update\n- docs/project/test-fixtures/forms/company-quarterly-analysis.form.md\n\n## Depends On\n- ARCH-007 (need decision on comment syntax first)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:33:51.85613-08:00","updated_at":"2025-12-23T09:39:04.644921503Z","closed_at":"2025-12-23T09:39:04.644921503Z","close_reason":"Closed","dependencies":[{"issue_id":"markform-fdu","depends_on_id":"markform-gyn","type":"blocks","created_at":"2025-12-23T00:34:28.879595-08:00","created_by":"daemon"}]}
{"id":"markform-g3k","title":"2.1 CLI Infrastructure (cli/)","description":"Create CLI infrastructure per TypeScript CLI Rules:\n- bin.ts entry point with commander setup\n- lib/colors.ts (picocolors wrapper)\n- lib/shared.ts (context helpers, debug, dry-run)\n- lib/formatting.ts (output formatting)\n- Global options: --verbose, --quiet, --dry-run\n- Colored help text","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:20.336047-08:00","updated_at":"2025-12-22T23:20:20.336047-08:00","dependencies":[{"issue_id":"markform-g3k","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:20:29.694434-08:00","created_by":"daemon"}]}
{"id":"markform-gv1","title":"ARCH-001: Fix idIndex type for field-scoped option IDs","description":"## Problem\nOption IDs are field-scoped but `ParsedForm.idIndex: Map\u003cId, IdIndexEntry\u003e` claims to index `kind:'option'` too. Option IDs can repeat across fields, so a global `Map\u003cId,...\u003e` can't safely index options.\n\n## Why It Matters\n- `QualifiedOptionRef = \\`${Id}.${OptionId}\\`` is defined for external references\n- But `idIndex` uses plain `Id` as key, which can't represent qualified refs\n- This will cause collisions when multiple fields have options with same local ID\n\n## Recommended Fix\n**Option A (recommended):** Separate indices\n- `idIndex: Map\u003cId, IdIndexEntry\u003e` for form/group/field only\n- `optionIndex: Map\u003cQualifiedOptionRef, OptionIndexEntry\u003e` for options\n\n**Option B:** Single string-keyed index\n- `idIndex: Map\u003cstring, IdIndexEntry\u003e` accepting both `Id` and `QualifiedOptionRef`\n\n## Also Fix\n- Semantic validation bullet 'Globally-unique IDs across all elements' should exclude options\n- Options are only unique within their parent field\n- Update ParsedForm interface in architecture doc\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md\n\n## Blocks\n- markform-bmy (1.1 Types and Schemas)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-23T00:30:23.013095-08:00","updated_at":"2025-12-23T09:00:11.677786081Z","closed_at":"2025-12-23T09:00:11.677786081Z","close_reason":"Fixed: Removed 'option' from IdIndexEntry kind, clarified that idIndex is for form/group/field only, and options use StructureSummary.optionsById"}
{"id":"markform-gyn","title":"ARCH-007: Fix Markdoc comment syntax in spec and fixtures","description":"## Problem\nArchitecture assumes `{# ... #}` is Markdoc comment syntax, but Markdoc uses HTML comments (`\u003c!-- ... --\u003e`). The `process=false` detection regex also incorrectly includes `{#`.\n\nPer Markdoc docs: comment support uses HTML comments and requires `allowComments: true` on `Markdoc.Tokenizer`.\n\n## Why It Matters\n- `company-quarterly-analysis.form.md` uses `{# PART 1 ... #}` separators\n- If Markdoc doesn't treat those as comments, they appear as plain text nodes\n- Serializer is not specified to preserve them → silent data loss risk on round-trip\n\n## Decision Required\nChoose ONE approach and codify it:\n\n**Option A: Align with Markdoc**\n- Switch all 'comment blocks' in examples/forms to `\u003c!-- ... --\u003e`\n- Optionally enable `allowComments: true` in tokenizer\n- HTML comments are parseable as HTML nodes even without the flag\n\n**Option B: Define Markform-only comments**\n- Keep `{# ... #}` but define it explicitly as Markform convention (not Markdoc)\n- Specify whether preserved or discarded by canonical serialization\n- Update process=false detection to NOT include `{#`\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md\n- docs/project/test-fixtures/forms/company-quarterly-analysis.form.md\n- Any other fixtures using `{# #}` syntax\n\n## Blocks\n- ARCH-012 (non-Markform nodes policy)\n- PLAN-003 (process=false emission)\n- FORM-COMPANY-001 (company form comments)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-23T00:30:24.107563-08:00","updated_at":"2025-12-23T08:58:38.839683167Z","closed_at":"2025-12-23T08:58:38.839683167Z","close_reason":"Fixed: Updated to use HTML comments"}
{"id":"markform-h0z","title":"1.9 Session Transcript Handling (engine/session.ts)","description":"Implement session handling:\n- parseSession(yaml: string): SessionTranscript\n- serializeSession(session: SessionTranscript): string\n- Session schema validation via Zod\n- YAML serialization with snake_case\n- Comprehensive round-trip validation tests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:46.120428-08:00","updated_at":"2025-12-23T15:03:22.049794556Z","closed_at":"2025-12-23T15:02:24.95171358Z","dependencies":[{"issue_id":"markform-h0z","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:19:58.430656-08:00","created_by":"daemon"},{"issue_id":"markform-h0z","depends_on_id":"markform-bmy","type":"blocks","created_at":"2025-12-22T23:20:00.144739-08:00","created_by":"daemon"}]}
{"id":"markform-ja8","title":"Initialize pnpm workspace structure","description":"Initialize pnpm workspace following research-modern-typescript-monorepo-package.md:\n\nRoot package.json:\n- name: markform-workspace\n- private: true\n- packageManager: pnpm@10.26.1\n- engines: { node: '\u003e=24' }\n- Scripts: build, test, lint, typecheck, publint, changeset, version-packages, release\n\npnpm-workspace.yaml:\n- packages: ['packages/*']\n\n.npmrc:\n- save-workspace-protocol=true\n- prefer-workspace-packages=true\n\ntsconfig.base.json (per research doc):\n- target: ES2024\n- lib: ['ES2024']\n- module: ESNext\n- moduleResolution: Bundler\n- strict: true\n- noUncheckedIndexedAccess: true\n- verbatimModuleSyntax: true\n- skipLibCheck: true\n- forceConsistentCasingInFileNames: true\n\nRef: docs/project/research/current/research-modern-typescript-monorepo-package.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:04.224762-08:00","updated_at":"2025-12-23T15:03:22.051854643Z","closed_at":"2025-12-23T15:02:59.22204577Z","dependencies":[{"issue_id":"markform-ja8","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:12.991725-08:00","created_by":"daemon"}]}
{"id":"markform-jvy","title":"PLAN-003: Align plan with architecture on process=false emission","description":"## Problem\nPlan instructs 'Ensure `process=false` on all value fences' but architecture says emit `process=false` only when the value contains Markdoc syntax (`{%` sequences).\n\n## Why It Matters\n- Creates spec conflict between plan and architecture\n- Golden fixtures could fight the actual spec\n- Implementers won't know which rule to follow\n\n## Recommended Fix\n1. Update plan to match architecture: emit `process=false` only when value contains Markdoc syntax\n2. Add test cases for both scenarios (with and without Markdoc syntax in values)\n3. Ensure golden fixtures reflect the conditional emission rule\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md\n\n## Depends On\n- ARCH-007 (comment syntax decision affects what triggers process=false)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-23T00:33:01.243229-08:00","updated_at":"2025-12-23T09:31:38.290841983Z","closed_at":"2025-12-23T09:31:38.290841983Z","close_reason":"Closed","dependencies":[{"issue_id":"markform-jvy","depends_on_id":"markform-gyn","type":"blocks","created_at":"2025-12-23T00:34:28.736886-08:00","created_by":"daemon"}]}
{"id":"markform-k3z","title":"3.4 Run Command (cli/commands/run.ts)","description":"Implement run command:\n- --mock flag for mock mode\n- --completed-mock \u003cfile\u003e for mock values source\n- --record \u003cfile\u003e to output session transcript\n- Execute harness loop to completion\n- Output session YAML","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:47.969934-08:00","updated_at":"2025-12-22T23:20:47.969934-08:00","dependencies":[{"issue_id":"markform-k3z","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:54.987236-08:00","created_by":"daemon"},{"issue_id":"markform-k3z","depends_on_id":"markform-o5m","type":"blocks","created_at":"2025-12-22T23:20:56.221164-08:00","created_by":"daemon"},{"issue_id":"markform-k3z","depends_on_id":"markform-9sy","type":"blocks","created_at":"2025-12-22T23:20:56.376048-08:00","created_by":"daemon"}]}
{"id":"markform-kak","title":"2.3 Export Command (cli/commands/export.ts)","description":"Implement export command:\n- Parse form file\n- Output JSON: { schema, values }","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:21.75947-08:00","updated_at":"2025-12-22T23:20:21.75947-08:00","dependencies":[{"issue_id":"markform-kak","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:20:30.033565-08:00","created_by":"daemon"},{"issue_id":"markform-kak","depends_on_id":"markform-g3k","type":"blocks","created_at":"2025-12-22T23:20:31.260119-08:00","created_by":"daemon"}]}
{"id":"markform-kav","title":"PLAN-006: Keep inspect YAML output machine-readable","description":"## Problem\nPlan mentions colors and formatting, but inspect output is YAML which should remain machine-readable (no ANSI escape codes).\n\n## Why It Matters\n- YAML output needs to be pipeable to other tools\n- ANSI codes would break `yq`, `jq` (after conversion), etc.\n- Users may redirect output to files\n\n## Recommended Fix\n1. Use colors only in non-YAML human-readable logs/messages\n2. Keep YAML output clean and parseable\n3. Consider `--no-color` flag for all output if needed\n4. Test that YAML output parses correctly\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md (clarify in CLI tasks)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T00:33:03.798121-08:00","updated_at":"2025-12-23T09:31:58.345895784Z","closed_at":"2025-12-23T09:31:58.345895784Z","close_reason":"Closed"}
{"id":"markform-mls","title":"Fix Architecture \u0026 Plan Doc Issues (2025-12-23 Review)","description":"Address all spec/fixture mismatches and ambiguities identified in the comprehensive documentation review before implementation begins.\n\n## Scope\n- 10 architecture issues (ARCH-001 through ARCH-013)\n- 7 implementation plan issues (PLAN-001 through PLAN-007)  \n- 6 sample form issues (FORM-SIMPLE-001, FORM-COMPANY-001 through 005)\n\n## Critical Items (must fix before implementation)\n1. Fix Markdoc comment syntax + decide preservation policy (ARCH-007)\n2. Fix option indexing so option refs are resolvable (ARCH-001)\n3. Fix doc placement rules to match fixtures (ARCH-005)\n4. Fix clear_field semantics for select/checkbox (ARCH-006)\n5. Align plan with architecture on process=false emission (PLAN-003)\n6. Clarify requiredness vs minItems/minSelections (ARCH-013)\n\n## Review Source\nAnalysis performed 2025-12-23 comparing:\n- arch-markform-initial-design.md\n- plan-2025-12-22-markform-v01-implementation.md\n- simple.form.md, simple.mock.filled.form.md\n- company-quarterly-analysis.form.md\n- Markdoc official documentation","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-23T00:29:50.583803-08:00","updated_at":"2025-12-23T09:39:19.408560643Z","closed_at":"2025-12-23T09:39:19.408560643Z","close_reason":"Closed"}
{"id":"markform-mrh","title":"FORM-COMPANY-005: Fix sources_accessed item_format pattern","description":"## Problem\n`sources_accessed` `item_format` pattern doesn't enforce all 5 columns described in instructions. The docs say each item should have: Source Type | Name | URL | Access Date | Key Data Points.\n\n## Why It Matters\n- Validation may accept incomplete entries\n- Instructions promise more structure than validation enforces\n- Could lead to inconsistent data\n\n## Recommended Fix\nChoose ONE approach:\n1. **Stricter regex:** Use pipe-count regex requiring exactly 5 segments\n2. **Document limitation:** Update docs to say 'at least 3 segments required'\n3. **Simpler validation:** Remove item_format, rely on doc instructions only\n\n## Files to Update\n- docs/project/test-fixtures/forms/company-quarterly-analysis.form.md","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T00:33:54.914182-08:00","updated_at":"2025-12-23T00:33:54.914182-08:00"}
{"id":"markform-mus","title":"Create markform package structure","description":"Create packages/markform/ with full structure per research doc:\n\npackage.json:\n- name: markform\n- version: 0.1.0\n- type: module\n- sideEffects: false\n- main: ./dist/index.cjs\n- module: ./dist/index.js\n- types: ./dist/index.d.ts\n- exports with proper ESM/CJS dual support (types first!)\n- bin: { markform: ./dist/bin.js }\n- files: ['dist']\n- engines: { node: '\u003e=24' }\n- Scripts: build, dev, typecheck, test, publint, prepack\n\ntsdown.config.ts:\n- entry: { index, bin }\n- format: ['esm', 'cjs']\n- platform: node\n- target: node24\n- sourcemap: true\n- dts: true\n- clean: true\n- banner for shebang on bin.*\n\ntsconfig.json:\n- extends: ../../tsconfig.base.json\n- compilerOptions: { types: ['node'], noEmit: true }\n- include: ['src']\n\nDirectory structure:\n- src/engine/\n- src/cli/\n- src/harness/\n- src/integrations/\n- src/web/\n- src/index.ts\n- tests/unit/\n- tests/golden/\n\nRef: docs/project/research/current/research-modern-typescript-monorepo-package.md (Appendix A, D)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:04.960122-08:00","updated_at":"2025-12-23T15:03:22.053817389Z","closed_at":"2025-12-23T15:02:59.222121651Z","dependencies":[{"issue_id":"markform-mus","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:13.129649-08:00","created_by":"daemon"},{"issue_id":"markform-mus","depends_on_id":"markform-ja8","type":"blocks","created_at":"2025-12-22T23:19:14.286237-08:00","created_by":"daemon"}]}
{"id":"markform-n3l","title":"Phase 2: Web UI (serve) and Basic CLI","description":"Enable browsing forms via web UI and basic CLI inspection.\n\nSub-tasks:\n2.1 CLI Infrastructure (cli/)\n2.2 Inspect Command (cli/commands/inspect.ts)\n2.3 Export Command (cli/commands/export.ts)\n2.4 Serve Command (cli/commands/serve.ts)\n\nCheckpoints (automated):\n- markform inspect outputs valid YAML\n- markform export outputs valid JSON\n- CLI integration tests pass\n\nCheckpoints (manual):\n- User verifies serve renders form correctly in browser\n- User verifies Save button works with versioned filenames","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:37.565782-08:00","updated_at":"2025-12-22T23:18:37.565782-08:00","dependencies":[{"issue_id":"markform-n3l","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:46.147474-08:00","created_by":"daemon"},{"issue_id":"markform-n3l","depends_on_id":"markform-2j6","type":"blocks","created_at":"2025-12-22T23:18:47.337796-08:00","created_by":"daemon"}]}
{"id":"markform-ncq","title":"FORM-COMPANY-003: Align word count docs with validation constraints","description":"## Problem\nSeveral fields in company form say '25-75 words' in docs but use `minLength`/`maxLength` (character-based validation).\n\nExample: `how_makes_money` says '25-75 words' but uses `minLength=100 maxLength=300`.\n\n## Why It Matters\n- Confusing for form fillers: which constraint applies?\n- Character count != word count\n- Could cause valid responses to fail validation or vice versa\n\n## Recommended Fix\nChoose ONE approach:\n1. **Add word validators:** Implement `min_words`/`max_words` validators for word-based constraints\n2. **Update doc text:** Change '25-75 words' to '100-300 characters' to match actual validation\n\n## Files to Update\n- docs/project/test-fixtures/forms/company-quarterly-analysis.form.md","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-23T00:33:53.370545-08:00","updated_at":"2025-12-23T00:33:53.370545-08:00"}
{"id":"markform-o5m","title":"3.2 Harness Implementation (harness/)","description":"Implement FormHarness class:\n- State machine: INIT -\u003e STEP -\u003e WAIT -\u003e APPLY -\u003e COMPLETE\n- step() returns StepResult with summaries and issues\n- apply(patches) applies and revalidates\n- max_turns safety limit","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:46.388058-08:00","updated_at":"2025-12-22T23:20:46.388058-08:00","dependencies":[{"issue_id":"markform-o5m","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:54.685762-08:00","created_by":"daemon"}]}
{"id":"markform-o75","title":"4.3 Documentation","description":"Document AI SDK integration:\n- Document in README\n- Document tool schemas\n- Document harness configuration options","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T23:21:07.510942-08:00","updated_at":"2025-12-22T23:21:07.510942-08:00","dependencies":[{"issue_id":"markform-o75","depends_on_id":"markform-x39","type":"blocks","created_at":"2025-12-22T23:21:13.895894-08:00","created_by":"daemon"},{"issue_id":"markform-o75","depends_on_id":"markform-1xj","type":"blocks","created_at":"2025-12-22T23:21:14.776524-08:00","created_by":"daemon"}]}
{"id":"markform-o8l","title":"Create placeholder src and tests","description":"Create placeholder source and tests to verify tooling:\n\nsrc/index.ts:\n- Export package version from package.json\n- Export placeholder types\n\ntests/unit/index.test.ts:\n- Basic test using vitest\n- Import and verify version export works\n\nVerify all commands pass:\n- pnpm install (from root)\n- pnpm build\n- pnpm typecheck\n- pnpm lint\n- pnpm publint\n- pnpm test\n\nAdd vitest to package devDependencies:\n- vitest ^3.0.0\n\nPackage scripts:\n- test: vitest run\n- test:watch: vitest","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:07.022832-08:00","updated_at":"2025-12-23T15:03:22.055914164Z","closed_at":"2025-12-23T15:02:59.222173451Z","dependencies":[{"issue_id":"markform-o8l","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:13.565662-08:00","created_by":"daemon"},{"issue_id":"markform-o8l","depends_on_id":"markform-cvf","type":"blocks","created_at":"2025-12-22T23:19:14.742844-08:00","created_by":"daemon"}]}
{"id":"markform-p6z","title":"ARCH-008: Align explicit checkbox validation with required semantics","description":"## Problem\nBuilt-in deterministic validation table says explicit checkboxes 'requires no unfilled values' without mentioning `required=true`, but Required Field Semantics section ties that rule to `required=true`.\n\n## Why It Matters\nThese two sections contradict each other:\n- Validation table implies: explicit mode ALWAYS requires all answered\n- Required semantics implies: explicit mode only requires all answered when `required=true`\n\n## Recommended Fix\nMake both sections consistent. Recommended approach:\n- **Validation:** Only checks that markers are valid (`unfilled|yes|no`)\n- **Completeness:** If `required=true`, then all must be answered (no `[_]` markers)\n\nThis aligns with progress state meaning (`empty` vs `incomplete` vs `invalid`).\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (Built-in Validation table + Required Field Semantics)\n\n## Blocks\n- markform-aae (1.5 Validation)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-23T00:32:04.61446-08:00","updated_at":"2025-12-23T09:24:11.775309349Z","closed_at":"2025-12-23T09:24:11.775309349Z","close_reason":"Closed"}
{"id":"markform-s2w","title":"PLAN-007: Use optional peer deps for AI integration packaging","description":"## Problem\n`markform/ai` subpath should not force-install AI SDK dependencies. The monorepo research brief explicitly calls out optional peer deps as a best practice for adapters.\n\n## Why It Matters\n- Users who don't use AI features shouldn't install AI SDK\n- Reduces bundle size for non-AI use cases\n- Follows modern package patterns from research brief\n\n## Recommended Fix\n1. Use optional peer dependencies for AI SDK adapters\n2. Use subpath exports pattern: `markform/ai-sdk`\n3. Document which peer deps are required for each subpath\n4. Add install instructions for each integration\n\n## Files to Update\n- docs/project/plan/plan-2025-12-22-markform-v01-implementation.md (Phase 4 packaging)\n\n## Blocks\n- markform-x39 (Phase 4: Vercel AI SDK Integration)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:04.550905-08:00","updated_at":"2025-12-23T09:32:08.373298451Z","closed_at":"2025-12-23T09:32:08.373298451Z","close_reason":"Closed"}
{"id":"markform-sub","title":"FORM-COMPANY-004: Tighten fiscal_year_end date regex","description":"## Problem\n`fiscal_year_end` regex pattern allows invalid day values (e.g., month 13, day 32, day 00).\n\n## Why It Matters\n- Invalid dates could pass validation\n- Not a blocker but reduces data quality\n- Could confuse downstream processing\n\n## Recommended Fix\nChoose ONE approach:\n1. **Tighten regex:** Use pattern that validates real month/day ranges\n2. **Accept limitation:** Document as 'format validation only, not date validation'\n3. **Use date validator:** Add custom `valid_date` validator instead of regex\n\n## Severity\nLow priority - the current regex catches most malformed input; edge cases are unlikely in practice.\n\n## Files to Update\n- docs/project/test-fixtures/forms/company-quarterly-analysis.form.md","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-23T00:33:54.145734-08:00","updated_at":"2025-12-23T00:33:54.145734-08:00"}
{"id":"markform-ufu","title":"ARCH-012: Define policy for non-Markform nodes in forms","description":"## Problem\nSpec doesn't say what happens to non-Markform nodes (comments, headings, plain text between tags). The company form uses separators that may not be preserved.\n\n## Why It Matters\n- `company-quarterly-analysis.form.md` uses `{# PART ... #}` separators\n- Parser likely ignores them, but serializer behavior is unspecified\n- Could cause silent data loss on round-trip\n\n## Decision Required\nExplicitly state ONE of:\n1. Non-markform nodes are forbidden (parse error)\n2. Non-markform nodes are allowed but discarded on canonical serialize\n3. Non-markform nodes are allowed and preserved verbatim (requires raw slicing)\n\n## Recommendation for v0.1\n- Allow HTML comments only (`\u003c!-- ... --\u003e`)\n- Ignore/error on other arbitrary content\n- Don't promise preservation beyond doc blocks\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md\n\n## Depends On\n- ARCH-007 (need to decide comment syntax first)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:32:08.590359-08:00","updated_at":"2025-12-23T09:24:41.861298341Z","closed_at":"2025-12-23T09:24:41.861298341Z","close_reason":"Closed","dependencies":[{"issue_id":"markform-ufu","depends_on_id":"markform-gyn","type":"blocks","created_at":"2025-12-23T00:34:28.595657-08:00","created_by":"daemon"}]}
{"id":"markform-vd0","title":"ARCH-009: Clarify single-select validity vs requiredness semantics","description":"## Problem\nSpec wording inconsistency: one section implies 'exactly one [x] always', but the data model allows `selected: null` and required semantics allow optional single-select to be empty.\n\n## Why It Matters\nImplementers need clear rules for:\n- What constitutes a VALID single-select value?\n- What constitutes a COMPLETE single-select value?\n\n## Recommended Fix\nMake explicit:\n- **Validity invariant (always):** At most one selected marker (`(x)`)\n- **Required invariant (only when `required=true`):** Exactly one selected\n\nAn optional single-select with no selection is valid but incomplete (if you track progress).\n\n## Files to Update\n- docs/project/architecture/current/arch-markform-initial-design.md (single-select sections)\n\n## Blocks\n- markform-aae (1.5 Validation)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:32:05.503865-08:00","updated_at":"2025-12-23T09:24:21.797615304Z","closed_at":"2025-12-23T09:24:21.797615304Z","close_reason":"Closed"}
{"id":"markform-x39","title":"Phase 4: Vercel AI SDK Integration","description":"Research and validate AI SDK tool integration for live agent mode.\n\nSub-tasks:\n4.1 AI SDK Tool Definitions (integrations/ai-sdk.ts)\n4.2 Live Agent Test Script\n4.3 Documentation\n\nCheckpoints (automated):\n- AI SDK tools have correct Zod schemas\n- Tool execute functions return correct types\n- Integration tests pass\n\nCheckpoints (manual):\n- User runs live AI agent test\n- User reviews agent conversation logs\n- User verifies final forms are correctly filled","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:38.965938-08:00","updated_at":"2025-12-22T23:18:38.965938-08:00","dependencies":[{"issue_id":"markform-x39","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:46.432752-08:00","created_by":"daemon"},{"issue_id":"markform-x39","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:18:47.616459-08:00","created_by":"daemon"},{"issue_id":"markform-x39","depends_on_id":"markform-s2w","type":"blocks","created_at":"2025-12-23T00:34:46.865145-08:00","created_by":"daemon"}]}
{"id":"markform-y98","title":"FORM-COMPANY-002: Document required_if_equals validator","description":"## Problem\nCompany form uses validator `required_if_equals` but architecture only documents `required_if`. This validator is used but not specified.\n\n## Why It Matters\n- Implementers won't know how to implement this validator\n- Creates gap between fixture and specification\n- Could lead to different interpretations\n\n## Recommended Fix\nChoose ONE approach:\n1. **Add to architecture:** Document `required_if_equals` in 'Example Custom Validators' list with signature and semantics\n2. **Refactor fixture:** Change to `required_if` with `equals` parameter (e.g., `validate=\"required_if(field=type, equals='other')\"`)\n\n## Files to Update\nEither:\n- docs/project/architecture/current/arch-markform-initial-design.md (if adding validator)\n- docs/project/test-fixtures/forms/company-quarterly-analysis.form.md (if refactoring)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T00:33:52.62634-08:00","updated_at":"2025-12-23T09:39:04.651584933Z","closed_at":"2025-12-23T09:39:04.651584933Z","close_reason":"Closed"}
{"id":"markform-yyh","title":"3.5 Golden Session Tests (tests/golden/)","description":"Implement golden session testing:\n- Session transcript schema validation\n- runGoldenTest(sessionPath) implementation\n- Replay turns, verify issues, verify snapshots\n- Create simple.session.yaml\n- Create company-quarterly-analysis.session.yaml\n- Integration test runner","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T23:20:48.777963-08:00","updated_at":"2025-12-22T23:20:48.777963-08:00","dependencies":[{"issue_id":"markform-yyh","depends_on_id":"markform-yz3","type":"blocks","created_at":"2025-12-22T23:20:55.144278-08:00","created_by":"daemon"},{"issue_id":"markform-yyh","depends_on_id":"markform-k3z","type":"blocks","created_at":"2025-12-22T23:20:56.53563-08:00","created_by":"daemon"}]}
{"id":"markform-yz3","title":"Phase 3: End-to-End CLI and Session Tests","description":"Complete CLI functionality and golden session testing.\n\nSub-tasks:\n3.1 Apply Command (cli/commands/apply.ts)\n3.2 Harness Implementation (harness/)\n3.3 Mock Agent (harness/mockAgent.ts)\n3.4 Run Command (cli/commands/run.ts)\n3.5 Golden Session Tests (tests/golden/)\n\nCheckpoints (automated):\n- markform apply with valid patches succeeds\n- markform apply with invalid patches rejects batch\n- markform run --mock completes\n- Golden tests pass for both forms\n\nCheckpoints (manual):\n- User reviews session transcript YAML for readability","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-22T23:18:38.251309-08:00","updated_at":"2025-12-22T23:18:38.251309-08:00","dependencies":[{"issue_id":"markform-yz3","depends_on_id":"markform-08t","type":"blocks","created_at":"2025-12-22T23:18:46.288805-08:00","created_by":"daemon"},{"issue_id":"markform-yz3","depends_on_id":"markform-n3l","type":"blocks","created_at":"2025-12-22T23:18:47.478948-08:00","created_by":"daemon"}]}
{"id":"markform-zt3","title":"Setup linting and changeset","description":"Setup ESLint (strict type-aware) and Changesets per research doc:\n\nESLint (eslint.config.js - flat config):\n- Type-aware using recommendedTypeChecked + stylisticTypeChecked\n- projectService: true for precise cross-project types\n- Rules:\n  - curly: ['error', 'all']\n  - brace-style: ['error', '1tbs']\n  - @typescript-eslint/no-unused-vars with underscore patterns\n  - @typescript-eslint/no-floating-promises: error\n  - @typescript-eslint/no-misused-promises: error\n  - @typescript-eslint/await-thenable: error\n  - @typescript-eslint/consistent-type-imports: error\n  - @typescript-eslint/no-import-type-side-effects: error\n  - no-restricted-syntax for TSImportType\n- Relaxed rules for test files and scripts\n- Ignores: dist, node_modules, .pnpm-store\n\nChangesets (.changeset/):\n- config.json with @changesets/changelog-github\n- access: public\n- baseBranch: main\n- README.md\n\nRoot devDependencies:\n- @changesets/cli ^2.28.0\n- @changesets/changelog-github ^0.5.0\n- @eslint/js ^9.0.0\n- eslint ^9.0.0\n- typescript ^5.0.0\n- typescript-eslint ^8.0.0\n\nRef: docs/project/research/current/research-modern-typescript-monorepo-package.md (Appendix B, C)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T23:19:05.715134-08:00","updated_at":"2025-12-23T15:03:22.058053514Z","closed_at":"2025-12-23T15:02:59.222138392Z","dependencies":[{"issue_id":"markform-zt3","depends_on_id":"markform-ejt","type":"blocks","created_at":"2025-12-22T23:19:13.273548-08:00","created_by":"daemon"},{"issue_id":"markform-zt3","depends_on_id":"markform-mus","type":"blocks","created_at":"2025-12-22T23:19:14.437331-08:00","created_by":"daemon"}]}
